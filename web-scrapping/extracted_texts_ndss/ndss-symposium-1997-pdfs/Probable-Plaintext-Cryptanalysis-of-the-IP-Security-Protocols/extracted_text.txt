ProbablePlaintext
Probable Plaintext
Cryptanalysis of IPSEC
StevenM.Bellovin
s m b @ r e s e a r c h . a t t . c o m
908-582-5886
AT&T Labs Research
Murray Hill, NJ 07974
L
A T & T
1
StevenM.Bellovin—February2,1997ProbablePlaintext
Attacking DES
(cid:15)
DES is a strong cipher, but its key size is too
short to protect against brute-force cryptanalysis.
(cid:15)
Most published designs for DES-crackers
assume a block of known plaintext.
(cid:15)
Often, we don't know any full blocks of plaintext,
but we may know enough.
L
A T & T
2
StevenM.Bellovin—February2,1997ProbablePlaintext
IPSEC
IP IP IP
ESP ESP ESP
TCP UDP IP
user data user data TCP
user data
The encryption header contains a security
association identifier, a replay prevention counter,
authentication data, length information, padding, and
the “next protocol” indicator.
L
A T & T
3
StevenM.Bellovin—February2,1997ProbablePlaintext
Single Packet Attacks
(cid:15)
Pick out one packet.
(cid:15)
From that packet's characteristics, guess the
values of many bits in a single block. Feed that
into a key search engine.
(cid:15)
Test candidate keys on other blocks or
(ultimately) by human analysis.
L
A T & T
4
StevenM.Bellovin—February2,1997ProbablePlaintext
Example: IP Header
Replay Counter An early draft said that the replay
counter started at 1.
Probableplaintextavailable:30-31bits.
Version/header len/TOS/precedence Almost
always
4 5 1 0
1 6
.
Probableplaintextavailable:16bits.
Packet length We know that 30-40% of packets are
TCP ACK packets, exactly 40 bytes long. By
looking at the received length of the packet, we
can often pick these out, giving us the IP length.
Probableplaintextavailable:16bits.
Src/Dst Addresses If host-to-host tunnel mode is
used, the encrypted addresses will match the
outside addresses exactly.
Probableplaintextavailable:64bits.
In firewall-to-firewall mode or host-to-firewall
mode, the high-order bits will often match or
otherwise be known from other sources.
Probableplaintextavailable:32-48bits.
L
A T & T
5
StevenM.Bellovin—February2,1997ProbablePlaintext
Double Packet Attacks
(cid:15)
Pick out two packets from the same stream.
(cid:15)
Do trial decryption on both packets.
(cid:15)
See if the fields match.
(cid:15)
Statistically, adding a small value to a counter
changes very few bits.
+
More or less doubles cost per key recovered.
L
A T & T
6
StevenM.Bellovin—February2,1997ProbablePlaintext
Example: TCP Header
Port numbers In the same connection, port
numbers will match exactly.
Probableplaintextavailable:32bits.
Seq/Ack Typically, these fields change in only a few
bit positions on successive packets. The length
of the packet may be a clue.
Probableplaintextavailable:18-30bits.
Flags/Window/Urgent Flags are generally constant
(
5 0 1 8
1 6
); window size of the sender will remain
constant; urgent pointer is usually 0.
Probableplaintextavailable:48bits.
Other fields that match closely between packets are
the IP packet ID, TTL, protocol, and checksum fields,
the ESP replay counter, and the UDP port number
fields.
L
A T & T
7
StevenM.Bellovin—February2,1997ProbablePlaintext
Total Probable Plaintext
Single Double
IP 54–58 127
TCP 88 124
UDP 28 46
If tunnel mode is used, the IP header will have 32 or
64 more bits of probable plaintext.
For double packet attacks, the ESP header has at
least 30-31 more bits of probable plaintext if the IV is
known.
L
A T & T
8
StevenM.Bellovin—February2,1997ProbablePlaintext
The Role of Traffic Analysis
(cid:15)
Can be used to find packet pairs for
double-packet analysis.
(cid:15)
TCP open sequence is very characteristic; initial
packets have more known plaintext (sequence
and acknowledgment fields).
(cid:15)
Packet timings and lengths give away clues to
port numbers.
(cid:15)
Closely spaced packets are often from the same
TCP stream (packet trains).
(cid:15)
Related conversations, such as multiple image
fetches for a Web page, often have common
addresses, source port numbers, etc.
(cid:15)
Per-connection keying makes some of this easy.
L
A T & T
9
StevenM.Bellovin—February2,1997ProbablePlaintext
Defenses
(cid:15)
Avoid host-to-host tunnel mode.
(cid:15)
For firewall-to-firewall mode, use secret internal
addresses.
(cid:15)
Use host-pair or firewall-pair keying, not
per-connection keying.
+
But this has other cryptographic weaknesses!
(cid:15)
Compression:
– Abbreviate sequence and acknowledgment
fields, as in VJ header compression.
– With per-connection keying, eliminate port
numbers as well.
– Possibly use data compression with a keyed
dictionary.
(cid:15)
Don't use ciphers as weak as DES. . .
L
A T & T
10
StevenM.Bellovin—February2,1997ProbablePlaintext
World War II Analogs
(cid:15)
Cryptanalysts often tried likely texts for message
starts as plaintext for the bombes.
(cid:15)
Parallel solution of the same message in Enigma
and simpler systems provided other cribs.
(cid:15)
Repeated encryption of the initial rotor settings
provided unknown values that nevertheless had
to match upon decryption.
L
A T & T
11
StevenM.Bellovin—February2,1997