The Effect of DNS on Tor’s Anonymity
Benjamin Greschbach KTH Royal Institute of Technology
Tobias Pulls Karlstad University
Laura M. Roberts Princeton University
Philipp Winter Princeton University
Nick Feamster Princeton University
1www.generic-adult-content-site.com
2www.generic-adult-content-site.com
3How is DNS handled in Tor?
DNS resolver
Tor client Guard Middle Exit example.com
4How is DNS handled in Tor?
DNS resolver
Tor client Guard Middle Exit example.com
5How is DNS handled in Tor?
DNS resolver
Tor client Guard Middle Exit example.com
6Exit relays perform DNS resolution.
Where’s
example.com?
DNS resolver
Tor client Guard Middle Exit example.com
7Research Questions
Where’s
example.com?
DNS resolver
?
Tor client Guard Middle Exit example.com
8Research Questions
Where’s
example.com?
?
DNS resolver
?
Tor client Guard Middle Exit example.com
9How DNS can be used to compromise Tor.
?
Where’s
example.com?
?
DNS resolver
?
Tor client Guard Middle Exit example.com
10How exposed are DNS queries?
11How exposed are DNS queries?
12How exposed are DNS queries?
13How exposed are DNS queries?
14How exposed are DNS queries?
15How exposed are DNS queries?
16How exposed are DNS queries?
17How exposed are DNS queries?
18How exposed are DNS queries?
19How exposed are DNS queries?
20DNS traffic traverses ASes that are not otherwise traversed
by TCP traffic.
For half of all of the Alexa Top 1,000 websites, DNS-only ASes account for 57% or
more of all traversed ASes
21What resolvers do exit relays use?
22What resolvers do exit relays use?
23What resolvers do exit relays use?
24What resolvers do exit relays use?
25What resolvers do exit relays use?
Resolver Min (%) Max (%) Median (%)
Google 23.57 42.33 32.84
Local 7.71 15.95 11.56
OVH 1.96 14.13 6.57
OpenDNS 0.05 5.62 0.76
Percentage of observed DNS queries
26What resolvers do exit relays use?
Resolver Min (%) Max (%) Median (%)
Google 23.57 42.33 32.84
Local 7.71 15.95 11.56
OVH 1.96 14.13 6.57
OpenDNS 0.05 5.62 0.76
Percentage of observed DNS queries
27What resolvers do exit relays use?
Resolver Min (%) Max (%) Median (%)
Google 23.57 42.33 32.84
Local 7.71 15.95 11.56
OVH 1.96 14.13 6.57
OpenDNS 0.05 5.62 0.76
Percentage of observed DNS queries
28How can an attacker leverage DNS?
29How can an attacker leverage DNS?
30Attacker augments website fingerprinting attack with DNS data
● We extended Wang et al.’s Wa-kNN classifier (USENIX Security’14)
● Close-the-world attack
● High precision attack
○ Accepts Wa-kNN’s website classification only if that website was observed in DNS traffic
● Our attacks are very precise for unpopular websites
31Our attacks at Internet-scale
● Place Tor clients in top five Tor usage countries
● Simulate clients’ online behavior
○ Cf. Johnson et al. CCS’13
● Simulate Tor clients’ path selection
○ TorPS (github.com/torps/torps)
● Run traceroutes client →guard and exit → destination
○ Use RIPE Atlas!
● Check for overlapping autonomous systems
○ Set intersection
32RIPE Atlas probes
33Analyzed four Tor exit relay DNS set-up scenarios
What if all Tor exit relays were set up to use their ISPs’ resolvers?
What if all Tor exit relays were set up to use Google’s 8.8.8.8 public resolver?
What if all Tor exit relays were set up to do their own DNS resolution?
What if all Tor exit relays were set up as they currently are (status quo)?
34Fraction of compromised streams
35Immediate Countermeasures
● Recommendations for exit relay operators
○ Don’t use Google’s 8.8.8.8
○ Use ISP’s resolver
○ Run their own resolver with QNAME minimization
36Long-term Solutions
● Add confidentiality to DNS
○ T-DNS (Zhu et al. Oakland’15)
● Improve website fingerprinting defenses
37Contributions
Discovered that DNS exposes Tor users’ behavior to more adversaries than
previously thought
38Contributions
Discovered that DNS exposes Tor users’ behavior to more adversaries than
previously thought
Discovered that Google gets to learn a lot about Tor users’ online activity
39Contributions
Discovered that DNS exposes Tor users’ behavior to more adversaries than
previously thought
Discovered that Google gets to learn a lot about Tor users’ online activity
Created proof-of-concept deanonymization attacks that demonstrate how DNS
can make website fingerprinting attacks more precise
40Contributions
Discovered that DNS exposes Tor users’ behavior to more adversaries than
previously thought
Discovered that Google gets to learn a lot about Tor users’ online activity
Created proof-of-concept deanonymization attacks that demonstrate how DNS
can make website fingerprinting attacks more precise
Performed simulations at Internet-scale in order to understand how our attacks
could affect real people
41Contributions
Our work compels researchers to continue exploring how to make DNS more
secure
42Fin
● Paper, data, code, and replication
instructions: https://nymity.ch/tor-dns/
Nick Tobias
● Contact: laurar@cs.princeton.edu
Laura Benjamin Philipp
43