A Lightweight Tool for Detecting Web Server Attacks
Magnus Almgren, (cid:0) Herve´ Debarand MarcDacier
Global SecurityAnalysisLaboratory,IBMResearch,Zurich ResearchLaboratory
CH-8803 Ru¨schlikon,Switzerland
(cid:1) deb,dac
(cid:2)
@zurich.ibm.com
Abstract
Wepresentanintrusion-detectiontoolaimedatprotect-
ingwebservers,andjustifywhysuchatoolisneeded. We
describeseveralinterestingfeatures, suchastheabilityto
runinrealtimeandtokeeptrackofsuspicioushosts. The
design is flexible and the signatures used to detect mali-
cious behavior are not limited to simple pattern matching
ofdangerouscgiscripts. Thetoolincludesmechanismsto
reducethenumberoffalsealarms. Weconcludewithadis-
cussion of the information gained from deploying the tool
atvarioussites.
1 Introduction
Intrusion-detectionsystemsaimatdetectingattacksagainst
computersystemsandnetworks,oragainstinformationsys-
tems in general. It is difficult to provide provably secure
informationsystemsandtomaintaintheminasecurestate
for their lifetime and duration of utilization. Sometimes,
legacyoroperationalconstraintsdonotevenallowthecre-
ation of such a fully secure system. Therefore, intrusion-
detection systems have the task of monitoring the usage
ofsuchsystemstodetecttheapparitionofinsecurestates.
Theydetectactivemisuseandattempts,eitherbylegitimate
users of the information systems orby external parties, to
abuseone’sprivilegesorexploitsecurityvulnerabilities.
Asweb serverscanberegardedastheelectronicfront
door of a company, they are the most prominent target of
attacks. Simplyput, thereareseveralwaystobreakintoa
web server host [14]. They can be summarized in attacks
thattarget
(cid:3) theoperatingsystemandservicesotherthantheweb
server. In this paper, we assume that the other ser-
vicesareadequatelyprotected,orthatthemonitored
computerservesonlyasawebserver;
(cid:3) thewebserverandweaknessesininstalledprograms
executedontheserver,whereweconcentrateonscripts
usingcgi,thecommongatewayinterface.
(cid:4)
In view of the multitude of vulnerabilities associated
withthewebserver,wewillpresentanintrusion-detection
toolfocusingonthisserviceonly. Thistoolhasseveralin-
teresting features that will be introduced in the following
sections. In Section 2 we present a well-known vulnera-
ble cgi program to show how easily some of the attacks
canbedeployed,andthenwelookatotherprogramsavail-
able on the market. In Section 3 we present the require-
mentsimposedonourwork, followedbySection4where
wedescribe thedesign concepts. InSection5, wediscuss
whatwehavelearnedfromdeployingthetoolatrealsites.
Thisdiscussionconcernshowthetoolhasworkedwithre-
gardtoimplementationissuesaswellaswithregardtothe
conceptspresentedinSection4. Wealsoincludeadiscus-
sionoftheattackpatternsdiscovered. Section6pointsout
where the tool will benefit the most from improvements,
andSection7concludesthearticle.
Note that this tool is not a substitute for careful web
server administration. Of course, vulnerable cgi scripts
shouldberemovedfromtheserver,andpermissionstight-
ened on sensitive files. If these precautions are not taken,
penetrationwilloccurandthistoolwillnotpreventit. Nev-
ertheless, this tool provides the web server administrator
with a wealth of informationonthe interest its site gener-
ates,andallowedustoobservethebehaviorofattackerson
severalwebservers.
2 Background
2.1 Example:thetest-cgiprogram
Themaingoalofourtoolistodetectattackattemptsagainst
cgiprogramsinstalledattheserver.Thisisofparticularin-
terestconsideringthatanumberofweb-servervulnerabili-
tiesarerelatedtothedefault,out-of-the-boxinstallationof
theserver. Letustakeoneexampleofthiskindofvulner-
ability[9]. TheNCSAandApachewebserverscomewith
a program called test-cgi. It is used to check whether
thewebserveriscorrectlysetupforrunningcgiprograms.
Once the server is up, a careful administrator should re-
movethe program, but the script is often left on the com-
Currente-mailaddress:Magnus.Almgren@stanford.edu
puter[6].
1of14Thetest-cgiprogramlistsafewvariablesintheen- Swatch[7]analyzesUNIXsysloglogfilesinasimilarway
vironmentpassedtoit. Asitwasoriginallydesignedtobe asourtool,bygroupingsimilarentriestoautomateprocess-
usedonlybythesystemadministrator,nocheckofthein- ing.
put is made. To run the program, one simply types in the CyberCopserver[10]isacommercialintrusion-detection
locationfieldofthebrowser:1
tool formerly known as WebStalker. This tool includes
http://vulnerable.host.site/cgi-bin/ functionalitiesformonitoringactivityonawebserverbased
test-cgi/ExtendedPath?QueryStr on a policy defined by the server’s operator, but does not
Theprogramthenliststhevalueofthequerystringaswell providelogfileanalysis.
asthevalueoftheextendedpath,amongotherthings. The Afterevaluatingthetools,weidentifiedseveralmissing
problem arises when a user enters a wildcard (*) as the features.3 Some of these tools have some knowledge re-
value of the query string. The script then actually prints latedtowebserverattacks,butothersdonotevensupport
thecontentsofthecgi-bindirectory.2 Ifamalicioususer theencodingschemeforhexadecimalcharactersdefinedin
seesthecontentsofthisdirectory,hemightobtaininforma- HTTP (as specified in [1]), which means an attacker can
tionaboutthepresenceofothervulnerableprogramsandis easily avoid detection. The language available to express
abletolaunchdirectedattacksagainstthem. thesignaturesislimitedandrestrictedtopatternmatching.
Although this is a well-known vulnerability and later Therearemethodstofilteroutfalsealarms,suchascancel-
versionsoftheprogramhavebeenpatched,manyattackers ingalleventsfromcertaindomains,butitwouldbeuseful
will still check whether the earlier version ofthe program to be able to define filters based on other properties. Au-
is present and use it to gain additional information about tobuse allows the specification of a defined threshold per
thesystem. Thismayleadtoafuturebreak-in. Byrunning host, which allows reports to be suppressed until a given
the monitor on the host, the probe for test-cgi will be hosthasperformedseveralattacks, butthereisnodistinc-
detectedandthesystemadministratorwouldbewarnedof tionoftheseverityofreceivedevents.
theexistenceofthevulnerableprogram. Theservercanbe
takenoff-linebeforeamoreseriousattackisreceived. 2.2.2 Network-basedintrusion-detectiontools:Network-
basedintrusiondetectionsystemsdetectintrusionsbysniff-
ing packetsfrom the networkand applying a setof signa-
2.2 Relatedwork
tures. Examples of this family of tools include Network
Therearemanyprogramsavailabletoprotectasystemfrom FlightRecorder[13],Bro[11],RealSecure[8]orNetRanger
intrusions,butfewtoolsexistthatspecializeintheanalysis [3]. These are general-purpose intrusion-detection tools
of web server log files. A representative, yet not exhaus- and can look for many additional, not web-server-related,
tive,listoftoolsrelatedtoourapproachfollows. Formore vulnerabilities.However,forweb-relatedattacks,theyhave
information,werefertheinterestedreaderto[4]. thefollowingshortcomings:
2.2.1 Host-basedintrusion-detectiontools:
WWWstat [5] is mainly a program to collect statisticsof
thewebserverusage. Thisprogramdoesnotperformintru-
siondetectionperse,butitsoutputcanbeusedformanual
intrusion-detectionpurposesbycheckingforabnormalus-
agestatistics.
Autobuse[15]isaframeworkforanalyzinglogfilesfrom
firewalllogsand webserverlogs. It parseslog entriesfor
known attacks and reports them by several mechanisms,
suchasemail.
Logscanner[16]isaframeworkforanalyzinglogfilesin
whichfunctionscanbeincorporated. Itautomaticallycon-
tactsaresponsiblepersonifnecessary,anditfeedsthelogs
intofunctionsdevelopedby theuser. Thedevelopmentof
these functions is considered equivalentto developingthe
signaturespresentedinSubsection4.2.2.
1TheExtendedPathandtheQueryStringaretwoargumentsthatcan
beprovidedtotheinvokedcgiscript.
2Moreaccuratelyput,itshowsthecontentsofthedirectorywherethe
fileislocated.
(cid:3) Smallnumberofsignatures.Owingtothewire-speed
operationmandatoryforasniffer,thenumberofsig-
natures cannot be large and the operations on these
signatures cannot be complex. In most cases, these
toolsarelimitedtosimplestringmatching.
(cid:3) DependenceontheimplementationoftheHTTPpro-
tocol.ThesniffermustcorrectlyimplementtheHTTP
protocoltoextractthepacketpayload andapplythe
signature.Becauseofefficiencyconstraints,lessfre-
quent usage ofthe protocol, such as %encoding, is
notalwaysimplemented(evenifitistechnicallyfea-
sible).Moreover,differentwebserversmayinterpret
theHTTP protocol in differentways, and this inter-
pretationmayhaveanimpactonthevulnerability.A
sniffercannotcontainallthepossibleinterpretations
oftheprotocol.
3Notall programs lack allof thefunctionality describedbelow, but
noneofthemhadeverything. Notethatthemainobjectiveofthesetools
maynotbetodetectwebserverattacks.
2of14(cid:3) Dependence on standard network ports. In many
sniffers,thestandardwebport(80)ishard-codedfor
thewebattacksignatures. Thus,awebserverlisten-
ing on ports 8080 or 8888 would not be monitored.
Eventhoughitisfeasibletomonitormanyports,the
costofdoingsoisoftenprohibitive.
(cid:3) Lackofsessionunderstanding.Thesignatureisoften
comparedtotheincomingrequest. Thesnifferdoes
notkeeprecordingthesessiontoevaluatethe status
codeandthenumberofbytestransfered. Again,this
istechnicallyfeasible,butexpensive,andnotdonein
practice.
(cid:3) Encryption.ThesetoolscannotmonitorSSL-encrypted
orIPSEC-encryptedsessions.
(cid:3) Evasive action. There are a number of techniques
to evadedetection [12] by careful crafting of the IP
packets.
(cid:3)
hackers,andassuchbethesubjectofattacks,which,even
ifunsuccessful,consumenetworkbandwidthandserverre-
sources.
Insummary,thisapproach,althoughtheoreticallysim-
ilar to our monitor, would in practice allow only limited
coverage, and would not offer the most advanced correla-
tioncapabilitiesofourtool.
2.2.4 Summary:Overall,wefoundaneedforatoolwrit-
ten explicitly to detect attacks against the web server. As
stated, the server is becoming ubiquitous in the computer
infrastructureandthusitisimportanttohavesufficientsu-
pervision. In Section 3 we present the main concepts we
considerparticularlyimportantforsuchatool.
As a side effect, this tool, being used specifically for
detecting web serverattacks, willnot be able to detectat-
tacksagainstotherservicesoragainsttheoperatingsystem
supportingtheserver.
3 Specification of ourapproach
Switchedenvironment.Thesesniffersdonotperform
adequately in switched environments. In this case,
After having evaluated the programs presented in Section
thesnifferneedstobelocaltoeachmachine,andthe
2.2,wehadaclearnotionofthedesiredfeatures,namely
cost of duplicating the interpretation of IP packets
(OS+sniffer)isprohibitive.Inaddition,webservers
heavily use optimization techniques, such as direct
filesystemaccessfromtheTCP/IPstack,thatmaybe
incompatiblewithproperoperationofasniffer.
Given their versatile approach, these tools present an
alternativetoourmonitor,andassuchhaveafewwebsig-
natures. Theydodetectthemostsimplecgi-script-typeat-
tacks,butarenotcapableofperformingtherangeofchecks
ourmonitorprovides.
2.2.3 Decoymethods:Recentlyinterestinhoneypots,a.k.a.
the decoy approach, has been increasing. A decoy in this
case is a script that has the same name as a vulnerable
script,butsimplylogstherequest. Thisapproachprovides
a similar level of warning as the network-based intrusion-
detectiontoolsdo,i.e.notificationthatsomesimplecgiat-
tackhasbeenattempted.
This approach is limited by the number of vulnerable
scriptstheserveroperatoriswillingtoinstallandmaintain.
Furthermore,moresubtleattacks,suchas%encoding,di-
rectory tricks, or repeatedrequests, do notshow up in the
operator’slog.
Finally, there is the problem of deciding what such a
script should return to the user. In our opinion, the best
responsetoamaliciousrequestis‘‘404 document not
found’’. Givinganotheranswer,suchasawarningmes-
sage, mayexposethesitetofurther scrutiny,uptodenial-
of-serviceattacks, inretaliation. Forautomatedscans, the
site may be placed on a list of vulnerable sites traded by
(cid:3) Track hosts exhibiting malicious behavior. We as-
sumethattheirintentionsaremaliciousandthatthey
might repeatsuch efforts. By studyingthebehavior
of suspicious hosts, we may deduce new signatures
toaddtothedatabase–aprocessthat,ifautomated,
givesthemonitortheabilitytolearnnewattacksby
itself,thusremovingoneofthemajordisadvantages
oftheknowledge-basedapproachofhavingtoupdate
adatabasewiththelatestexploits.
(cid:3) Flexibleattacksignatures. Thesignaturescheme
shouldallownoviceuserstoputinsimplesignatures
assoonasanattackispublished. Theschemeshould
alsobepowerfulenoughtocraftcomplexsignatures
that allow removal of false alarms. The signatures
should allow detection of more than malicious cgi
scripts.
(cid:3) Modular design. A modular design has many ad-
vantages. First, it allows better verification of the
code, which is important for a security tool. It also
allowsdistribution of the processing on several ma-
chines easily. For example, we could imagine that
in a setup with multiple web servers, such as the
Nagano Olympics, the first modules are distributed
on all servers, and the SUSPICIOUS, TRUSTED and
DECISION modules (see Section 4.2) are shared on
acentral,dedicatedmachine. Italsoallowsremoval
ofoneorseveralmodulesinenvironmentswherethe
alertstheygeneratearenotofinteresttotheoperator.
3of14(cid:3) Easytouse.Installationandremovalmustbesimple,
tolowertheburdenonthewebserveroperator.Easy
signatureinsertionorremovalalsocontributestothat
goal.
(cid:3) Real-time and batch. We of course want the ability
to monitor the web server in real time and receive
alarms immediately when an anomaly is observed.
However, there is also a wealth of web server log
filesarchivedbyadministrators,andwealsowantto
beabletoprocessthese.
(cid:3) Fast. We envision the use of this tool at very large
sites to process huge amounts of data, both current
andhistorical.Performanceisthereforeanimportant
issue.
(cid:3) Filters for false-alarm removal. Insome cases, itis
not wise to have very restrictive signatures. Take
the example of the finger program. A finger re-
quest to the web server can be an attempted attack.
However, security-related sites can have a descrip-
tion of the finger daemon vulnerability (for exam-
ple in file /vulns/net/finger.html). By keep-
ing the more general signature active and removing
only instances of the exact URL, the attack signa-
ture is more generic, but the operator does not see
requests to the normal file. The same is true for at-
tackinghosts. Wewanttomonitorhoststhatareper-
formingauthorizedscans,butdonotwanttohavethe
alarmsreported.
(cid:3) Combinationofalarms. AnURLcancontainseveral
invalid bits, such as requesting a vulnerable script
andasensitivefile,orrequestingavulnerablescript
withasuccessfulstatuscode. Themonitorshouldbe
abletomergeseveralsignaturesintoamorecomplex
one.
Inprinciple,theattacksweareinterestedincanbedi-
videdintofourareasdependingonthehacker’sintention:
1. Penetrationofthesystem
(cid:3) Vulnerablecgiprograms: Theymightbeexploitable
bymetacharactersorbufferoverflowattacks.
(cid:3) Guessingpasswords:Forexample,considerthecase
of a resource protected by a password, but a user
keepsfailingtoaccessit.
(cid:3)
2. Denialofservice
Guessinginstalledcgiprograms: A usertriestoac-
cess /cgi-bin/prog1, /cgi-bin/prog2, /cgi-
bin/prog3etc.,severalthousandtimes.Thisclearly
isanattacktofindoutwhetherthesitehasanyvul-
nerablecgiprogramsinstalled.
(cid:3) Repeatedaccessestononexistingresources(e.g.bro-
kenlinks).
(cid:3) Repeated accessesto resources that cause serverer-
rors(e.g.protectedfiles).
The reason a host fails to access a document several
thousand times may vary. Even if it is not a hostile at-
tack,anadministratorwouldliketoknowaboutitbecause
each request consumes server resources. If it is a broken
link,itshouldbecorrected,andifitisapoorlyconfigured
robot,thesiteinquestionshouldbeinformed. Thiscaseis
lesscriticalthanthesimilaronesdescribedabove,inwhich
thereismorethanserverresourcesatstake.
3. Legalbutundesirableactivity
(cid:3) Singular/outlandish use of the HTTP protocol:Cer-
tainbehaviormaybeallowedintheHTTPprotocol,
butitmayalsobeveryundesirableanditsuseshould
bequestioned. Inparticular,HTTPspecifiestheen-
codingofanycharacterasanhexadecimalvalue.The
only practical use of this feature for “normal” char-
acters is to evade an intrusion-detection system and
thereforeourmonitorlooksforthis.
(cid:3) Accesstosensitivedocuments: Somedocuments
should not be accessed through the web server be-
causetheircontentisconfidential. Examplesarelist-
ingsofthecgi-bindirectory,configurationfilesof
the web server, and password files. However, peo-
plecanstillattempttorequestthesedocuments,thus
showingapotentiallymaliciousintent.Also,themon-
itorallowsonetoverifythatthesedocumentsaread-
equatelyprotectedbytheoperatingsystem(i.e.are-
questhasa403or404statuscode). Avulnerability
has been published [2] that allowed access to pro-
tectedfilesusingshortfilenamesinsteadoflongfile
names. Themonitorwilldetectasuccessfulrequest
andthereforereportthesecuritybreach.
4. Securitypolicyviolations
Therearetwosidestothepolicyviolationissue. Com-
panies may have two policies, one for accessing internal
documents,theotherforaccessingexternalwebsites.
In the first case, the monitor runs on the internal web
servers, and could verify e.g. that the internal web server
should only be reached by hosts in the internal network.
These hosts must comply with a certain name convention
(suchasibm.com).
In the second case, the monitor analyzes firewall or
proxy logs, and verifies that employeesdo not access for-
biddenexternalsites(e.g.competitors’sites).
4of144 Conceptualdesigndescription
4.1 Monitorinputchannel
To protect the www server, we need to be able to follow
whatkindofinputissenttoit. Asweconcentrateonpro-
gramsexecutedontheserverside,thelogfilescanbeused
toseewhathappens. Thisapproachhasseveraladvantages:
(cid:3) Best source of operation: The log file contains the
exact request that the web server receives, whereas
anothermethod(networksniffer,wrapper)hastode-
composethepacketsandinterprettheresults,which
is both time-consuming and error-prone (e.g. in the
case of adiscrepancybetweenthe interpretationsof
theURL/requestbythemonitorandthewebserver).
(cid:3) Serverportability:Apartfromacustomformat,most
commercial web servers also support the de facto
standardcalledtheCommonLogfileFormat(CLF).
(cid:3)
When the program receivesa new request, it creates a
data structure that encapsulates the log entry. Each mod-
uleperformscertaintestsandaddsmorefieldstothisdata
structure,whichispipelinedthroughallblocks. Eachsub-
sequentblockwillbeabletouseinformationstoredinthe
objectbyapreviousmodule.Thatis,eachblockmerelyag-
glomeratesmoreinformationtotheobjectpassingthrough.
By using this design, new modules can easily be created
andinsertedintotheflowwithoutmajormodifications. In
thefollowing,wewillbrieflyhighlightthemostimportant
conceptsoftheexistingmodules.
Therationaleforthebuildingblocksegmentationisthe
following. The log entry is first parsed and syntax errors
are reported, then the URL is parsed and encoded charac-
tersareanalyzed. AttheoutputofthePARSERmodule,the
logentryhasbeenbrokenupintoitsconstituents,andfor-
matanomaliesreported.ThePATTERNmoduleappliessig-
naturematchingandexitsonthefirstmatch,signalingthat
the request is malicious. If the request is malicious, addi-
tionalsignaturecombinations(COMBINATIONmodule)and
Platform portability: Because itmerely readsa file, consequence(REFINEDmodule)areprocessedifnecessary.
the monitor is very portable between different plat-
Then,theSUSPICIOUSmodulehandlesupdatingandaging
forms. Web servers run on almost any platform in
ofthesuspicioushosts,andtheTRUSTEDmoduleremoves
existence, and therefore portability is an important
allundesiredalerts. Finally,theDECISIONmodulehandles
issue.
outside-worldinteraction, suchas warningthe operator or
applyingcountermeasures.
However, it also has drawbacks. Anything happening
insoftwarelayersbelowthewebserverisnotseenbythe
4.2.1 Parser Module: The Parser Module ensures that a
monitor. Furthermore, the server has already sent the re-
valid request has been written by the web server. It reads
sponse,whichmightpreventcertainkindsofreactions,such
therequestandbreaksitapartaccordingtothefieldsofthe
asshuttingdowntheconnection.
CLFlogs(host, date, request, status, etc). It thendecodes
Themonitorcanquiteeasilybecustomizedtousemore
any characters sent in their hexadecimal form (using the
informationthanisavailableintheCLFformat,especially
becausetheExtendedLog Format(ECLF)isverysimilar.
However,wedecidednottobuildthefirstprototype(imple-
mentedinPerl)usingthisformat,asmostofthelogfilesat
ourdisposalwerewrittenaccordingtotheCLFformatand
providedtheadditionalpiecesofinformationpresentinthe
ECLFformatusingseparatefiles.
We choosenottomakethemonitoranapachemodule
forthemoment. Makingitanapachemoduleinsteadofa
logoutputprocessingtoolwould provideneithera perfor-
mance gain nor ease of use. This would only be interest-
ingwhencountermeasuresareapplied,i.e.tostoptheweb
server from answering the request immediately (proactive
monitoring).
4.2 Thebuildingblocksofthemonitor
ThestructureoftheprogramisrepresentedinFigure1. It
iscomposedofseveralbuildingblocks,whichperformvar-
ious checks on the logs. The layered architecture makes
it easy to change the functionality of a certain block and
extendthescopeoftheprogram.
(cid:5)(cid:7) (cid:6)(cid:8) (cid:6) syntax) in the HTTP request [1]. Table 1 shows the
resultaftera typical logentry hasbeen parsed. Ascan be
seen, the data stored also includes the processing of this
module,suchasallhexadecimalencodings.
Ifanyofthese stepsfails, analertis issuedbutthe re-
quest is still passed on to subsequent modules. However,
analysis is limited to the data that could be parsed. This
canresultinreducedorlessaccurateanalysisbecausecer-
tainmodulesrequirecertainfieldstofunctionproperly.For
example, ifthere isnohostidentification(missingfieldin
the log entry), the Suspicious-Hosts Module will not take
thislogentryintoaccount.
4.2.2 PatternModule: ThePatternModuleusestheval-
ues storedbythe ParserModuleto lookfor itsattacksig-
natures,anditstoresanyfindingsintheobject. Thesesig-
natureshavefourfeatures. Theycan
(cid:3) consistofanyregularexpression, allowinga novice
tosimply writethe offendingname ofthe cgiscript
andanexperttouseadvancedfeaturestolimitfalse
alarms;
5of14WEB SYSLOG
BROWSER FACILITY
LOGS
FILE
REAL-TIME
BEHAVIOUR
BATCH
PRINT
REPORTS BEHAVIOUR
COMBI-
PARSER PATTERN REFINED SUSPICIOUS TRUSTED DECISION
NATION
DB DB DB DB DB DB DB
Figure1: Layoutofthemonitorwithallbuildingblocks.
Table1: ResultingdatastructureaftertheParserModulehasfinished. Theactualparsedlogentry
canbefoundin theattributeaccessLog. Alloftheattributesare searchableinlatermodules. At
this stage, two abnormal events have been reported (shown under the horizontal line), and other
moduleswilladdnewentriestothislist.
AttributeName Value
reqId 924182493 1
accessLog hacker.paradise.bad - - [30/Apr/1999:22:25:50 +0200]
"GET /%*7cgi-bin/ph%66?cat%20passwd.txt" 400 -
host hacker.paradise.bad
rfc931 -
user -
date 30/Apr/1999:22:25:50 +0200
reqStr GET /%*7cgi-bin/ph%66?cat%20passwd.txt
status 400
bytes -
method GET
url /%*7cgi-bin/phf
query cat passwd.txt
version 0.9
decodedUrl f
decodedQuery [sp]
suspiciousHexEncoding f
invalidHexEncoding %*7
6of14(cid:3) matchaspecificpartoftheinformationprocessedby
the Pattern Module, e.g. any encoded hexadecimal
characterfoundintherequest,tosimplifythesigna-
turesandreducefalsealarms;
(cid:3) be specified as being a signal of an attack, or their
presencecanbedefinedasbeingmandatoryfornor-
mal requests. For example, usual attack signatures
describe malicious behavior and a match indicates
suchanattempt. Onthecontrary,signaturesenforc-
ing a policy such as allowed IP numbers should al-
waysmatch. Thelackofthemsignifiesanabnormal
event;
(cid:3) belongtoclassesgroupingsimilarsignatures,which
increasesspeed. Tosavetime,theprogramdoesnot
scan for all vulnerabilities if it finds some attacks,
but restricts its search to one match per class. Sig-
natures of similar severity should thus be put into
thesame group. Inpractice, thismeansthatittakes
slightly longer to process valid requests than nefar-
ious ones because for valid requests all regular ex-
pressionshavetobematched.
Forexample,therequestshowninTable1wouldtrig-
gerseveralalarms,dependingonthecurrentlyavailableat-
tacksignatures. Theattempttorunthevulnerableprogram
phf would be highlighted, as well as the status code 400
(bad request). The presence of the presumably sensi-
tive file passwd.txt could also be expressed in a signa-
ture.
The module ensures that the overhead introduced by
regularexpressionsiskeptto aminimum, in particularby
compiling all expressions once at the beginning of execu-
tion.
4.2.3 Combination Module: The Combination Module
allowsthemergingofseveralsignatures,assomeconjunc-
tional conditions are more dangerous than their separate
pieceswouldsuggest.NewalertscanbecreatedbyBoolean
logicofalreadyfoundsuspiciousbehavior,therebyallow-
ingsignaturesspanningseveralattributesoftheCLFlogs.
Anelementaryexampleis
alert for vulnerable script
(cid:9)
alert for access of password file
(cid:10)(cid:12) (cid:11)
As a majority of all requests will be handled successfully
by the server, the monitor will waste resources if it con-
tinuouslylooksforsuccessfulstatuscodes. Thereforethis
combinedattacksignatureshouldbephrasedasfollows:
if vulnerable script
generate new serious alert
4.2.4 RefinedModule: Therelevanceofsomeattacksig-
naturesiscontingentonthepresenceofotherpatterns.This
module allows the creation of attack signatures that will
only be used if a previous signature has been found. This
newsignaturecanbeappliedtoeitherthesamefieldasthe
priorsignatureoranewfield.
Considerthefollowingscenariowherethesamelogen-
trycontainsavulnerablescriptandasuccessfulstatuscode.
(cid:13)(cid:15) (cid:14)
look for successful status code
4.2.5 Suspicious-Hosts Module: The Suspicious-Hosts
Modulecheckswhethertherequestoriginatedfromahost
previouslymarkedasmalicious,thusenablingthemonitor
to keep track of attacking hosts. By studying the new re-
questsandcomparingthemtothedatabaseofthemonitor,
new attack signatures can be deduced. This alleviates the
need of knowing the latest vulnerabilities, because these
will be shown to the monitor by the attackers. This is a
manualprocessinthecurrentimplementation,butcouldbe
automated in the future, at least partially pending review
andcreationoftheappropriateregularexpression.
AstherequestshowninTable1triggersseveralattack
signatures,themonitorwillsavethehostnameinaninter-
nal list. Any other request originating from this host will
thenbereported.
4.2.6 TrustedModule: Eventhoughcarefullywrittenat-
tack signatures limit the number of false alarms, it is im-
possibletocancelthemallbymodifyingtheparametersof
theParserModule. Forexample,aURLcontaininganat-
tackmightbeconsideredasinnocuousifitoriginatesfrom
thesystemadministrator’scomputer.
TheTrustedModuleremovesalertswrittenbythepre-
vious modules if it finds a match for a trusted signature.
Variouslevelsoftrustcanbeassigned tothesignaturesto
reflect what they are allowed to cancel. A signature en-
compassing the name of the system administrator’s com-
putercanbegivenpermissiontocancelallalerts, because
this computer isusedtoprobethe network. Thepath ofa
Linux distribution including the file passwd can give rise
to a signature allowed to cancel the alert of only this file
beingaccessed.
4.2.7 Decision Module: The Decision Module analyzes
the resulting object and decides whether it should be sent
to the management console (file) based on the amount of
maliciousactivitythesuspicioushosthaspreviouslygener-
ated.Thegoalistoprioritizealarmsbydefiningathreshold
for reporting. A single instance of a vulnerable cgi script
requestshouldbereportedimmediately,whereasreporting
accesses to nonexistingdocuments is done only when the
number of requests is associated with a likely denial-of-
serviceattempt.
Eachclass(asdescribedinSubsection4.2.2)hasthree
valuesassociatedwithit:sourcehost-basedthreshold,source
domain-based threshold, and validitytime. Whenthe tool
7of14finds malicious behavior, this module will store informa-
tionregardingthisevent,sortedfirstbythefullhostname,
and then by the class of the signature that was matched.
If the internal threshold of either the fully qualified host
name (www.ibm.com) or part of the domain (ibm.com)
exceedsthethresholdfor thattype ofalarm, theabnormal
event will be reported to the console (file). By consider-
ingboththedomainandexplicithosts,thetoolcanaccount
forattacksgeneratedfromauniversity-likeenvironmentor
service providers, where users do not have the same host
namesateverysession.
Thethirdparameterregulateshowmuchimportancethe
toolplacesonrecentrequestscomparedtoolderones. Each
savedstateages,andifenoughvalidrequestsarereceived
afterasuspiciousrequest,themonitorwillplaceverylittle
value on the latter. This allows users to have some failed
accessestodocuments(brokenlinks), aslongastheyalso
makevalidrequests.
4.2.8 Print Module: The Print Module prints received
objects,ifany.Dependingontheargumentstotheprogram,
itwillprinttheresultingoutputtothesyslogfacility(real-
timeuse)ortheconsole(runninginbatchmode).
5 Lessonslearned
5.1 Sitesusedformonitorevaluation
Theprogramhasbeenusedwithseveralsetsoflogfiles.In
particular,wehavemadeweeklyrunsagainstthefollowing
websites:
(cid:3) Twomedium-sizedcommercialsites:thesmallerwith
approx.
(cid:16)(cid:18) (cid:17)(cid:20) (cid:19)(cid:21) (cid:19)(cid:22) (cid:19)
hits a week, the larger with approx.
(cid:23)(cid:25) (cid:24)
(cid:17)(cid:20) (cid:19)(cid:21) (cid:19)(cid:22) (cid:19)
hits. The diagram in Figure 2 displays the
resultsforthesmallersite;
(cid:3) Various log files from a university, where the size
varied for different web servers, but the two largest
had
(cid:26)(cid:25) (cid:19)(cid:15) (cid:17)(cid:20) (cid:19)(cid:22) (cid:19)(cid:21) (cid:19)(cid:28) (cid:27)(cid:30) (cid:29)(cid:22) (cid:19)(cid:31) (cid:17)(cid:20) (cid:19)(cid:22) (cid:19)(cid:21) (cid:19)
hitsperweek.
Wealsoexperimentedwiththelogssavedfromthe1998
OlympicGamesinNaganosite,whichhasbeenrecordedin
theGuinnessBookofWorldRecordsashavinghadalmost
(cid:8) (cid:23)
(cid:19)" !$ #% (cid:19)(cid:21) &
requests during its 16 days of operation. The
top request rate was
#(cid:21) #’ (cid:19)(cid:15) (cid:17)) (* #+ (
requests per minute, which
iswhatthemedium-sizedserveraboveexperiencedduring
twoweeksofoperation. Welimitedtheteststoonedayof
theOlympicGamelogs,whichcontainedsome
(cid:29)(cid:8) (cid:16)
of environment. Column 3 describes the number of log
entries analyzed during the supervision time, and Column
4 shows the time period spanned. The most interesting
column is the fifth, which contains the number of attacks
found by the monitor. Column 6 has two parts reflecting
thenumberofhoststhemonitorconsideredsuspicious.The
firstpartshowstheresultwhenasignatureforstatuscode
404 (document not found)isincluded,asopposedto
thesecondpart,wherethissignaturewasomittedfromthe
database.
The sites described in the table were deliberately cho-
sen from environments with differentcharacteristics to let
themonitorexperiencevarioustypesofdata.Asthesuper-
visionlastedwelloverayear,thelogfilescontainperiods
ofvacationaswellasnormalsemesteractivity.
The table contains only explicit attacks, such as ac-
cesses to vulnerable cgi scripts or requests for sensitive
files. Thus, all denial-of-service attacks, password guess-
ing attempts, etc., were excluded. This is not to say that
these are not important to monitor, but we have excluded
them from the table because their interpretation is subjec-
tive.Forexample,atoneoftheuniversitysites,ahostmade
morethan
million
requests.
The results of the log file analyses are summarized in
Table 2. The first column contains a site identifier rather
than the actual host name.4 Column 2 specifies the type
4Owingtoconfidentialityconcerns,theactualnameshavebeenomit-
ted.
((cid:8) (cid:19)(cid:31) (cid:17), (cid:19)(cid:21) (cid:19)(cid:21) (cid:19)
unsuccessfuldocumentaccesses.Asthis
host also tried to access the file robots.txt, we suspect
thissetofrequestswasdrivenbyarobot.
In the remainder of this section, we will present spe-
cific findings. Thediagramsarebasedonthetrafficatthe
smaller commercial site (log 1), covering (cid:22) - days of con-
tinuousmonitoring. Duringthese (cid:21) - days,thesitereceived
(cid:24)
(cid:19)(cid:31) (cid:17), (cid:19)(cid:21) (cid:29)(cid:22) (cid:19)
validrequests,ofwhich
(cid:16)(cid:18) #
wereattacks(
./ (cid:19)(cid:31) 01#
(cid:5) ).
We chosethissiteandtimeperiodbecauseitisconsistent
withthefindingsatallsites,andtheresultscanbepresented
concisely.
5.2 Attackfindings
Figure 2showsthetrafficreceivedat thesitelog 1during
thefirst (cid:21) - days. Weekendsappearasthelow-trafficspots
inthecurve.Numbersabovethebarindicatethenumberof
attacks detected for this day, if any. The attacks found by
the monitor are shown separately in Figure 3, where each
barrepresentsthenumberofattacksoneachday.
Most attacks are limited to probes for the most obvi-
ous and most frequent cgi script vulnerabilities, i.e. phf,
test-cgi,andhandler. Aprobeoccursaboutonceev-
ery week, even though these vulnerabilities are quite old
and well known. These three attacks are usually sent in
exactly the order above, and within seconds of each other
(see Table 3). This is very similar to the footprint left by
the mscan scanner (a well-known and widely distributed
hackertool)duringourclosedlabtrials. Thisscanneralso
targets lower-level services, including exploiting vulnera-
bilitiesfoundinstatdandX.
8of144000
3500
3000
2500
2000 1
5
1500 33
12 3 3
3
6
1000
1
3 3 16
500 6 3
0
1 3 5 7 9 11 13 15 17 19 21 23 25 27 29 31 33 35 37 39 41 43 45 47 49 51 53 55 57 59 61 63 65 67 69
Days
(since supervision started)
edaM
stseuqeR
fo
rebmuN
As the malicious traffic is far smaller than the
normal traffic, all days have been marked with
a number, signifying the alarms raised by the
monitor on that particular day.
Normal Traffic
Figure2: Alltrafficatacommercialsiteisshown.
Table2: Logfilesusedtotestthemonitor.
ID Type Entries Time Attacks No.ofsusp. hosts
(indays) with404 w/out404
log1 commercial
#’ (cid:19)(cid:21) ((cid:15) (cid:17), (cid:19)
(cid:23)
(cid:16) #% (cid:19)(cid:25) (
(cid:24)
(cid:26) #(cid:21) (cid:17)
(cid:23)(cid:21) (cid:23)
(cid:29) (
(cid:24)
Nagano
log2 Olympics
(cid:29)(cid:8) (cid:16)(cid:18) (cid:17)+ #’ ((cid:22) (cid:19)(cid:31) (cid:17)
(cid:23)
(cid:16)
(cid:24)
#
(cid:24)
((cid:21) ((cid:15) (cid:17)
(cid:23)(cid:25) (cid:24)
(
-
(cid:19)(cid:22) (cid:19)
log3 commercial
(cid:29)(cid:15) (cid:17)+ #(cid:21) #
(cid:24)
(cid:17)2 (cid:16)
(cid:21) -
(
(cid:23)(cid:21) (cid:23) -
(cid:16) #3 (cid:16)4 (cid:17)(cid:20) ((cid:22) (cid:29)
(cid:23)
(cid:16)(cid:18) (cid:17)5 (cid:16)(cid:21) (cid:16)(cid:21) (cid:26)
internal
log4 commercial
(cid:17), (cid:26)(cid:25) (cid:19)(cid:22) (cid:29)(cid:31) (cid:17)
(cid:24)
#
(cid:24)
(4 (cid:26)(cid:25) (cid:19) #(cid:21) # #(cid:21) (cid:17)
-
(cid:19)(cid:21) (cid:29) #(cid:22) (cid:17)) ((cid:8) (cid:26)(cid:21) (cid:29)
log5 university
((cid:22) (cid:29)(cid:22) (cid:29)(cid:31) (cid:17)
(cid:23)
#
(cid:23)
(
(cid:24)
# (cid:16) (cid:26)(cid:18) (cid:17)’ #’ (cid:19)(cid:25) ( ((cid:8) (cid:26)
log6 university (cid:24)
(cid:16)
-
(cid:17), (cid:29)(cid:22) (cid:26)(cid:22) (cid:16) (cid:26)(cid:25) (
-
#’ (cid:19)
(cid:23)
(cid:17)5 (cid:26)
(cid:23)(cid:21) (cid:23) (cid:23)
#
log7 university
#
(cid:23)
(cid:17)) ((cid:18) (cid:16)(cid:21) (cid:16) (cid:29)(cid:8) (cid:26)(cid:25) (cid:19) #
(cid:24)
(cid:26)(cid:25) (cid:19)(cid:31) # (cid:26)(cid:8) (cid:16)
log8 university
(cid:26)(cid:25) (cid:29)(cid:21) ((cid:15) (cid:17) (cid:29)
(cid:23)(cid:21) (cid:24)
(cid:19) #(cid:21) (cid:17)2 (cid:16)
(cid:21) (cid:24)
(cid:29)(cid:21) (cid:19)(cid:22) (cid:19)
log9 university
(cid:29) (cid:17)
(cid:22) (cid:21) (cid:24)
(
(cid:23)(cid:25) - (cid:23)
(cid:26)
-
(cid:19) (cid:26)
(cid:23)
(
Total:
(
(cid:24)
(cid:17)+ #
(cid:21)
(cid:17)
-(cid:22) (cid:23)
(cid:19) (cid:26)(cid:31) (cid:17)
(cid:23)
((cid:18) (cid:16) (cid:26)(cid:25) (cid:29)
(cid:24)
(cid:16)
(cid:23)
(cid:17), (cid:19)
-
(cid:29) #(cid:21) #(cid:22) (cid:17)
(cid:22) (cid:21)
(
6
7years)
9of1418
16
14
12
10
8
6
4
2
0
1 3 5 7 9 11 13 15 17 19 21 23 25 27 29 31 33 35 37 39 41 43 45 47 49 51 53 55 57 59 61 63 65 67 69
Days
(since supervision started)
skcattA
fo
rebmuN
)stseuqer
suoicilam(
Host using the tool cgiScan to perform
the attack.
Unidentified tool
Hosts trying only the three programs: phf,
test-cgi, and handler in a very short time Internal tests of the setup of the WWW
interval. server.
A simple probe
made by hand?
Figure3: Attackpatternasdetectedbythemonitor.
Table 3: Time between selected for three vulnerable pro- torealizeexactlythisfunctionalityautomatically. Asphf,
grams:phf,test-cgi,andhandler. test-cgi,andhandlerareold,well-knownvulnerabili-
ties,5 systemadministratorsmaynotregardthescanasse-
phf test-cgi handler riousiftheydonotconsidertheothertargets.
19:55:13 t+2s t+3s Inrarecases,aseriesofvulnerablescriptsistried(see
18:02:49 t+6s t+7s day
00:54:23 t+1s t+2s
17:36:29 ts t+1s
21:31:43 t+1s t+2s
10:54:06 t+1s t+1s
11:26:36 t+6s t+12s
03:53:27 t+2s t+3s
Otherintrusion-detectiontoolsranonthesamenetwork
segment,butthenumberofalertstheyproduceddidnotal-
lowustoverifythemscanhypothesisbyhighlightingother
scans from the same origin. We are currently working on
correlatingalarmsfromvariousintrusion-detectionsensors
#
and day
(cid:26)
) by an automatic scanner targeting the
HTTPserver. Thedeterminationofthefactthatthescanis
automatic comesfromthespeedat which the requestsare
sent. Theattackinghostalwaystriedatleastoneoftheat-
tackscripts included in thesignaturefile. Therefore, even
ifthemonitorwillmisssomeattacks,itveryseldommisses
theactualhosttryingtheattacks.
In one case (see Figure 3, day
(cid:26)
), we succeeded in
identifying the program used to perform the scans. The
hackerhadextendedthescanner,butthecorewasstillthe
same. Oneoftheseattacksactuallyledthesystemadmin-
istratortoprobetheservertoverifyitssecurity (ascanbe
seenonday
(cid:29)
).
5TheREADMEfileinthescannerpackagespecificallymentionsthird-
worldcountriesasthetargetforphf,becausesystemadministratorsmay
havemoreseriousconcernsthanthisvulnerability.
10of14Theattacksstudiedoriginatedfrommanydifferentcoun-
tries. From onesite, whereoursupervisiononlylasted
#’ (cid:19)
weeks, we detected
#
serious attackers, (cid:24) from the US
and (cid:24)
picious hosts. For example, this allows certain types of
denial-of-serviceattackstobediscovered.
When running the monitor on the smaller commercial
from other countries (Norway, Sweden, Brazil, Ro- site (log 1), we have the following figures for the first 69
mania, Switzerland,Italy,Australia,and Chile). Thefind- days:
ingsshownareconvincingargumentsthatthewebserveris
attacked regularly and that adequate supervision software
shouldbeemployed.
5.3 Evaluationoffeaturestoreducefalsealarms
We found it necessary to have a flexible scheme to can-
cel false alarms. When deploying the monitor at a new
site,someinnocentrequeststriggeredsignatures. Byusing
the additional information available (name of system ad-
ministrator’scomputer, explicit evaluation of installed cgi
scripts,etc)itwaspossibletoempiricallycreatetrustedsig-
naturestocancelthefalsealarms.
Bycarefullycreatingthesesignatures,theperformance
of the monitor was improved. Unfortunately,these signa-
turesarespecifictoparticularsites,andnotportable.
5.4 Evaluationofthesuspicious-hostsconcept
The main disadvantage of a knowledge-basedapproach is
that it only detects exploitsdirected at knownvulnerabili-
ties. Theeffortofkeepinganupdateddatabaseisnontriv-
ial.Thus,oneofthemostimportantfacetsinevaluatingour
toolwastoseewhetheritispossibletolearnaboutnewat-
tacksbytrackingsuspicioushosts.Afteronehosthasmade
one(unsuccessful)probe,itislikelytocontinue.
The monitor caught all hosts attacking the supervised
sitethatusedatleastoneknownattack.Theywereaddedto
the Suspicious-Hosts Module, and all subsequent requests
werereported.
Byanalyzingalertsreportedbythemonitorcontaining
only a suspicious host entry but no attack signature, we
could determine manually whether the corresponding re-
questwasanattack,inwhichcaseweretrofitasignatureto
it. Thisprocesswasmadeeasierbythefactthatmostmali-
cioushostslaunchonlyoneattacksequence,andthennever
returntothesite. Thissequencewassentduringaverylo-
calizedtimeperiod,andalltherequestswereofamalicious
nature(i.e.theywerenotmixedorhiddeninnormaltraffic).
Thus,theoverheadoflookingattheserequestspaidoff.
Oneattackdiscovered,jj,wasfirstconsideredasatypoin
theclientsoftware. Subsequentresearchshowedthatithad
originallybeenreportedinDecember1996.
5.5 Evaluationofthedecision-modulefunctionality
Toallowdetectionofawiderrangeofattacks,themonitor
must save information about previous requests from sus-
(cid:3) Out of
(cid:16)4 (cid:17), (cid:19)(cid:25) (
- distinct host names,
(cid:29)(cid:22) (cid:29)(cid:21) (cid:29)
wereconsid-
eredsuspicious,and
#3 (cid:16)
(
(cid:19)(cid:15) 0(cid:26)(cid:25) (
(cid:5) )reportedtothecon-
solebytheDecisionModule.
(cid:3) Out of (cid:24)
(cid:19)(cid:31) (cid:17), (cid:19)(cid:21) (cid:29)(cid:22) (cid:19)
valid requests, -(cid:22) (cid:5) of the requests
wereconsiderednormal,
(cid:29)(cid:15)
-
0
(cid:5) assuspicious,andonly
(cid:19)(cid:15) 0(cid:19)
- (cid:5) werereported(
(cid:16)(cid:18) #
).
Onlyahandfulofrequestsarereportedandalargema-
jorityofhostsonlymakesuccessful,normalrequests.Hence
the monitor can pursue suspicious activity without using
too many resources on the server. These results are ob-
tainedafteradaptingthetrustedsignaturestothesite.There
is also only a very small number of documents at the site
pointing to nonexistent pages (i.e. broken links resulting
in a 404 status code). If there are manybrokenlinks, the
monitor has to keep track of many more suspicious hosts
becauseeachbrokenlinkaccesscanbethebeginningofa
denial-of-serviceattack.
The signature concerning the status code 404 (doc-
ument not found) is the most expensive one in terms
of number of matches and, hence, information saved. As
can be seen in Table 2, column 6, the differences among
hoststrackedbythemonitorcanbesignificant,sometimes
asmuchasoneorderofmagnitudewiththisparticularsig-
naturepresentcomparedtowhenitisomitted.
Thecurrentimplementationofthetooldoesnoteffec-
tively handle all matches of this signature. Therefore, de-
pendingontheuseofthemonitorandthememoryrequire-
ments,thesignaturefor404 (document not found)
might haveto be turnedoffand possibledenial-of-service
attacksfoundthroughothermeans.
5.6 Evaluationofthereportingfacility
Thereportingfacilityisanhtmlreportgeneratorwhichof-
fers visualization of the data using any web browser. A
samplescreenisshowninFigure4.
Therearethreescreenareas. Thetopareachoosesthe
viewdisplayedinthemiddlearea,inourcasethehostview.
Therearefourviewsavailable:
(cid:3) the simple view, which shows a short list of hosts
withtheattackstheyhavelaunched;
(cid:3) the host view which presents the same information
in a more detailed fashion, allowing the operator to
viewthemoduleswhichhavegeneratedthealarms;
11of14(cid:3) thewarningview,whichshowslistsofhostsforeach
warningclass;
(cid:3) and the URL view, which shows all warnings per
URL.
Thebottomareadisplaysthecompletealarminforma-
tionforthealarmselectedinthemiddlearea.
Figure 4 shows two hosts and the related attacks that
have been detected. For the top host, the monitor reports
severalattemptsagainst vti *scriptsanddirectories. The
attack coming from the second host is an attempt to re-
trievethe/etc/passwdfile(pattern(suspiciousCgi)warn-
ing)usingthephfvulnerablecgiscript(pattern(cgi)warn-
ing). The difference between the suspiciousCgi class and
the cgi class is the position of the matching pattern in the
requestURL./etc/passwdmatchesontheargumentsto
thecgiscript,whereasphfmatchesonthecgiscriptitself.
The beginning of a cluster of cgi requests such as the
onesdescribedinSection5.1isshowninFigure5Thisis
the beginning of more than
(cid:19)
requests for vulnerable cgi
vulnerabilitiesexistingondifferentplatforms.
Thisreportvisualizationtoolhasbeeninuseforacou-
pleofmonthswithinIBM,toallowremoteuserstoinspect
monitorreportsonlogfilesthathavebeensenttous.
5.7 Performanceevaluation
Measurementofthemonitorperformanceindicatesanav-
eragetimetoprocessalogentrybetween
(cid:29)
and msonan
RS/600043Pmodel140200MHz. Similaranalysisonan
IntelPentiumII266MHzrunningLinuxcorroboratesthese
figures. Thelongertheprogramruns,themorestatisticsit
hastokeeptrackof,includingthosefromsuspicioushosts.
Weobtainedthe msfigurewhilemeasuringtheexecution
speedontheNaganologsanalysis,whichranonaslightly
slowercomputer.Thisisanacceptableperformancedegra-
dation.
Thememory requirementismoredifficulttomeasure.
We examined the amount of memory required by the Perl
interpreter for the analyzed logs abovecontaining (cid:24)
(cid:19)(cid:31) (cid:17)(cid:20) (cid:19)(cid:22) (cid:29)(cid:21) (cid:19)
notlowertheresponsetimeobservedfromtheclientside.
These tests have been performed on a local network only,
andthusnetworkdelayisinsignificantintheresponsetime.
Onlesspowerfulmachinesservicingtherequestistheprac-
ticalperformancebottleneck.
6 Areas ofusageand future work
Themainuseofthemonitoristowatchforattacksinreal
time. Itmayalsoberuninbatchmodeonarchivedlogfiles
ifitisimpossibletodeployitattheactualsite.
Itisalsopossibletodeploythetoolattheproxyoratthe
firewallofacompany. Bysettingupthenetworkproperly,
all outbound traffic will pass this point and consequently
beanalyzed. Thus,thetoolcanenforcecompanypolicies,
because the signatures created can detect undesirable and
malicious behavior equally well. This can be used to re-
strict surfing to www sites with dubious contents, as well
as making sure employees do not leave credit card num-
bers and passwords in log files. Attacks originating from
within the companyand directed towards the outside will
bedetectedaswell.
As specified, the monitor concentrates on cgi scripts
and it will not detect attacks against the web server itself
noragainsttheoperatingsystem.
After having analyzed the real data presented in Sec-
tion5.1,wehaveidentifiedthefollowingpossibleimprove-
ments:
requests, and found that the Perl interpreter used about 7
MBforthecoreimageofthePerlprocess.
We are currently running the monitor in real time on
several internal apache web servers running on worksta-
tions,usedforintrusion-detectionresearchandtesting. All
monitors report to a central console via syslog. Irrespec-
tiveoftheoperatingsystem(Linux,AIX,Solaris)andage
ofthemachine,operationwithorwithoutthemonitordoes
(cid:3) The Suspicious-Hosts Module would profit from a
smallbufferofthelastrequestsanalyzed. Thisbuffer
canbesearchedifanattackisdetected. Attacksthat
have no matching signature and are being sent by a
previouslyunknownhostmaybemissed. Inthecur-
rent version, the analysis of the logs must therefore
be rerun. Typically, attacking hosts had very time-
localized requests. This should facilitate the imple-
mentationofthisbuffer.
(cid:3) The Print Module should be able to summarize the
same type of warnings into only one message only
sothataccessestobrokenlinksareprintedonceand
notonemessageperattemptedaccess.
(cid:3) By letting the module check for requests that have
onlybeenprintedbecauseasuspicioushostwasfound,
itcandirectlylistpossiblenewattacks. Thecurrent
versioninvolvessearchingfortheseentriesmanually.
12of14HOST IP ADDRESS
DIRECTORY
DIRECTORY
HOST IP ADDRESS
HOST IP ADDRESS
Figure4: Samplereport
HOSTNAME
Figure5: Samplereport
13of147 Conclusion
The monitor described in this paper has several interest-
ing features. Foremost, it keeps track of suspicious hosts,
whichallowsittolearnofnewattacksbyanalyzingthere-
questssentbythosehosts. Thus,oneofthemajorobstacles
toaknowledge-basedapproachcanbealleviated.
Itallowsthesearchforflexibleattacksignaturesinany
fieldoftheCLFlogs. Bygroupingtheseintoclasses,simi-
larattackscanbegeneralizedunderonenametosavetime.
Italsoallowsdifferentalertstobemerged,anditwillper-
formrefinedchecksifcertainconditionsaremet. Thesig-
natures are not limited to matching simple cgi programs,
butareextendedtodetectionofdenial-of-serviceattacks.
The design of the tool is modular to allow it to be ex-
tended in the future. It is portable between different plat-
forms, and can run in real time. A small subset of all re-
quests is sent to a console for the system administrator to
takefurtheractions. Thenumberofrequestssentnaturally
depends on the web server and the documents, but at one
test site, only
(cid:16)4 #
requests out of (cid:24)
(cid:19)(cid:31) (cid:17), (cid:19)(cid:21) (cid:29)(cid:21) (cid:19)
[3] CISCO SYSTEMS INC. NetRanger – Enterprise-scale,
Real-time,NetworkIntrusionDetectionSystem.1998.
Availablefromthecompany’swebsiteat
http://www.cisco.com/warp/public/751/netranger/netra ds.htm
[4] DEBAR,H.,DACIER,M.,ANDWESPI,A.Towardsatax-
onomyofintrusiondetectionsystems.ComputerNetworks
31, 8 (April 1999), 805–822. Special issue on Computer
NetworkSecurity.
[5] FIELDING, R. wwwstat: Httpd logfile analysis software.
November1996.
http://www.ics.uci.edu/pub/websoft/wwwstat/
[6] GARFINKEL,S.,ANDSPAFFORD,G.WebSecurity&Com-
merce.O’Reilly&Associates,1997.
[7] HANSEN, S. E., AND ATKINS, E. T. Automated system
monitoringandnotificationwithswatch.InProceedingsof
theseventh Systems AdministrationConference (LISA’93)
(Monterey,CA,November1993).
[8] INTERNETSECURITYSYSTEMS,INC.RealSecure.1997.
Internethttp://www.iss.net/prod/rsds.html
[9] MUDGE@L0PHT.COM.test-cgi vulnerability incertain se-
were passed on.
tups.April1996.
This is well within the abilities of what an administrator
http://www.l0pht.com/advisories/test-cgi-vulnerability
cananalyze.
Wehavedeployedthemonitoratseveralrealsites,and
[10] NETWORK ASSOCIATES INC. Cybercop server. 1998.
Availablefromthecompany’swebsiteat
have shown that the concepts described above are sound.
http://www.nai.com/products/security/cybercopsvr/index.asp
Nevertheless, the current implementation may experience
memoryproblemswhentryingtodetectsometypesofdenial- [11] PAXSON, V. Bro: A system for detecting network intrud-
ersinreal-time.InProceedingsofthe7thUSENIXSecurity
of-serviceattacks.
Symposium(SanAntonio,TX,January1998).
The most common attacks affect the three programs
phf,test-cgiandhandler,andareprobablylaunched [12] PTACEK,T.H.,ANDNEWSHAM,T.N.Insertion,evasion,
bythescannermscan. Theseattacksappearedaboutevery anddenialofservice: Eludingnetworkintrusiondetection.
Tech.rep.,SecureNetworks,Inc.,Suite330,12015thStreet
week. Wealsoidentifiedatoolusedtolaunchamoreelab-
S.W,Calgary,Alberta,Canada,T2R-0Y6,January1998.
orate attack. Web servers are probed regularly for weak-
nesses,whichunderlinestheimportanceofhavingadequate [13] RANUM, M. J., LANDFIELD, K., STOLARCHUK, M.,
supervisioninplace. SIENKIEWICZ,M.,LAMBETH,A.,ANDWALL,E.Imple-
mentingageneralizedtoolfornetworkmonitoring.InPro-
ceedingsoftheEleventhSystemsAdministrationConference
References (LISA’97)(SanDiego,CA,October1997).
[14] RUBIN, A. D., GEER,D., AND RANUM, M. G.WEBSe-
[1] BERNERS-LEE, T., FIELDING, R. T., NIELSEN, H. F.,
curitySourcebook.JohnWileyandSons,1997.
GETTYS, J., AND MOGUL, J. Hypertext transfer protocol
–HTTP/1.1.InternetRequestforCommentRFC2068,Jan.
[15] TAYLOR,G.Autobuse.Internet,1998.
http://www.picante.com/˜gtaylor/autobuse/
1997.
[2] CERT COORDINATION CENTER. Microsoft windows-
[16] TUININGA,C.,ANDHOLAK,R.Logscanner.1998.
Internethttp://logscanner.tradeservices.com/index.html
based web servers unauthorized access - long file names.
Available by anonymous ftp from ftp.cert.org, February
1998.
14of14