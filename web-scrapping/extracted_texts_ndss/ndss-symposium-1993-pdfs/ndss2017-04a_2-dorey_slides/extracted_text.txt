Indiscreet Logs: Diffie-Hellman Backdoors in TLS
Kristen Dorey Nicholas Chang-Fong Aleksander Essex
Western University, Canada
NDSS 2017
February 28, 2017Discrete logarithms are “easy” in smooth order groups… if you
know the factorization of the group order.
What if you don’t know the group order? What if it was hidden
somehow?
2Discrete logarithms are “easy” in smooth order groups… if you
know the factorization of the group order.
What if you don’t know the group order? What if it was hidden
somehow?
The discrete logarithm problem could be hard. Or it could be
easy. So which one is it?
What if it was manufactured to be easy, and only the attacker
can tell?
3Outline
What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
4What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
5Exploiting Small and Smooth Order Subgroups
*Valenta et al. in NDSS 2017
Trapdoored
modulus
Hard
Random
modulus
Determine
Group Non-safe
Order prime
groups*
Safe prime
groups
Easy
Easy Discrete Logarithm Problem Hard
6Trapdoor Composite Modulus
7Trapdoor Composite Modulus
Composite Modulus Trapdoor
8Composite Modulus:
Mistake…or trapdoor?
Can’t tell unless you factor modulus
9Vulnerability
The Vulnerability
• Composite DH moduli used in TLS and STARTTLS
• 30+ countries
• 20+ companies
Implications of Trapdoors
• Shared secret recovery
• Passive eavesdropping
• Traffic modification
10What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
11How Is This Possible?
Systematically poor parameter validation by discrete logarithm
implementations
Primality not checked
Why not?
Primality testing is “math fast” but not “Internet fast”
12Chrome Connection
Subgroup of order 3
Not prime Private Key = 1
13What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
14Forcing DHE
DHE used in <1% TLS connections but still (somewhat) widely
supported
Small subgroups allow attacker to compute master secret
“Downgrade” attack to force DHE ciphersuites for TLS 1.2 and below
Downgrade protections in TLS 1.3 prevent this attack
15What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
16Getting Weak Parameters Used
Three attack vectors
1. Drop onto server
Weak DH
Parameters
With Root AccessGetting Weak Parameters Used
Three attack vectors
2. Incorporate into open-source project
PatchGetting Weak Parameters Used
Three attack vectors
3. Install onto network appliance before shipment
Weak DH
Parameters
Company EmployeeWhat is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
20How Many Weak Parameters Did We Find?
43M IPs using HTTPS, 11M supporting DH
Composite Moduli
• 280 IPs in HTTPS
• 272 IPs in IMAPS, POP3S, SMTPS, SMTP
• Private key recoveries up to 42% of lengthHow Many Weak Parameters Did We Find?
*Valenta et al. in NDSS 2017
43M IPs using HTTPS, 11M supporting DH
Composite Moduli
• 280 IPs in HTTPS
• 272 IPs in IMAPS, POP3S, SMTPS, SMTP
• Private key recoveries up to 42% of length
Non-safe Prime Moduli*
• 1.6M IPs in HTTPS
• Private key recoveries up to 50% of lengthWhat is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
23Disclosures
Eyou.net
Companies Solutions
• 56% fixed vulnerability • Change to prime moduli
• 19% in progress • Remove DHE ciphersuites
• 25% unchanged
24What is the vulnerability?
How is it possible?
How do we force DH use?
What are the attack vectors?
How many did we find?
What disclosures did we do?
What can be done to prevent this?
25How Do We Stop It From Occurring?
• Deprecating DH ciphersuites DH
• Verifying DH parameters correctly
• Use named parameters like for ECDHE
• Sign all previously exchanged messages in ServerKeyExchangeTakeaway Points
Composite moduli of unknown order exist on the Internet today
Could be trapdoored moduli allowing man-in-the-middle attacks,
or could just be benign carelessness
We can’t tell and they can’t say
27Thank You!
Questions?
28