Playing Devil’s Advocate:
Inferring Sensitive Information from Anonymized Network Traces
ScottE.Coull∗ CharlesV.Wright∗ FabianMonrose∗ MichaelP.Collins† MichaelK.Reiter‡
Abstract morein-depthanalysisofanonymizationschemesisneeded
(e.g.,[19]).Lackingsuchanalysis,however,thecommunity
Encouraging the release of network data is central to continuestomoveforwardwiththereleaseofnetworkdata
promoting sound network research practices, though the anonymizedusingtheseandsimilartechniques(e.g.,[23]).
publicationofthisdatacanleaksensitiveinformationabout
Inthispaper,weconductsuchananalysisinordertoin-
thepublishingorganization. Toaddressthisdilemma,sev-
formthecontinuingdebateoverthereleaseofanonymized
eral techniques have been suggested for anonymizing net-
network trace data. Specifically, we detail new techniques
work data by obfuscating sensitive fields. In this paper,
to infer sensitive information from such traces, and using
we present new techniques for inferring network topology
thesetechniquesweshowthatcurrentanonymizationtech-
anddeanonymizingserverspresentinanonymizednetwork
niquesmightnotprotectsensitiveinformationaswellasini-
data,usingonlythedataitselfandpublicinformation. Via
tiallythought. Whiletheexistenceofsomeclassesofinfor-
analyses on three different network datasets, we quantify
mation leakage from individual header fields had been ac-
the effectiveness of our techniques, showing that they can
knowledged[19,26,10], theseattacksareoftendismissed
uncover significant amounts of sensitive information. We
as easily mitigated by changes to the anonymization pol-
also discuss prospects for preventing these deanonymiza-
icy. Ourstudydemonstratesthattherearemoresubstantial
tionattacks.
forms of information leakage that inherently compromise
currentanonymizationmethodology. Fundamentally,these
leaksresultfrompatternsthatnaturallyoccurasartifactsof
1 Introduction usefulanonymizednetworkdata.Theabilitytosubvertcur-
rentanonymizationmethodologywithonlypublicinforma-
In order to provide a sound scientific foundation for tion sources provides attackers with a dangerous new tool
some types of research on network systems, it is impera- forpassivenetworkreconnaissance.
tive that trace and log data be made publicly available for Todemonstratethevalidityoftheseattacks,weexplore
verification and comparison of results. Indeed, the lack of the information leaked by the state-of-the-art anonymiza-
publicdatasetshasbeenidentifiedasakeyweaknessincur- tion system of Pang et al. [19] when used under the rec-
rentnetworkingresearch[22],andworkisunderwaytocon- ommendedpolicysettings. Asaconcreteexample,weap-
structalarge,sharedrepositoryofnetworktracedata[23]. plyourtechniquestoanonymizedtracesfromthreedistinct
To protect the privacy of end users and the security networkswithdifferenttrafficmixesandnumbersofhosts.
of the networks themselves, it is clearly necessary to ob- Our results show that sensitive network topology and host
scure certain identifying information (e.g., IP addresses) behavioral information can be extracted from patterns ob-
before it is published. Several methods for such network served in the anonymized IP addresses and port numbers.
trace anonymization have recently been proposed (e.g., Usingthistopologyandbehavioralinformation,alongwith
[19, 26, 10]). The authors of these schemes generally ac- purely public information from search engines and DNS
knowledgeboththedifficultyincreatingananonymization records,weareabletodeanonymizebetween28and100%
schemefreefromallformsofinformationleakage,andthat oftargetedservers. WhilewechoosetofocusonthePang
etal. approach,wealsoshowthatourfindingsareequally
∗DepartmentofComputerScience, JohnsHopkinsUniversity, Balti-
applicable to a number of other recent techniques in the
more,MD,USA;{coulls,cwright,fabian}@cs.jhu.edu
†CERT/Network Situational Awareness, Software Engineering Insti- literature, therebycallingintoquestiontheoverallbenefits
tute,CarnegieMellonUniversity;mcollins@cert.org providedbycurrentanonymizationstrategies.
‡Electrical&ComputerEngineeringDepartmentandComputerSci-
The remainder of this paper is organized as follows. In
ence Department, Carnegie Mellon University, Pittsburgh, PA, USA;
reiter@cmu.edu Section2,wereviewvariousmethodsforanonymizingnet-
1work data, as well as the pragmatic requirements on the pseudonym addresses without the need for a prefix table
resulting data. The primitives used in our inference tech- [10]. The cryptographic approach to anonymization uses
niquesareintroducedinSection3,andtheirspecificusein keyed hash functions to produce consistent anonymized
inferringtopologyinformationandselectivelydeanonymiz- prefix-preserving addresses, thereby allowing for the pub-
inghostsispresentedinSection4. InSection5, weapply lication of several traces with consistent network informa-
our techniques to anonymized network data taken from a tion throughout. The approach of Fan et al. [10] has been
varietyofnetworks,andshowthatourtechniquesareeffec- widely used in several recent systems that provide policy-
tiveindeanonymizinghostsinapassivemannerusingonly basedanonymizationoftracedata. Thesepolicy-basedsys-
publiclyavailableinformation. Finally,wesuggestpossible temsallowfortheapplicationofanyofthetransformations
mitigationstrategiesinSection6,andconcludewithdirec- described above based on the security policy provided by
tionsforfutureworkinSection7. theuser.Onesuchexample,suggestedbyPangandPaxson,
providesamethodfordefiningpolicy-basedanonymization
2 BackgroundandRelatedWork scripts utilizing the Bro scripting language [20]. A differ-
ent approach, called CANINE [25, 26], operates on Net-
Flow [6] data, but limits the abilities of the dataset pub-
Anonymization systems, in general, are designed to ac-
lisher by allowing only for certain classes of anonymiza-
complish three primary goals while providing usable net-
tion on a particular subset of fields. In particular, the CA-
work trace data. These goals, as described by Pang et al.,
NINE’s prefix-preserving anonymization only allows the
are aimed at preventing i) the true identities of specific
use of CryptoPAn, and provides no methods to implement
hosts from being leaked such that an audit trail of user
otheranonymizationtechniques.
activity could be formed, ii) the true identities of internal
Ofcourse,whiletheaforementioneddefinitionssuggest
hosts from being leaked such that a map of supported ser-
various ways in which network data may be sanitized, the
vices can be constructed, and iii) the leakage of specific
use of anonymization techniques in practical network re-
securitypracticeswithinthepublishingorganization’snet-
search forces the anonymization systems to adhere to sev-
work [19]. Several methods of data obfuscation are uti-
eral requirements with regard to the resulting data. Here,
lized in practice to achieve these goals [2, 20, 26]. De-
we attempt to summarize what appears to be a minimum
structionofinformationinafield(e.g.,byoutrightremoval
set of requirements that show up repeatedly in networking
from the dataset) is often used to anonymize the payload
research.
fields of packet traces. Fixed transformation provides a
single pseudonym value for all values of the field. Vari- One of the most obvious and intuitive requirements is
abletransformationallowsfordifferentpseudonymvalues that the network and hardware addresses provided within
based on the context of the field. One example of vari- thetracedatabeconsistentlyanonymized,withinandpos-
abletransformationistoreplaceanIPaddresswithdifferent sibly across traces. Several areas of research (e.g., traffic
pseudonymsbaseduponthetypeofapplicationlayerproto- matrix estimation [5, 11, 21, 34], characterization of con-
col, such as HTTP or SMTP. Typed transformation allows nection and packet arrival processes [15], and other work
forasinglepseudonymvalueforeachdistinctvalueofthe thatrelyoncountingthenumberofdistincthostsinatrace
originalfield. Prefix-preservingaddressanonymizationisa over some period of time [17, 16]), require that metrics
versionoftypedtransformation. be evaluated on a per host, or per network basis. Without
Therehavebeenseveralattemptstoprovideanonymiza- consistent anonymization, these metrics could be applied
tion techniques appropriate for network trace data. The onlytoeachindividualtrace,ratherthantothedatasetasa
TCPurifytool,forexample,implementsthedestructionby whole.Assuch,theresultingdatawouldbeoflittlevalueto
randomizing IP addresses, and removing packet payloads researchersinsearchoflarge,realistic,datasets—indeed,
[28]. By randomizing the addresses, TCPurify provides themainimpetusbehindthecurrenttrendtowardsmaking
protection for the true identity of hosts, but also destroys more anonymized datasets available in the first place. For
useful network prefix information. TCPdPriv uses another the remainder of this paper, we refer to this requirement
approachknownasprefix-preservinganonymizationtopro- onanonymizeddataasthepseudonymconsistencyrequire-
vide typed transformation of the addresses, whereby the ment.
longestcommonprefixeswithinthetracedataaremapped Similarly, while payload destruction has been standard
tothesamepseudonymprefix[27].Theprefixtableusedby practice in providing privacy, the transport, network, and
TCPdPriviscreatedonapertracebasis,andthereforeitis linklayerheaderstypicallyremainintact. Useofheaderin-
likelythataparticularhostwillmaptodifferentpseudonym formationremainscentraltoprovidingaflexibledatasetfor
addressesindifferentnetworktraces. use in many areas of fundamental network research (e.g.,
Recently,Fanetal.developedacryptographicapproach, theeffectsofpacketlossandreorderingonTCPdynamics
known as CryptoPAn, for the creation of prefix-preserving [14,13,1,30,32]). Toremainappealingtothenetworkre-
2Pangetal. CANINE TCPdPriv TCPurify
Transformation
Destruction (cid:88) (cid:88) (cid:88) (cid:88)
FixedTransformation (cid:88) (cid:88)
VariableTransformation (cid:88) (cid:88) (cid:88) (cid:88)
TypedTransformation (cid:88) (cid:88) (cid:88)
Requirementsmet Examples
PseudonymConsistencyRequirement (cid:88) (cid:88) (cid:88) [11][21][34][15]
HeaderRequirement (cid:88) (cid:88) (cid:88) [13][14][1][30]
TransportProtocolRequirement (cid:88) (cid:88) (cid:88) (cid:88) [17][16]
PortNumberAssumption (cid:88) (cid:88) (cid:88) (cid:88) [12][24]
Table1.Summaryofanonymizationtechniquesandthecorrespondingrequirementstheymeet
searchcommunity,theanonymizationapproachmustthere- anonymized addresses that share a prefix with the true ad-
forerespectthisrequirementforheaderinformation,which dress. In fact, Brekne et al. recently demonstrated how
we herein refer to as the header requirement. In addi- activeprobingattackscanbeusedtosystematicallyunder-
tion, records corresponding to transport layer traffic must minetheCryptoPAnanonymizationscheme[4,3].
be present within the dataset to facilitate studies on round Pangetal.,however,onlyuseCryptoPAntoanonymize
trip times, reassembly, and fragmentation. This minimum addressesexternaltotheenterprisewherethetracewascol-
amountoftransportlayertrafficissubsequentlyreferredto lected. Toanonymizeinternaladdresses,Pangetal. break
asthetransportprotocolrequirement. thedependencyacrossbitsbyanonymizingthesubnetand
Finally,theabilitytouniquelymapwell-knownapplica- host portion of the addresses as independent blocks using
tionlayerservicestotheirconstituentportnumbersisoften a pseudo-random permutation. Although the separation of
used in practice for protocol classification schemes (e.g., theanonymizationintotwoindependentpermutationsmay
[12, 24]). While the requirement that port numbers faith- still lend itself to attacks where the adversary learns the
fully map to their related well-known services may seem deanonymizedhost’strueaddress, onlythathost’sspecific
onerous,wenotethattherearestillmanywaystoinferthe subnetiscompromisedinthiscase;thatis,noinformationis
correctservicebeingofferedfromanonymizedordestroyed discoveredaboutotherhostmappingsandsubnetpermuta-
portnumbers. Recentresearch, forexample, hasindicated tionsfromthissingledeanonymization.Amoredetailedre-
that application layer services can be accurately identified viewoftheCryptoPAnweaknesscanbefoundinAppendix
throughtheuseoftimingandsizeinformation[31],aswell A.
as the unique behaviors of the application layer protocols
[9, 18, 7]. The ability to map port numbers to services is 3 Primitives
subsequentlycalledtheportnumberassumption.
A cursory examination of anonymized network data Thedeanonymizationtechniqueswedevelopinthispa-
repositories, such as CRAWDAD [8], reveals that these per are based on a few simple primitives. These primi-
requirements are frequently relied upon in practice. Of tives, with the exception of Subnet Clustering, were first
all the trace anonymization techniques suggested to date proposed by Xu et al. [33] to provide summary informa-
[28,27,25,19],wefocusonwhatwebelievetobethemost tion about the traffic at backbone routers. We apply these
comprehensive approach, namely that of Pang et al. [19]. techniques to determine the statistically significant values
Webelievetheirapproachbestmeetsthepragmaticrequire- withinthenetworktracedata.Inaddition,wealsoapplyour
ments outlined previously, and is arguably the most flexi- ownSubnetClusteringtechniquetoinferthesubnetsofnet-
bleinsatisfyingtheprivacyofpublishingorganizations. A worksfromonlytheobservedaddresses. Discoveryofthe
comparison of the anonymization systems, their methods propersubnetsandtheirsizesaidinthepassiveinferenceof
ofanonymization,andtheiradherencetothepragmaticre- topologyfromtheprovidedtracedata. However,unlikeXu
quirementsisgiveninTable1. et al. [33], we apply these techniques to anonymized net-
Additionally, our choice to examine the Pang et al. work traces, and our deanonymization techniques require
anonymization system is further motivated by a weak- additionalanalysisontopofthatprovidedbythesetools.
nessinCryptoPAn[10]. Specifically,theprefix-preserving For the remainder of the paper, we represent network
methodologyofCryptoPAnanonymizesaddressessuchthat data,intheformofpackettracesorNetFlowlogs,asaset
any given bit of the anonymized address is dependent on of connections, C. Each connection c ∈ C is described
all previous bits of the unanonymized address. This de- byafeaturevector(cid:104)c ,c ,...,c (cid:105). Inourcase,k = 4,and
1 2 k
pendence causes a single deanonymization to affect all the features are: c = source IP address, c = destination
1 2
3IPaddress,c =sourceportnumber,andc =destination a behavioral profile, or set of recurring network activities
3 4
portnumber. Severalofourtechniquesemployanalysisof thatbestcharacterizethesehosts. Thesebehavioralprofiles
thenormalizedentropy(H)ofoneormorefeaturesofthe canthenbeusedasameansoffingerprintingvarioushosts
data.Thenormalizedentropyprovidesameasureoftheun- basedontheirbehaviors.Theconceptofprofilingbehaviors
certainty of outcomes for the given feature, relative to the has been examined by others, including Karagiannis et al.
maximumpossibleuncertaintyofarandomvariabletaking andAielloetal.,andhasbeenfoundtobeapracticalmech-
onthesamevalues. Specifically,wedenotetheith feature anismforclassifyinghostsintologicalgroupingsbasedon
acrossall connections in C as C , and treatit as a random thecharacterizationoftheirtraffic[16,17].
i
variable. Then,ifC takesonn > 1distinctvaluesinour To find these behaviors, for each ‘heavy-hitter’ address
i i
data,wecalculateitsnormalizedentropyas x,webeginwithasimplebehavioralprofile:src address =
x. Recall that c is the source IP address of connection c.
1
H(C )=
H(C i) Then, denoting the set of connections with c
1
= x as Cx,
i logn i we reorder the remaining features i such that H(Cx) ≤
i
whereforeachc,theprobabilityP C(C
i
=c i)isthenumber H(C ix +1). Then, for each feature in the set of connec-
ofoccurrencesofvaluec iinfeatureC i,dividedby|C|. tions, C ix =2..4, we look for values of c i whose conditional
probability with the current profile exceeds our threshold
Thus, normalized entropy values near zero indicate a
t, and append that value to the profile vector for further
highly peaked distribution for that attribute, while values
consideration. The algorithm extends these profiles in an
near one indicate a nearly uniform distribution of values.
iterative fashion until no value meeting our threshold can
Given an anonymized dataset, we will use this measure to
be found, or all features have been examined. The output
find a set of hosts within that data whose presence is most
ofthisDominantStateAnalysis(Algorithm 2)foreach
significant—the so-called ‘heavy-hitters’. Intuitively, if a
‘heavy-hitter’IPaddressisasetoffeaturevectorsdescrib-
few IP addresses occur much more frequently than others
ingitsbehavioralprofiles. AfterperformingtheDominant
in the data, then the normalized entropy of the addresses
State Analysis on the source IP addresses, we repeat the
will be low. Because of this fact, we can employ an itera-
sameprocessusingthedestinationIPaddresses.
tivealgorithm,showninAlgorithm 1,toobtaintheset
of the most significant IP addresses in the data. This al-
gorithm works by repeatedly removing very frequent (ini-
SubnetClustering ThesubnetsassociatedwiththeIPad-
tially, of probability > t ) values from the distribution
P dressesfoundinthenetworkdataarenotalwaysmadeavail-
andrecomputingthenormalizedentropyuntilthedistribu-
able,andthuswemustconsideralternatemethodsofdeter-
tionbecomessufficientlyuniform,bringingthenormalized
mining this information. The determination of the subnets
entropy above a given threshold, t . Finding the ‘heavy-
H found in the anonymized data is an important step in the
hitters’thiswayallowsustofocusourlaterdeanonymiza-
creation of network topology maps and the deanonymiza-
tioneffortsonthemostprevalenthostsinthenetworktrace.
tionofhosts,asitallowsustodistinguishthedistinctareas
of the network where the data was collected. Subnets can
Algorithm 1 Find-Heavy-Hitters(Connections C, thresh- be inferred from the set of IP addresses present within the
oldst H andt P) network data using an application of the k-means cluster-
HeavyHitters←∅ ingalgorithm. Notethatthisprocessdoesnotdeanonymize
//ExaminebothsourceIPaddress(C1)anddestinationIPaddress(C2)
the addresses in the trace, but it does take advantage of
fori=1,2do
theprefix-preservinganonymizationtoextractinformation
k←0
C(cid:48)←C abouttheunderlyingnetworktopology.
whileH(C i(cid:48))<tHdo Ana¨ıvesolutionfordiscoveringsubnetswithinthedata
forallc∈C(cid:48)do
istosimplylookforgroupingsofcontiguousaddressessep-
ifPC(Ci=ci)>2−ktP then
HeavyHitters←HeavyHitters∪{ci} arated by large gaps. Of course, an arbitrary cutoff would
C(cid:48)←C(cid:48)\{c} havetobedeterminedtospecifytherequiredgapbetween
k←k+1 the groupings. This gap size would necessarily relate to
return HeavyHitters
a predetermined subnet size, which may not be uniform
acrossallsubnets. Itisthereforelikelythatsuchascheme
would improperly group addresses if a variety of subnet
DominantStateAnalysis Xuetal.alsoproposeanovel sizeswerepresent. Ourapproach,ontheotherhand,isable
approachfordeterminingthemostcharacteristicbehaviors to choose the proper sizes for a variety of subnets without
for a given host, known as Dominant State Analysis [33]. the use of a priori information on the subnets sizes being
We apply this technique to the network traffic associated grouped. To achieve that, we automatically determine the
withtheheavy-hittersfoundasdescribedabovetodevelop best subnets based on the observed data and an initial ap-
4Algorithm2DominantStateAnalysisforHeavy-Hitterx
FinishedProfiles←∅
CurrentProfiles←{(cid:104)x(cid:105)}
i←2
//examineeachfeature,inorderofincreasingnormalizedentropy
whilei≤4do
NewProfiles←∅
forallprofile∈CurrentProfilesdo
ExtendedProfiles←∅
forallc∈Cxdo
ifPCx(C ix=ci|profile)>tthen
ExtendedProfiles←ExtendedProfiles∪{profile||(cid:104)ci(cid:105)}//where||indicatesvectorconcatenation
ifExtendedProfiles=∅then
FinishedProfiles←FinishedProfiles∪{profile}
else
NewProfiles←NewProfiles∪ExtendedProfiles
CurrentProfiles←NewProfiles
i←i+1
FinishedProfiles←FinishedProfiles∪CurrentProfiles
return FinishedProfiles
proximation of the density of addresses within the subnet cesscontinuesuntilthemembershipoftheclustersreaches
throughtheuseofunsupervisedlearningtechniques,inour a steady state. This iterative refinement of the clusters
case,thek-meansalgorithm. makesit possible to accommodate for variable length sub-
Specifically,wetreatIPaddressesas4-dimensionalvec- nets. In particular, at the beginning of the refinement pro-
tors, where each element of the vector corresponds to one cess, theclustersstartinanunoptimizedstatewheresome
octet of the IP address as written in dotted decimal nota- addressesthatresidewithinthesamesubnetappearindif-
tion. To determine cluster membership, we use a modi- ferent clusters due to the inaccuracy of our initial approx-
fied Euclidean distance with bitwise exclusive-OR instead imation. However, as the refinement continues, new clus-
ofsubtractionasourdistancemetric.Thedimensionscorre- tercentroidsarecreatedthatbetterrepresenttheaddresses
spondingtotheoctetsareexponentiallyweightedsuchthat withineachcluster,andtheprocesseventuallyconvergesto-
the left-most octet carries the most weight. This weight- wardasetofstablecentroidsfortheobservedsubnetsinthe
ingensuresthatthehierarchicalnatureofthesubnettingis data. Thisensuresthattheaddresseswithinagivencluster
preservedintheclusteringalgorithm1. allresideinthesamesubnetwithoutrequiringexactinitial
Wenotethatk-meansclusteringrequiresthatthenumber centroidplacement.
ofclustersbespecifiedapriori;however,sincewehaveno
wayofinferringthenumberofexpectedsubnets, northeir
densitywithinthe4-dimensionalspace, wefirstevenlydi- Upon completion, each nonempty cluster represents a
vide each of the octet dimensions into m blocks. In doing subnet in the underlying network, and for each cluster we
so, we make an approximate guess about the length of the calculate its subnet address as the longest common prefix
subnetprefix. Theinitialcentroidsareplacedatthebound- shared by all IP addresses in the given cluster. As with
ariesofthesepartitions. Therefore,wecreatek = md ini- anyapplication of the k-means algorithm, the results must
tialcentroidswheremisthenumberofpartitionsanddis be empirically evaluated to ensure proper selection of ini-
thenumberofdimensionstowhichthepartitioningwasap- tialclusterstoapproximatetheanonymizedaddressspace.
plied. Notice that as we increase m, we allow for greater Inourevaluation,theSubnetClusteringtechniqueachieves
densityofsubnetsbydecreasingthespacingamonginitial > 96% accuracy across all datasets used within this paper
centroids 2. Also, by including or excluding dimensions withoutsignificanttuningoftheinitialclustercentroids.
from the initial partitioning scheme, we can control how
manyoctetsparticipateinthecreationofinitialclusters.
Afterthisinitialstep, weiterativelyrecomputethecen-
We reiterate that the primitives do not actually
troidandthecorrespondingclustermembership. Thispro-
deanonymizeanythingbythemselves;theapplicationofthe
Dominant State Analysis algorithm can reveal typical be-
1For example, using this weighted metric we compute the
distance between the IP addresses 192.168.1.2 and 10.0.0.10 as haviorsforeachanonymizedIPaddressinthetrace,andthe
((192⊕10)∗23)2+((168⊕0)∗22)2+((1⊕0)∗21)2+((2⊕10)∗20)2. SubnetClusteringtechniquecanderivealistofanonymized
2Inpractice,theparametermcanbetunedbasedontheobservedbe-
q subnetaddresses,butmoreworkisrequiredtoinferamap
havioroftheSubnetClusteringoutputtoensureitproperlyaccommodates
thedensityofaddressespresentinthegivendata. ofthenetworkandtodeanonymizehosts.
54 InformationLeakage Inferring the routes taken by observed traffic can be
useful in understanding the interconnection of observation
pointsatthenetworklayer. Tocharacterizetherouteshan-
In what follows, we show that not only can a map of
dled by the discovered routing devices, the subnet cluster-
the network be recovered from anonymized network data,
ingtechniqueisappliedtothesourceanddestinationIPad-
but we are also able to deanonymize hosts in the trace
dressesofTCPandUDPtrafficthattransitthedevices. The
through the use of behavioral profiling. Such successful
unique pairs of source and destination subnets, as well as
deanonymizationprovidesforanewmethodofpassivenet-
thehardwareaddressesoftheotherrouterstowhichtraffic
workreconnaissanceandunderminesthestatedgoalsofex-
is sent, can be used to better understand the routing topol-
istingapproachestoanonymization. Wenotethattheinfor-
ogyofthenetworkinquestion.
mationrequiredtomounttheseattacksfollowstherequire-
Lastly, thenetworklayertopologycanbereconstructed
mentsontheanonymizeddatasetlaidoutinSection2.
byexaminingtheroutersandgatewaysforeachobservation
point,andthehardwareaddresseswithwhichtheycommu-
4.1 Recoveringnetworktopology
nicate. Formally,thenetworkcanberepresentedasagraph
GconsistingofnodesV andedgesE ⊆V ×V.Thenifthe
Network topology can be inferred by first determining hardwareaddressforroutersisassociatedwithsomeother
the locations within the network where each of the traces discovered routing device t, we add an edge e = (s,t) to
werecaptured(i.e,theobservationpoints),thenidentifying E in the graph. Once the topology map is created via this
theroutersateachlocation,andfinallyexaminingthetraffic matchingprocess,theroutescanbesuperimposedusingthe
toinfertheconnectivitybetweenthem. hardware addresses to characterize the actual routes taken
Toassociatetraceswithobservationpoints,wefirstiden- by network layer traffic. This inference can also occur for
tifythenetworksubnetswhicharepresentonthelocalarea linklayertopologyifthenetworktracesprovideARPtraf-
networkwherethetracewasrecorded. Wethenregardtwo fic. In this case, one may logically assume that only the
traces as coming from the same observation point if they IP addresses observed in the ARP packets are members of
have one or more subnets in common. If the anonymized the local link layer network. Therefore, any traffic that is
tracedatacontainsAddressResolutionProtocol(ARP)traf- presentatanobservationpointnotdestinedtoorsentfroma
fic,wecanfindthelocalsubnetsbyperformingsubnetclus- localhostmustbetransitingthatobservationpoint. Specifi-
tering (see Section 3) on the IP addresses in the ARP re- cally,thepathtakenfromhostsinagivenobservationpoint
questsandreplies. WhengivenonlyIPtraffic,subnetssur- totheirgatewayroutercanprovideanapproximationofthe
rounding the trace’s observation point can be inferred by topology, including the presence of switches and bridging
performing subnet clustering on all IP addresses found in devices.
thetraceandtakingthenmostfrequentlyoccurringsubnets Note that to perform this topology inference, the pro-
in the results as the observation point’s subnets. The pa- videddatamustatleastmeettheheaderandtransportpro-
rameterncanbechosentorepresentabestestimateofthe tocol requirements discussed in Section 2. The header re-
numberofsubnetsfortheobservationpoint.3
quirementisnecessarytoretrievetheanonymizedhardware
Next, routing devicescan be identified by the hardware addresses of the routing devices within the topology, and
address used in the link layer headers. For each subnet at therefore datasets that do not meet this requirement, such
each observation point, we examine TCP and UDP traffic as NetFlow data, are not vulnerable to the topology infer-
sentfrom local hosts to out-of-subnet hostsand record the ence attack. The transport protocol requirement provides
destinationhardwareaddressfoundinthelinklayerheader the minimum network traffic from which the inference of
as the gateway for that subnet. Similarly, routers can be networktopologyinformationismade.
found by recording the hardware addresses that appear to
havemultiplenetworkaddressesassociatedwiththemover
4.2 InferringHostBehavior
sometimeperiodδ.Toavoidalsoflagginghoststhatusethe
Dynamic Host Configuration Protocol (DHCP) as routers,
While the inference of network topology information
this time period should be shorter than a typical DHCP
is certainly disconcerting, the anonymization of host ad-
lease. In practice, this has not been an issue in any of the
dressesshouldmakeitdifficulttoaccuratelymapthistopol-
traceswehaveexamined,andwetypicallysetδtobeonthe
ogy to real-world addresses. If, however, the behaviors of
orderofseveralseconds.
theanonymizedhostscanbeuniquelymappedtothebehav-
3Forexample,withaninitialguessofn = 5fortheJohnsHopkins iorsoftheirreal-worldcounterparts,theattackercanbegin
Universitytraceintheexamplebelow,wefindthetoptwosubnetsshare deanonymizingportionsofthetopology.
acommonprefixandbothoccurtwiceasoftenasthethirdmostfrequent
Toinferthehostbehavior,theunique,recurringtrafficto
subnet.Thesimilarityoftheprefixesandthesubstantialdifferenceinnum-
berofoccurrencessuggestthatweshouldinsteadsetn=2. and from a particular host is characterized as a behavioral
6Host SrcIPAddress SrcPort DstIPAddress DstPort H(SrcPort) H(DstIP) H(DstPort)
webserver 128.220.231.207 80 * * 0.0 0.93 1.0
SSHserver 128.220.231.147 22 17.138.176.51 * 0.0 0.0 1.0
webclient 128.220.231.17 * * 80 1.0 0.85 0.17
Table2.Examplebehavioralprofilesobservedinthedepartmentalnetwork
profile. To create these profiles, we take as input a list of Anonymized Dest. Real
k-dimensional feature vectors c = (cid:104)c ,...,c (cid:105) describing address addressH hostname
1 k
a set of connections C. The set of significant source and 128.220.231.207 0.93 simnet1
destination addresses, or ‘heavy-hitters’, is obtained from 128.220.231.50 0.93 skdnssec
theconnectionsinC viaAlgorithm 1. Next,Dominant 128.220.231.168 0.87 spar
State Analysis is applied to the connections c ∈ C con- 128.220.231.121 0.85 -
tainingeachofthesesignificantaddressestodeterminethe
set of dominant behaviors that comprise the given host’s Table 3. Deanonymization of significant Web
behavioral profile. Upon termination, the set of behav- serversinlocalnetworktrace
ioral profiles for each significant address is returned (see
Algorithm 2).
Likethetopologyinferenceattack,ourinferenceofhost
the main campus network. It contains packets from over
behaviorrequiresthatthetransportprotocolrequirementbe
26,000 TCP connections involving 38 internal hosts and
met,aswellasthepseudonymconsistencyrequirementand
more than 1,500 external hosts. The topology inference
portnumberassumption. Inparticular,thepseudonymcon-
techniqueindeedfindsasingleobservationpointwithsub-
sistency requirement allows us to accurately build profiles
nets of 128.220.231.0/24 and 128.220.116.0/26. These
forthehostsinthedata,whichwouldotherwisebedifficult
subnetsarethetwoanonymizedsubnetspresentwithinthe
if their identities in the dataset changed. The port number
trace,whichiscorrectgiventhelocationoftheobservation
assumption simply allows us to easily determine what ser-
point just outside of the departmental network. The infer-
vices a given host offers when building our profiles. Un-
ence technique also finds one router and one gateway that
likethetopologyattack,theserequirementscanbemetre-
aredirectlyconnectedtooneanother,withthedepartmental
gardless of the form that the network data takes. There-
networkbehindtherouter. Theroutesdiscoveredaretrivial
fore, while the use of NetFlow data hampers the topology
consideringthetopologyoftheobservationpoint.
inferenceattackduetoitslackofheaderinformation,itstill
We can also deanonymize many of the web servers
meetsallrequirementsforourbehavioralinferenceattacks
within the departmental network. To find the web servers
andremainsvulnerable todeanonymizationviabehavioral
inthisdatabase,wemustfirstcreateanestimateofthebe-
profiling.
havioral profile for which we are looking. Table 2 shows
examplebehavioralprofilesforthree‘heavy-hitters’,found
4.3 AnExample
viaAlgorithm 1,inthedepartment’snetwork.
Because all the web servers in the trace have behav-
For concreteness, we illustrate the application of the
ioralprofileswithsimilarTCPportsanddestinationIPad-
aforementioned techniques on an anonymized trace from
dresses, we must use the normalized entropy of the desti-
the Johns Hopkins University (JHU) network. In general,
nationIPaddressestodistinguishbetweenthewebservers
deanonymization begins by first identifying an interesting
basedontheirpopularity. Morepopularserverscommuni-
service,andfindinganappropriatehostofferingthatservice
cate with a wider range of clients, and thus have a higher
to deanonymize. The goal is to create a behavioral profile
normalizedentropy(H)fortheirdestinationaddresses. To
querybasedonpublicinformationregardingservicesbeing
find the names of the most popular web servers in the de-
runonthetargethost,theperceivedpopularityofthehost,
partmental network and to estimate their relative popular-
anditspossiblelocationswithinthenetworktopology. De-
ity, we use Alexa.com’s popularity-based search engine.4
veloping this profile often requires the use of public infor-
By counting the number of references made to each host-
mationsources,suchasDNSorwebsearchenginequeries,
name over the first l(= 5) pages of results, we arrive at
tospecifyuniqueinformationaboutthehost.Beyondthat,it
thefollowingorderedrankingofwebservers:(cid:104)simnet1:30,
issimplyamatterofmatchinghostswithinthetracedataset
skdnssec:11,spar:9(cid:105).
thatbestmatchthederivedcriterion.
Therankingsprovidestrongindicationthatthereareap-
The trace in question contains TCP traffic from a sin-
gleobservationpointbetweenadepartmentalnetworkand 4Seehttp://www.alexa.com
7Trace Type Connections InternalHosts Dates Duration
JHU packettrace 2.63e+04 38 Apr2005 24hr
CERT-A NetFlow 1.04e+05 20 Aug2006 4hr
CERT-B NetFlow 1.40e+05 24 Aug2006 4hr
LBNL packettrace 8.71e+05 5976 Oct2004-Jan2005 60hr
Table4.Summaryinformationforanonymizeddatasets
proximatelythreesignificantwebserverswithinthedepart- tiononlytoprovideaformofgroundtruthforouranalysis.
mentalnetwork. Duetotheirpopularity,itisappropriateto Onesolutiontopreventingtheinferenceoftopologyin-
assume that the normalized entropy of the destination ad- formationistosimplypublishNetFlowlogs,adataformat
dresses they service will be nearly one, indicating a large consisting of tuples of transport and network layer infor-
varietyofhosts.Byqueryingthebehavioralprofilesderived mation gathered from packet headers on a per connection
fromthelocaltracedataforawebserverwithadestination basis,ratherthancompletepackettraces. Infact,releaseof
addressnormalizedentropygreaterthanγ = 0.85, weob- anonymized NetFlow data is gaining popularity and there-
tainthelistofanonymizedaddressesshowninTable3. fore it seems only prudent that we validate our techniques
By pairing the ranking of web server addresses in the against both NetFlow and packet trace data. To show the
departmental subnet found via behavioral profile to the viabilityofourtechniquesonNetFlowdata,wealsoevalu-
three hostnames found via the Alexa.com search, we ob- ateadatasetobtainedfromCERTcontainingNetFlowlogs
tainthecorrectmappingbetweentherealhostnamesandthe of two distinct /24 networks taken over four hours on a
anonymized addresses, which are verified by our original, single day. To anonymize this NetFlow data, we apply
unanonymizedtrace. Thismappingisgiveninthelastcol- prefix-preservinganonymizationof addresses (as specified
umnofTable3. Overall,weareabletodeanonymizethree byPangetal.in[19]),removeconnectionsoflessthanfour
ofthesevensignificantwebserversinthetrace(43%),and packetsinsizetocompensateforscanningbehavior,andex-
twoofthethreemailservers(66%). Moreover,thesemap- plicitly remove references to routers and network security
pings have correctly deanonymized one of the discovered devices. Since this is NetFlow data, topology inference is
anonymized subnets to 128.220.247.0/24, thereby reduc- notpossible,butweareabletoapplyourdeanonymization
ingtheuncertaintyoftheremaininganonymizedhosts. techniquesjustasintheLBNLdataset.
To streamline our analysis of these datasets, we parse
packet trace or NetFlow logs and automatically dump all
5 Evaluation
information about the connections (C), the ‘heavy-hitter’
hosts, topology information, and their behavioral profiles
Ourinferencetechniquesareevaluatedonnetworktraces into a relational database for fast and easy querying. The
for three distinct networks, including the Johns Hopkins databasecanthenbequeriedforthefeaturesofthebehav-
network described in Section 4. Table 4 provides a break- ioral profile, the normalized entropy values, specific con-
downofeachdataset. Theanonymizeddatasetprovidedby nection information to deanonymize hosts, etc. Hence, no
Pang et al. [19] is the most diverse, and contains packet activeprobingofthenetworkunderscrutinyisnecessary.
traces that were collected at Lawrence Berkeley National
Laboratory(LBNL)overthecourseofseveralmonths. The 5.1 NetworkTopology
LBNL traces are arranged into 131 individual trace files
anonymized by the system described in [20, 19]. Several ToinferthenetworktopologyofLBNL,weemploythe
networkandtransportlayerprotocolsarepresentwithinthe techniques described in Section 4. Our techniques find
anonymizedtracedata,whichincludeonlytheanonymized 29 distinct observation points with a total of 31 associ-
link, network, andtransportlayerheaders. Payloaddatais ated enterprise subnets. The subnets found through the
deleted, and fields are anonymized per the policy defined SubnetClusteringtechniqueagreedwiththoseprovidedin
in [19]. Pang et al. also remove the packets generated by themeta-data,withtheexceptionofonesubnetwhosesize
routersandcertainsecuritydevicestopreventtheirdiscov- was overestimated, thereby providing 96% accuracy. This
ery. In addition to the anonymized trace data, Pang et al. overestimate appears to have occurred due to an improper
provide meta-data to ensure sound measurement practices. estimate of the longest common prefix computed from a
This meta-data includes the identification of anonymized small number of distinct addresses within the ARP trace
subnets, anonymized gateway addresses for those subnets, data. Interestingly, the anonymization system used to pro-
and corrupt packets. This meta-data is used in our evalua- videprivacyfortheLBNLdatamakesextraefforttomask
8+2
%
$/
1"
0
./-
+,
)*
(’
&
$%
#
!"
(cid:1)
(cid:28)
(cid:31)
(cid:30)
(cid:29)
(cid:1)
(cid:28)
(cid:0)(cid:1) (cid:1)
(cid:2)(cid:3) (cid:4) (cid:5) (cid:6) (cid:7)(cid:2)
(cid:8)
(cid:2)(cid:6)
(cid:9) (cid:6) (cid:4)
(cid:10)(cid:11)(cid:6) (cid:10)(cid:2)
(cid:18) (cid:6) (cid:16) (cid:10)(cid:24)(cid:26) (cid:27)
(cid:12)(cid:13) (cid:14) (cid:15) (cid:13)
(cid:16) (cid:5) (cid:17) (cid:18) (cid:19)
(cid:20) (cid:5) (cid:2)(cid:16) (cid:21) (cid:6)
(cid:10)(cid:25)(cid:7)(cid:6) (cid:10)(cid:25)(cid:16)
(cid:13) (cid:14)
(cid:13) (cid:14)
(cid:4) (cid:20) (cid:22)
(cid:16) (cid:23)(cid:23)
(cid:24)(cid:10)(cid:25)(cid:7)(cid:6) (cid:10)(cid:25)(cid:16)
JHU - Total
JHU - Known
EE.LBL - Total
15 EE.LBL - Guessed CERT.A - Total
CERT.A - Known
CERT.B - Total
CERT.B - Known
10
5
0
HTTP MAIL
Server Type
(a) Uniquenessoftheee.lbl.govsubnet
srevreS
fo
rebmuN
EE.LBL
CERT.A CERT.B
JHU
CERT.B
JHU
EE.LBL CERT.A
(b) Deanonymizationresultsfor3networks
Figure1.Deanonymization
the presence of routing devices by eliminating their traf- servers,wefindsixsubnetsinthedatasetthatmatchthiscri-
fic. Our inference techniques, however, are able to infer teria. Finally, by noting that the ee.lbl.gov server provides
theirpositioningduetothenecessarypresenceofhardware SMTP,HTTP,andFTPservices, wefindonlytwosubnets
addresses in link layer headers. When combined with ad- thatcontainsuchaserver.Bycombiningeachofthecharac-
ditional information—like the placement of hosts and al- teristicsofourtargetsubnet,onlyoneofthesubnetspresent
lowed routes—maps of the network topology provide at- inthedatasetmatchesallcriterion. Inessence, thecombi-
tackerswithinformationonthesecuritypostureofthepub- nation of required subnet size, unique services offered by
lishingorganization. ee.lbl.gov,andthespecificmixofsignificantHTTPservers
fingerprintsthesubnetwithintheanonymizedtrace.
5.2 Deanonymization Since the ee.lbl.gov server provides such a unique mix
ofservices, itisfairlyeasytodetectamongthesignificant
hosts present in the subnet. The two remaining significant
To demonstrate the effectiveness of behavioral profiles
HTTPserversexhibitsimilarbehaviors,exceptwithrespect
in the selective deanonymization of anonymized hosts, we
to the normalized entropy for the destination address di-
provideadeanonymizationoftheHTTPserverfortheBro
mension. Thus, one host serves a wider variety of clients
IDS project [29] and other servers within its subnet, in-
than the other. Due to the nature of the www.bro-ids.org
cluding ee.lbl.gov. We pick these targets as candidates
andita.ee.lbl.govwebserversandtheirrespectivepresence
for deanonymization since public information about these
within web search engines, it seems reasonable to assume
serversisreadilyavailable—andhence, canbeeasilyused
that www.bro-ids.org serves a wider variety of hosts while
tounmasktheanonymization.
ita.ee.lbl.govhasamorenarrowappeal.
We begin by querying DNS records for the addresses
of the Bro web server (www.bro-ids.org) and related hosts Another HTTP server within this subnet handles only
found in public information sources. The results of these a few distinct clients, but serves a large number of con-
queriesshowthatwww.bro-ids.orgresidesinthesamesub- nections overall. These connections carry relatively few
netastheee.lbl.govdomain,whichincludesSMTP,HTTP, packets, thus indicating the presence of a web page or ap-
and FTP services on ee.lbl.gov and HTTP services on plicationthatperformsseveralsmallHTTPconnectionsto
ita.ee.lbl.gov. Knowledge of these services was gleaned retrieve data. Upon inspection of the Google results for
only from Google and Alexa searches, as well as DNS the ee.lbl.gov domain, we suspect this machine might be
recordsfortheee.lbl.govandbro-ids.orgdomains. froggy.lbl.gov. TheFroggysitefeaturesaCGIwebapplica-
Byinferringthesubnetsizefromtheaddressesprovided tion which generates short bursts of HTTP connections as
byDNSrecords,thesetofpossiblesubnetswithinthetrace a function of the CGI usage. Table 5 provides some sam-
dataisreducedtoten/22subnetsoutofthetwentyninetotal ple deanonymization results for various publicly available
subnets(seeFigure1(a)). Furthermore,ifweconsiderthat services, including www.bro-ids.org. The deanonymiza-
the target subnet contains at least three ‘heavy-hitter’ web tions are supposition, as there is no ground truth avail-
9Candidate Search Auxiliary
TargetHost Mappings Criteria Information
www.bro-ids.org 131.243.95.232 CIDRBlock=131.243.0.0/16 Knowledgeof
SourcePort=HTTP HTTP,DNSArecords
ita.ee.lbl.gov 131.243.93.0 (H¯)=(<.05,>.5,>.5) Publicsubnetinfo.
Samesubnetasee.lbl.gov
CIDRBlock=131.243.0.0/16 Knowledgeof
ee.lbl.gov 131.243.94.172 SourcePorts=HTTP,SMTP,FTP SMTP,DNSArecords
(H¯)=(>.1,>.5,>.5) Publicsubnetinfo.
co-locatedw/ita.ee.lbl.gov,www.bro-ids.org
froggy.lbl.gov 131.243.95.168 CIDRBlock=131.243.0.0/16 Knowledgeof
SourcePort=HTTP;samesubnetasee.lbl.gov HTTPprotocol
CIDRBlock=128.3.0.0/16 DNSMXrecords,
lbl.gov 128.3.164.249 SourcePorts=SMTP,finger Mailinfo,
co-locatedw/postalnp.,imap4.,smtp.lbl.gov publicweb/subnetinfo.
smtp.lbl.gov 128.3.164.248 CIDRBlock=128.3.0.0/16 DNSMXrecords,
SourcePort(s)=SMTP Mail,public
postalnp.lbl.gov 128.3.164.57 co-locatedw/lbl.gov,imap4.lbl.gov subnetinfo.
128.3.164.15 CIDRBlock=128.3.0.0/16 Publicwebinfo.
imap4.lbl.gov or SourcePort(s)=IMAP,POP3
128.3.164.194 Samesubnetaslbl.gov
Table5.Sampledeanonymizationsofselectpublicservices
Dataset ObservationPoint DominantSourcePorts
JHU JHU 22(SSH),HTTP(80)
CERT-A CERT-A 20(FTP),21(FTP),25(SMTP),53(DNS),80(HTTP),443(HTTPS)
CERT-B CERT-B 25(SMTP),53(DNS),80(HTTP)
RoutingCore 161(SNMP)
ee.lbl.gov 22(SSH),80(HTTP),123(NTP),
137(WINS),161(SNMP),427(SRVLOC),
515(LPR),524,793,795-800(Unknown)
LBNL
ClientNetwork 22(SSH),25(SMTP),67(BOOTP),68(DHCP),
80(HTTP),137(WINS),138(NetBIOS),139(NetBIOS),
161(SNMP),427(SRVLOC),445(Microsoft-DS),497(Unknown),
548(AppleFilesharing),575:696:878(Unknown)
Table6.Dominantsourceportsforselectedobservationspoints
able,butthesupportingevidenceprovidesconfidenceinour 28.6%to50%forthesignificantHTTPserversinthesub-
deanonymizationresults. netsweexamined. WhiletheresultsforHTTPserversmay
notseemimpressive,considerthatnolevelofdeanonymiza-
FortheJHUandCERTdatasets,weareabletoprovide
tionisexpectedfromtheanonymizeddatasets. Also, con-
a similar method of deanonymization by mapping behav-
siderthatanyserverprovidinguniquepublicservices,such
ioralprofilesoftruehoststotheiranonymizedcounterparts;
asFTPorDNS,wouldobtainsimilardeanonymizationre-
more importantly, we can validate these deanonymiza-
sultstotheSMTPservers.Whiletheseresultsaretroubling,
tions via ground truth. Figure 1(b) shows our overall
we argue that a determined adversary, with the luxury of
deanonymizationperformanceacrossthefourdatasets. For
time,wouldbeabletodeanonymizeevenmoreservers.
each trace, the results show the number of deanonymized
servers for each protocol (“known” or, in the case of Once this deanonymization occurs, the published data
ee.lbl.gov,“guessed”)comparedtothetotalnumberofsig- can be used to characterize the services offered by that
nificantserversforthatprotocol. host. Moreover, if the prefix-preserving anonymization
were based on CryptoPAn, rather than the Pang et al.
Itwasinitiallybelievedthatinformationleakageattacks
model, these deanonymizations would not only affect the
of the kind presented herein were too difficult for an ad-
deanonymized host, but would also reduce the uncertainty
versary to achieve in practice [19]. However, our results
about all other hosts in the dataset and deanonymize the
indicate that behavioral profiling is a plausible method for
neighboringanonymizedaddress(seeAppendixA).
deanonymizingavarietyofnetworktraces.Oursuccessrate
rangedfrom66%to100%forsignificantSMTPserversand In addition to deanonymizing select hosts, we are able
10to characterize the traffic present within the various obser- trusted individuals from the publishing organization itself,
vation points. Table 6 characterizes the protocols within therebypreventinganydirectaccesstothedatabythirdpar-
selectobservationpointsinthethreedatasetsandprovides ties. Whileinefficient,thismethodallowsforbetterprivacy
deeperinsightintothepresenceofimportantserversandthe than is offered by anonymization methodologies currently
generalusageoftheobservationpoints. in use. That said, it may also significantly impede many
typesofresearch.
6 Mitigation
7 ConclusionandFutureWork
Undoubtedly, there are mitigation strategies that could
be implemented by publishing organizations to foil the in-
ferenceattacksdemonstratedinthispaper. Asimplestrat-
In this paper we provide new algorithms for inferring
egy for preventing the creation of network topology maps
sensitive information from network traces that have been
is simply to publish only anonymized NetFlow logs, or to
anonymized using state-of-the-art techniques. Our work
remove link layer headers from packet traces, thereby re-
shows that network topology information can be inferred
moving the hardware addresses of routing devices. Addi-
as an artifact of usable network packet traces, and that be-
tionally,theexclusionofARPtrafficmakesitmoredifficult
haviorsofhostsareanimportantpieceofidentifyinginfor-
todiscoverlinklayertopologyinformation.
mation that can be leveraged to subvert an anonymization
By remapping port numbers, publishing organizations
system. Attheleast,ourevaluationshowsthatselectivere-
hinder the ability of an attacker to directly infer services
covery of sensitive information from anonymized network
offered within the private network and makes the creation
dataisnotasdifficultasoncethought[10,19]. Moreover,
of behavioral profiles more difficult. Note, however, that
obfuscating behavioral and network topology information
methodsdoexisttodeterminethetrueservicebasedonthe
is not a trivial task. Hence, although there are substantial
applicationlayerprotocolbehavior, e.g.,[31,9,18,16,7].
benefitsfromreleasinganonymizeddata,publishersofsuch
Also, because behavioral profiling is less effective when
dataneedtobemorecognizantofthethinlinebetweenthe
similar profiles are shared among a large number of hosts
utilityofthedataandtheprivacyitprovides.
(note, for example, the results for HTTP versus SMTP
servers), it may be possible to improve the privacy of Ourresultsnaturallyraisequestionsastowhatnetwork
the dataset by removing the hosts whose behavior is most trace data, if any, should be released for research. This,
unique. Finally, hiding the true identity of the publishing however,isapolicydecisionthatwebelieveeachnetwork
organizationmakesitmoredifficultforanattackertogather owner must make for himself. The results reported in this
the necessary information to mount the inference attacks papershouldnotbeconstruedasanindicationofouropin-
presented. However, this begs the question as to how dif- ion on the propriety of releasing network data in any par-
ficultitwouldbeforanattackertostillinferthepublishing ticular form. Rather, our goal has simply been to inform
organization. thecontinuingdebateoverthereleaseofnetworktrafficfor
research purposes. It is our belief that the creation of any
It must be noted, however, that these mitigation strate-
overarchingpolicyshouldbeformulatedthroughthecom-
gies destroy the research value of the data to varying de-
binedperspectiveofthenetworksecurityresearchcommu-
grees. For instance, header information and port numbers
nityasawhole.
areimportanttoseveralareasofnetworkresearch. There-
movalofuniquehostsmaydramaticallyaffecttrafficchar- On the technical front, our study underscores the need
acteristicswithinthedataset. Furthermore,hidingtheiden- for a better understanding of the conditions under which
tityofpublishingorganizationscanmakeverificationofre- a particular anonymization method (e.g., prefix-preserving
sultsobtainedfromthetracedatadifficult. anonymization for IP addresses) may provide an adequate
Of course, there are other, non-technical, means of privacy solution for a particular set of network traces. For
providing privacy protection for data publishers. One instance,whilethispaperhasshownthatserversareatrisk
method—employedbydatarepositoriessuchasPredictand ofdeanonymizationthroughbehavioralprofiling,itremains
CRAWDAD [23, 8]—is to impose legal requirements that unclear to what extent the privacy of clients is threatened.
the data will be used appropriately, and that adequate lev- Indeed, if the lack of client privacy turns out to be a seri-
elsofprotectionwillbeputinplaceforaccessingthedata. ous issue, then a prudent course of action is to re-examine
Another possibility is to require that data remain only on which types of transformation are appropriate solutions to
secured servers to which researchers have remote access. theproblem. Aspartoffuturework,weintendtoexplorea
Violations of these requirements, particularly the former, formalframeworkforexaminingthis question, and in par-
canbedifficulttodetect, however. Anevenmorecumber- ticular,forexpressingtheprivacypropertiesofanonymiza-
some approach is to require that analysis be performed by tiontechniquesingeneral.
11Acknowledgments [13] S. Jaiswal, G. Iannaccone, C. Diot, J. Kurose, and
D. Towsley. Measurement and Classification of Out-of-
SequencePacketsinaTier-1IPBackbone. InProceedings
The authors would like to thank Michael Bailey and
ofIEEEINFOCOM,pages1199–1209,April2003.
Patrick McDaniel for their suggestions for improving an
[14] S. Jaiswal, G. Iannaccone, C. Diot, J. Kurose, and
earlier draft of this work. We also thank the anonymous D. Towsley. Inferring TCP Connection Characteristics
reviewersfortheirinsightfulcomments. Thisworkissup- Through Passive Measurements. In Proceedings of IEEE
portedinpartbyNSFGrantCNS-0546350. INFOCOM,pages1582–1592,March2004.
[15] H. Jiang and C. Dovrolis. Source-Level IP Packet Bursts:
CausesandEffects. InProceedingsofACMSIGCOMMIn-
References
ternetMeasurementConference,October2003.
[16] T.Karagiannis,K.Papagiannaki,andM.Faloutsos.BLINC:
MultilevelTrafficClassificationintheDark.InProceedings
[1] F.BaccelliandK.B.Kim.TCPThroughputAnalysisUnder
ofACMSIGCOMM,pages229–240,August2005.
TransmissionErrorandCongestionLosses. InProceedings
[17] P. McDaniel, S. Sen, O. Spatscheck, J. V. der Merwe,
ofIEEEINFOCOM,pages2833–2843,March2004.
W.Aiello,andC.Kalmanek. EnterpriseSecurity: ACom-
[2] M. Bishop, B. Bhumiratana, R. Crawford, and K. Levitt.
munityofInterestBasedApproach. InProceedingsofNet-
How to Sanitize Data. In Proceedings of the 13th IEEE
workandDistributedSystemsSecurity,February2006.
InternationalWorkshopsonEnablingTechnologies: Infras- [18] A.W.MooreandD.Zuev.InternetTrafficClassificationUs-
tructureforCollaborativeEnterprises,pages217–222,June ingBayesianAnalysisTechniques. InProceedingsofACM
2004. SIGMETRICS,pages50–60,June2005.
[3] T. Brekne and A. A˚rnes. Circumventing IP-Address [19] R.Pang,M.Allman,V.Paxson,andJ.Lee. TheDeviland
Pseudonymization. In Proceedingsofthe 3rd IASTEDIn- PacketTraceAnonymization. ACMComputerCommunica-
ternationalConferenceonCommunicationsandComputer tionReview,36(1):29–38,January2006.
Networks,October2005. [20] R. Pang and V. Paxson. A High-Level Environment for
[4] T.Brekne,A.A˚rnes,andA.Øslebø. AnonymizationofIP Packet Trace Anonymization and Transformation. In Pro-
TrafficMonitoringData–AttacksonTwoPrefix-preserving ceedingsofSIGCOMM,pages339–351,August2003.
[21] K. Papagiannaki, N. Taft, and A. Lakhina. A Distributed
AnonymizationSchemesandSomeProposedRemedies. In
Approach to Measure IP Traffic Matrices. In Proceedings
Proceedings of the Workshop on Privacy Enhancing Tech-
oftheACMSIGCOMMInternetMeasurementConference,
nologies,pages179–196,May2005.
pages161–174,October2004.
[5] H.Chang,S.Jamin,Z.M.Mao,andW.Willinger. AnEm-
[22] V.Paxson. StrategiesforSoundInternetMeasurements. In
piricalApproachtoModelingInter-ASTrafficMatrices. In
ProceedingsoftheACMSIGCOMMInternetMeasurement
ProceedingsoftheACMSIGCOMMInternetMeasurement
Conference,pages263–271,October2004.
Conference,October2005.
[23] PREDICT: Protected Repository for the Defense of In-
[6] Cisco IOS NetFlow. http://www.cisco.com/go/
frastructure Against Cyber Threats. http://www.
netflow.
predict.org.
[7] M.P.CollinsandM.K.Reiter. FindingPeer-to-PeerFile- [24] S. Singh, F. Baboescu, G. Varghese, and J. Wang. Packet
SharingUsingCoarseNetworkBehaviors. InProceedings ClassificationUsingMultidimensionalCutting. InProceed-
ofthe11thEuropeanSymposiumonResearchinComputer ingsofACMSIGCOMM,pages213–224,August2003.
Security,pages1–17,September2006. [25] A. Slagell, J. Wang, and W. Yurcik. Network Log
[8] CRAWDAD:ACommunityResourceforArchivingWire- Anonymization: Application of Crypto-PAn to Cisco Net-
less Data at Dartmouth. http://crawdad.cs. Flows. InProceedingsofNSF/AFRLWorkshoponSecurity
dartmouth.edu. KnowledgeManagement,September2004.
[26] A.SlagellandW.Yurcik. SharingComputerNetworkLogs
[9] J.Early,C.Brodley,andC.Rosenberg. Behavioralauthen-
ticationofserverflows. InProceedingsofthe19th Annual forSecurityandPrivacy:AMotivationforNewMethodolo-
giesofAnonymization. InProceedingsofSECOVAL:The
Computer Security Applications Conference, pages 46–55,
Workshop on the Value of Security through Collaboration,
December2003.
pages80–89,September2005.
[10] J. Fan, J. Xu, M. H. Ammar, and S. B. Moon. Prefix-
[27] TCPdPriv. http://ita.ee.lbl.gov/html/
preserving IP Address Anonymization: Measurement-
contrib/tcpdpriv.html.
based Security Evaluation and a New Cryptography-based
[28] TCPurify. http://irg.cs.ohiou.edu/
Scheme. ComputerNetworks,46(2):253–272,2004.
˜eblanton/tcpurify/.
[11] A.Gunnar, M.Johansson, andT.Telkamp. TrafficMatrix [29] V.Paxson. Bro: ASystemforDetectingNetworkIntruders
EstimationonaLargeIPBackbone-AComparisononReal inReal-Time. ComputerNetworks, 31(23-24):2435–2463,
Data. InProceedingsoftheACMSIGCOMMInternetMea- December1999.
surementConference,pages149–160,October2004. [30] R.Wang,G.Pau,K.Yamada,M.Y.Sanadidi,andM.Gerla.
[12] P.GuptaandN.McKeown. PacketClassificationUsingHi- TCP Startup Performance in Large Bandwidth Delay Net-
erarchicalIntelligentCuttings. InProceedingsofHotInter- works.InProceedingsofIEEEINFOCOM,pages796–805,
connectsVII,pages147–160,1999. March2004.
12[31] C. V. Wright, F. Monrose, and G. M. Masson. On Infer- thenabletodeanonymizetheaddress011,asshowninFig-
ringApplicationProtocolBehaviorsinEncryptedNetwork ure2. Inthiscase,thebitsrepresentedbytheshadednodes
Traffic. Journal of Machine Learning Research, Special are now compromised and therefore lose their uncertainty.
TopiconMachineLearningforComputerSecurity, Toap- Theremaining, unknownbitsprovide4bitsofuncertainty
pear,2006.
forthisanonymization,or16validpermutationsforthere-
[32] Y.Xiang,J.-C.Liu,K.G.Shin,andW.Zhao.OntheModel-
mainingaddresses. Inthisexample,asingledeanonymiza-
ingandOptimizationofDiscontinuousNetworkCongestion
tionprovidesan87%reductionintheanonymizedaddress
ControlSystems.InProceedingsofIEEEINFOCOM,pages
space. Thisreductioncanleadtofurtherdeanonymization
2812–2820,March2004.
asthesetofpossiblepermutationsremainingallowstheat-
[33] K.Xu, Z.Zhang, andS.Bhattacharyya. ProfilingInternet
tackertobetterrefinetheirsearchforpublicinformationand
Backbone Traffic: Behavior Models and Applications. In
therebydeanonymizemorehosts.
Proceedings of ACM SIGCOMM, pages 169–180, August
2005. Ascanbeseenbythissimpleexample,withinconserved
anonymizationspacesasingledeanonymizationcanbedev-
[34] Y. Zhang, M. Roughan, C. Lund, and D. Donoho. An
Information-Theoretic Approach to Traffic Matrix Estima- astating to the CryptoPAn anonymization system. For in-
tion. InProceedingsofACMSIGCOMM,pages301–312, stance,considertheapplicationofCryptoPAntotheJohns
August2003. HopkinsUniversitytracegiveninSection4.Thistracecon-
tainsasubnetwithanaddressspaceof28andanassociated
anonymizedaddressspacewith255bitsofuncertainty. To
A Crypto-PAn
deanonymizethisentirespacerequiresasignificantnumber
of individual deanonymizations, 128 to be exact. In prac-
To illustrate the flaw in Crypto-PAn, consider the case tice, however, organizations frequently allocate addresses
where a single anonymized address a(cid:48) = a(cid:48) 1a(cid:48) 2...a(cid:48) n−1a(cid:48) n in contiguous fashion. This concentrates the density of
has been deanonymized to reveal its true address a = hosts within a conserved subtree of the entire anonymiza-
a 1a 2...a n−1a n. Then,becauseoftheprefix-preservingna- tionspace,inessencereducingtheentiretreewith255bits
tureofCrypto-PAn’stransformation,theattackeralsolearns ofuncertaintytoasubstantiallysmallersubtree. Thesere-
the pseudonym for the address a∗ = a 1a 2...a n−1a¯ n. Be- alisticscenariosunderscorethedangerofusingtheprefix-
causeaanda∗ shareaprefixoflengthn−1, theattacker preserving anonymization methodology advocated by Fan
knows that their pseudonyms, a(cid:48) and a∗(cid:48), must also share et al. in CryptoPAn, and shows that the methodology is
an n − 1 bit prefix. Therefore the only valid pseudonym certainly much more dangerous than the analysis in [10]
for a∗ must be a∗(cid:48) = a(cid:48) 1a(cid:48) 2...a(cid:48) n−1a¯(cid:48) n. In general, for any suggests. Recent work by Brekne et al. takes advantage
remaininganonymizedhostwithpseudonymaddressb(cid:48),the
of this very weakness by using active probing attacks to
attacker can remove m + 1 bits of uncertainty about the deanonymize a small subset of hosts within anonymized
host’strueaddressbbydeanonymizingahostwhichshares datasets,whichinturnleadstothecompletedeanonymiza-
anm-bitprefixwithb. tionofallhostswithinthedataset[4,3].
We note that the approach of Pang et al. does not fall
preytothisattack,astheyinsteaduseacustomizedprefix-
0 1 Unknown bits
0 1 0 1 Known bits preservingschemethatdecouplesthehostandsubnetpor-
Inferred bits tionsoftheIPaddress. Specifically, Pangetal. useCryp-
0 1 0 1 0 1 0 1
Compromised toPAn only to anonymize external addresses, but performs
address
0 0 0 0 1 1 1 1 I an dfe dr rr ee sd s a pseudo-random permutation on the subnet and host por-
0 0 1 1 0 0 1 1
0 1 0 1 0 1 0 1 tionsofinternaladdresses. Thisdecouplingstillallowsfor
thecompromisedhost’ssubnetportionoftheaddresstobe
Figure 2. Binary tree with nodes indicating bits of the
anonymized address. Root indicates left-most bit, and shaded deanonymized with the use of our attacks, but the other
nodes indicate compromised bits where the mapping to the hosts’ bits retain their uncertainty as do all other subnets
unanonymizedaddressisknown. withinthedataset.
Forconcreteness,considerasimpleexamplewithn=3,
given by the binary tree in Figure 2. At the onset, the
anonymization maintains 7 bits of uncertainty with regard
to the permutation used to anonymize the addresses. In
other words, there are 128 possible permutations that are
allowed by the prefix-preserving anonymization, and each
ofthosepermutationsisequallylikely. Supposethatweare
13