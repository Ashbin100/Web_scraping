On Network-level Clusters for Spam Detection
ZhiyunQian1, Z. MorleyMao1,YinglianXie2, FangYu2
1UniversityofMichiganand 2MicrosoftResearch Silicon Valley
Abstract hosts may change IP addresses over time; more hosts
may be compromised and existing compromised hosts
IP-based blacklist is an effective way to filter spam maybepatched.ThereforemostIPblackliststodaypro-
emails. However, building and maintaining individual videaverylimitedcoverageofallmaliciousIPs[25].
IP addresses in the blacklist is difficult, as new mali- Ratherthanconstructingblacklistsbasedonindivid-
cioushostscontinuouslyappearandtheirIPaddresses ual IP addresses, previous work has studied building
may also change over time. To mitigate this problem, blacklists based on IP clusters, e.g., clustering using
researchershaveproposedto replaceindividualIP ad- BGP prefixes [28]. By identifying a range or a cluster
dressesintheblacklistwithIPclusters,e.g.,BGPclus- of IP addresses within the same administrative bound-
ters. In this paper, we closely examine the accuracyof ary,weareabletoconstructthereputationfortheentire
IP-cluster-based approaches to understand their effec- cluster instead of individualIP addresses. The cluster-
tiveness and fundamental limitations. Based on such basedreputationallowsonetoinferthereputationofIP
understanding, we propose and implement a new clus- addressesneverpreviouslyobserved.
teringapproachthatconsidersbothnetworkoriginand Inthispaper,wethoroughlyanalyzetheeffectiveness
DNS information, and incorporate it with SpamAssas- ofIP-cluster-basedblacklistsforspamdetection.Inpar-
sin, a popularspamfiltering system widely used today. ticular,weexplorethefollowingquestions:
Applying our approach to a 7-month email trace col-
• Under what scenarios do IP-clusters work? And
lected at a large university department, we can reduce
how much coverage improvement can we obtain
the false negative rate by 50% compared with directly
from IP clusters compared with an individual-IP
applyingvariouspublicIP-basedblacklists withoutin-
basedscheme?
creasingthefalsepositiverate.Furthermore,usinghon-
• What is the right granularity for IP-clusters and
eypot email accounts and real user accounts, we show
how to obtain such clusters with accurate cluster
thatourapproachcan capture30%- 50%ofthe spam
boundaries?
emailsthatslipthroughSpamAssassintoday.
To answer the above questions, we thoroughly
studied three different clustering approaches: BGP-
1 Introduction based, DNS-based, and combined clusters. We select
these clusters because they all reveal the administra-
Withover90%to97%ofallemailsbeingspam[4], tive boundariesof IP addresses. BGP clusters are con-
spam filtering remains critical to today’s email sys- structed fromthe routingperspective, while DNS clus-
tems. There are two main categories of spam fil- ters are from the Web/email relay perspective. In par-
tering techniques: content-based and blacklist-based. ticular,weproposetoexaminethereverseauthoritative
While content-based filtering is the canonical way, the nameserver(rANS)andreverseDNS(rDNS)namesfor
blacklist-basedapproachisreceivingmuchattentionre- DNSclusters,becausetheyareconfiguredbytheIPad-
centlybecauseitdoesnotalwaysrelyonemailcontent dress owners and cannot be easily modified by spam-
and can be more efficient and less susceptible to eva- mers. AsBGPandDNSclusterscanformcomplexbi-
sion. Allwidely-usedblacklists(e.g.,Spamhaus,Spam- partitegraphs,thecombinedclusterscapturetheirinter-
cop [9, 8]) today rely on IP addresses to block email sectionsandthusaremorefine-grained.
traffic originated from hosts with consistent spamming Basedontheseobservations,wefurtherproposeand
behavior. implementa combinedcluster-based approachthat can
While IP-based blacklist is simple and lightweight, be easily incorporated into SpamAssassin, a popular
compiling and maintaining such lists is challenging— spamfilteringsystemthatusesacombinationofcontent-andblacklist-basedspamfilteringtechniques.Weapply 21, 22, 14]). Manyfocusondetectingindividualspam
ourapproachtobothhoneypotemailaccountsanda7- emails, as opposedto identifyingspam-campaignsas a
month email log that containsmore than seven million group(e.g.,[30,31,11]). Althoughspam-campaignde-
emails. Ourkeyfindingsinclude: tectioncanbehighlyeffectivefororganizationswithac-
cesstoalargeamountofspamemails,itisusuallychal-
• As expected, most large BGP prefixes (e.g., /8,/9)
lengingforsmallorganizationswithalimitedview.Asa
are too coarse-grained for building cluster-based
result,theyusuallyresorttothird-partyprovidedblack-
blacklists.However,weobserve17.7%ofmid-size
lists such as Spamhaus[9], SpamCop [8], SORBS [7],
BGP prefixes (e.g., /15 - /20) are also too coarse-
andNJABL[13].
grainedforspamfiltering.
• DNSinformationcanaugmentBGPprefixes.Itcan Inthispaper,wefocusonimprovingblacklist-based
helpbreak26.3%oftheBGPprefixesintosmaller spamfilteringgivenitspopularityandimportance.Most
clusters,therebyreducingthefalsenegativerateby blackliststodayarebasedonindividualIPaddresses. In
5-10%. practice,manyIPaddressesarebi-modalintheirspam-
• We have built a system that combines BGP and ming behavior [28]: they have either consistently high
DNSinformationtoproduceacluster-basedblack- or low spam ratios over time. Thus, various black-
list with a significant advantage over the existing lists [9, 8, 7] are created to block persistent spamming
IP-based blacklists (DNSBL) [9, 8, 7]. It can de- IP addresses. However, since a majority of spamming
tect more than 50% of the spam not captured by IPaddressesappearonlyonceandwecontinuouslyob-
the existing IP-based blacklists while maintaining serve previously unseen IP addresses send only a few
comparablefalsepositiverates. emails(eitherspamorlegitimateemails),itisdifficultto
• The combined cluster-based blacklist can be eas- predictwhetheranewIPisgoodorbad. Consequently,
ily integrated into spam filtering systems such as IP-based blacklists are largely incomplete in terms of
SpamAssassin. When applied to honeypot email theirIPaddresscoverage[25].
accounts,the integratedsystem cancapture30%- ToimprovethecoverageofspammingIPs, previous
50%spamemailsmissedbySpamAssassin. studieshaveproposedtoreplaceindividualIPaddresses
withclusters[28]. Clusterscancapturetheadministra-
Our work is the first to systematically examine the tive/configurationboundariesofIPaddresses,sothatIPs
accuracy and potential of various IP-cluster based ap- withinthesameclusterarelikelysubjecttosimilarsecu-
proaches for spam detection. Our results show that rityornetworkpolicies[18].TypicallyIPclusterscanbe
it is critical to obtain the correct boundaries for IP- constructedusinginformationfromBGP[28],ASnum-
clusters. In practice, it is desirable to combine differ- ber[21], and dynamicIP ranges[29]. In fact, a recent
ent sources of information, e.g., BGP, DNS to obtain study [14] claimed that AS number is the most impor-
fine-grainedclusterswithgoodcoverageonnewIPad- tantfeaturein theirspam detector. Thisis followedby
dresses. Performance-wise, our system currently uses amoredetailedstudy[26]onhowtodeterminewhether
onlytensof millisecondfora singleIP lookupwithout a BGP prefix is bad. By consideringthe reputationfor
any optimization and 2.2GB database storage space to a cluster of IP addresses instead of those of individual
storetheinformationfor2.7millionIPaddresses. ones, we can significantly increase the spam-filtering
The remainderof the paperis structured as follows. coverageofunseenIPaddresses. Althoughthissounds
Wefirstreviewrelatedworkin§2.Weusetwoexamples appealing, it relies on the assumption that IP clusters
to show the complex relationship between BGP clus- capturethecorrectboundariesbetweengoodandbadIP
ter and rANS clusters, followed by the implication on addresses. Given that the granularities of different IP
blacklisting in §3. We then present our data collection clusters differ, these existing cluster-based spam filter-
and experimentalsetup in §4. §5 and §6 elaborate on ingapproachesoftenintroduceahighfalsepositiverate
our detailed analysis on different clusters and how we that prevents them from being adopted in practice. To
combinethem. In§7,weshowhowcluster-basedrepu- reducethe false positiverate, ourclusteringtechniques
tationcanbeeffectivelyappliedinspammitigation. Fi- refine the AS number and BGP prefix based clusters
nally,§8concludesthepaper. into much morefine-grainedones thatmore accurately
capturetheadministrativeboundaries,hencemakingIP-
2 Related Work cluster-basedblacklistsmorepractical.
More specifically, in our study, in addition to previ-
Spam detection has been the subject of active re- ously used BGP information, we also examine reverse
search for years. Numeroustechniqueshave been pro- DNSrecordsasawaytoconstructIPclusters. Thisand
posed. Somearecontent-based(e.g.,[19,27, 20]),and other DNS information previously have not been fully
somenewlyproposedonesarebehavior-based(e.g.,[12, exploredfor clustering IP addresses. The closest workusesrDNSinformationtoidentifydynamicordial-upIP IPs belong to, as manifested by the rANS names. By
rDNSnames(e.g.,regularexpression)[3,2]andblocks assigning IP addresses into two corresponding rANS-
the IP addresses with such rDNS naming convention. based clusters, we are able to separate the good IP ad-
They differ from our proposal in that they are using a dressesfrombadonesintermsofspammingbehavior.
setofmanuallycraftedheuristicsorrulestoidentifycer- In the previous example, we show that rANS can
taintypesofnetworks(e.g.,dial-upusernetworks)while help find smaller and more accurate clusters within
ourclusterusingDNSinformationismuchmoregeneral a large prefix cluster. Now we show a contrasting
andcanbefullyautomated. example where prefixes are more fine-grained com-
NotethatwedonotuseforwardDNSmappingsbe- pared with rANS clusters. Consider a large ISP -
causeitcanbeeasilymodifiedbyspammers,e.g.,fast- comcast.net (Figure 3) with hundreds of BGP pre-
fluxnetworkstypicallyemployedbyscamsites[17,15], fixes. All of the prefixes share the same set of rANS,
toevadedetection.Whiletheforwardmappingbetween namely dns101-103.comcast.net. Obviously
DNSnamesandIPscanchangeveryfrequently,there- the granularity of rANS clusters is too coarse given
verse mapping, which is set up by IP address owners, many IP prefixes within the same rANS. But the
usually changes less frequently. It is difficult to cre- questioniswhetheritisindeednecessarytodecompose
atelarge-scaleDNSfast-fluxtechniquesonreverseDNS comcast.net into several hundredsof smaller BGP
mapping. prefix clusters? Are they better in terms of finding
the boundary between spamming and non-spamming
3 Motivating Examples behavior? In this case, the answer is yes. From our
data, we foundthe spam ratio forrANS cluster is 0.76
Previousstudieshaveinvestigatedusing BGP prefix for all three rANS clusters (since they always appear
asthenetwork-awareclustertogroupthespammingbe- at the same time), which means that there are both
havior[28].However,theaccuracyoftheadministrative legitimate emails and spam originating from the IPs
boundary it captures depends on the granularity of the under each rANS cluster. But if we study the BGP
BGPprefixinformation.Forinstance,alargeprefixcan prefix clusters, their spam ratios are either close to 1.0
befurtherassignedintosmallerprefixesthatmaynotbe orwellbelow0.5. Infact, wefoundthatthelegitimate
externallyobservableinpublicroutingdata. Asaresult,
incoming/outgoingmailserversofcomcast.netfall
whataprefixcapturesis oftena coarse-grainedadmin- intotwodistinctBGPprefixclusters,andotherprefixes
istrative domain, and thus may not be detailed enough are mostly dynamic IP ranges for DSL users. This
to block spams. DNS information, such as rANS and information can be obtained by examining the Sender
rDNS names, also reveals the administrative boundary
PolicyFramework(SPF)[5]ofcomcast.net,which
of IP addresses. It can be more fine-grainedthan BGP isencodedasaTXTrecord(atypeofDNSrecord)and
information for some IPs but more coarse-grained for canbequeriedvianormalDNSlookups. Theresponse
otherIPs. Next,weshowtwomotivatingexamplesfrom
ofcomcast.netlookslikethefollowing:
real data to illustrate the complexrelationship between
thesetwoclusteringapproaches. comcast.net. 300 IN TXT "v=spf1
FirstwestudytheexampleinFigure1,withonepre- ip4:76.96.28.0/23 ip4:76.96.27.0/24
fixandfourrANSnames. Theyforma bipartitegraph, ip4:76.96.30.0/24 ip4:76.96.59.0/24
wheretheupper-levelnodesrepresentBGPprefixclus- ip4:76.96.60.0/23 ip4:76.96.62.0/24
ters and the lower-level ones denote rANS clusters. A ip4:76.96.68.100 ip4:76.96.68.101
line is drawn between a prefix and a rANS whenever ip4:76.96.68.102 ip4:76.96.68.103
thereisanIP(1)belongingtotheprefixclusterand(2) ?all"
therANSisresponsibleforresolvingthisIPaddress.
Figure1showsthatprefix69.61.0.0/17hastwo sets IntheSPFresponse,“ip4”indicatesthattheaddress
of rANS names: ns1-2.gunsprohibited.com rangeisIPv4.TheycorrespondtotheexpectedIPranges
and ns1-2.webserverdns.com. Figure 2 illus- for outgoing mail servers for a domain. “?all” indi-
trates the detailed IP range inside the prefix. The IP catesforallotherIPaddresses,theirbehaviorofsending
ranges with different set of rANS actually have dis- emails is unspecified. Correlating with the BGP prefix
tinct spamming behavior. The IP addresses under the clusters, all the SPF IP ranges belong to BGP prefixes
rANS ns1-2.gunsprohibited.com send purely 76.96.24.0/21and 76.96.48.0/20as shown in Figure 3.
spam,whiletheIPaddressesundertherANSns1-2. TheseIPrangesdifferfromthoseDSLonesinthatthey
webserverdns.com send only legitimate emails. aremorelikelytosendlegitimateemailsgiventheSPF
The disjoint behavior of these two sets of addresses is information.Furtherinvestigationshowsthattheaggre-
likelyduetodifferentorganizationsthesetwogroupsof gatedspamratiosofthesetwoprefixclustersareindeed69.61.0.0/17 (accordingtoSpamAssassin)from2,737,006distinctIP
addresses, 52,498 distinct BGP prefixes. Each log en-
tryhasfourpiecesofinformation:timestamp,senderIP,
spamtag,andspamscoreoutputbySpamAssassin.
ns1.gunsprohibited.com ns2.gunsprohibited.com ns1.webserverdns.com ns2.webserverdns.com
Spam ratio 1.0 Spam ratio 0.0 Spam filter - SpamAssassin. Our mail server runs
69.61.44.25 1 spam 69.61.75.141 1 ham
69.61.44.26 1 spam 69.61.75.142 1 ham SpamAssassin [1] as the spam filtering system. It em-
... ...
ploys several detectors which include Spamhaus [9]
(IP-based blacklist) and a locally maintained IP-based
Figure1.Moredetailedspammingbehaviorfrom
blacklist. Everyemailislabeledaseitherspamornon-
DNSdata.
spam based on its score computed by SpamAssassin.
The score is combined from the result of all detectors.
Ifthe score exceedsa fixedthreshold(5.0in ourcase),
ns1.gunsprohibited.com
thecorrespondingemailwillbelabeledasspam.
ns1.webserverdns.com
Althoughourmailserverisasinglevantagepoint,it
doesreceive spam from a variety of IP address ranges.
Figure 4 shows the CDF of IPs observed by the mail
server.Itroughlyconformstotherangeinpreviousstud-
Spam IP ies, e.g., Spamscatter[11] andthe workby Ramachan-
69.61.0.0/17
addresses
dranetal.[21].
Other data. To study the characteristics of clus-
Figure 2. Smaller administrative boundaries in ters, we also leverage the dynamic-IP ranges produced
69.61.0.0/17 byUDMap[29]tocorrelatewiththeclustersproduced
fromtheuniversitydata. Thisinformationofdynamic-
IP ranges is of interest because dynamic IPs are more
verylowwhilemostotherprefixessendpurelyspam. likely to send spam emails [29]. Further, we use the
Hotmail history correlated with the IP addresses in the
Note we cannotsimply whitelist IP addressesin the
university data set from about the same time period to
SPF records while blacklisting all other ones, because
enhancethevisibilityofourdataset.
manyISPsordomainsmayeithernotprovideSPFdata
or the SPF provided is too relaxed (e.g., all the IP Experiment setup. At the end of each day, we ex-
addresses are listed). Also spammers can spoof SPF tractthemailserverlogthatcontainstheconnectingIP
records as well, i.e., spammers who own the domains andSMTPsessionforeachemail,andperformthefol-
can set the SPF recordssuch that all theirIP addresses lowingthreeDNSqueriesontheIPaddressesweseefor
arelisted. thatday:
In summary, we have illustrated examples where 1) rDNS query on the IP to obtain its rDNS name
BGPprefixiseithermoreaccurateorlessaccuratecom- (orhostname)anditsreverseauthoritativenameservers
paredtotheDNSinformationforclassifyingspamming (rANS).
vs. non-spammingmailserverIPs,motivatingourwork
2) Query on reverse domain name’s MX record as
ofcombiningthesetwosourcesofinformation.
wellastheMXrecordofrANSdomain.
3) Queries on three popular IP-based blacklists:
4 Methodology
Spamhaus, Spamcop, and Sorbs. The results are used
forcomparisonwiththecluster-basedreputation.
In this section, we discuss our data-collection
We use an example to illustrate this process. Given
methodologytoinvestigatethepropertiesofvariousnet-
an IP address, 141.211.22.134, we first perform the
work clusters based on BGP prefix and DNS informa-
reverse iterative DNS query to get the rDNS mx1.
tion.
umich.edu and the rANS dns.itd.umich.edu
and dns2.itd.umich.edu. We subsequently ex-
4.1 Dataandexperimentalsetup tract the reverse domain name. The rDNS name
mx1.umich.eduhasthedomainnameumich.edu.
Data source. The data is collected from the mail The rANS dns.itd.umich.edu and dns2.itd.
servers of University of Michigan EECS department, umich.eduhasthedomainnameitd.umich.edu.
over the time period of 2008.12.7 - 2009.7.9 ranging If not already cached, we then perform MX record
over155days.Itconsistsofaboutsevenmillionemails, query on both domain names umich.edu and itd.
ofwhichmorethan5.5millionemailsarespamemails umich.edu to get the MX records: mx1.umich.Comcast mail servers IP range Comcast DSL user IP range Comcast others
76.96.48.0/20 76.96.24.0/21 68.43.0.0/16 24.129.0.0/18 71.193.128.0/17 ... ...
dns101.comcast.net dns102.comcast.net dns103.comcast.net
Figure3.PrefixtoDNSbipartitegraphforcomcast.nettoillustrateDNSandBGPprefixrelationships.
1
0.8
0.6
0.4
0.2
0
32.0.0.064.0.0.096.0.0.0128.0.0.0160.0.0.0192.0.0.0
IP addresses in /24 bins
sesserdda
PI
fo
noitcarF
Figure4.CDFofspammingIPrangeobserved
1
0.8
0.6
0.4
0.29
0.2
−150 −100 −50 5 50 100 150
Spam score
sliame
fo
noitcarF
legitimatemailservers. Nevertheless,wecannotsimply
blockthemastheymightsendvalidemailsaswell.
Theseappear-onceIPsspanacrosstheentiretraining
period. Toquantifytheirimpact,wecomputethenum-
ber of new IP addresses observed on a monthly basis.
The result indicates this number keeps increasing each
monthstarting at189,994,reaching603,284in the last
month.Weexpectittocontinuegrowinggivenoursmall
vantage point until we observe most IPs. Thus, main-
taining a reputation history for individual IP addresses
willnotworkwell,astherewillalwaysbenewinstances
ofunseenIPsappearingeveryday. Thisresultconfirms
previousresultsthatabout85%ofIPaddressessendless
than10emails[21].
4.3 Datacleaning
Since we use the spam classification produced by
an imperfect detector – SpamAssassin, we may not
have the ground truth. Figure 5 shows a mostly bi-
modalspamscoredistributionassignedbySpamAssas-
sin where most of the emails either have a high score
(much higher than 5.0) or a low score (much less than
Figure5.CDFofspamscoresfromSpamAssassin 0). However, we do see a fraction of emails (less than
8%)thatfallintothescorerangeof5(±3), whichmay
contributetofalsepositivesandfalsenegativesusingthe
defaultthresholdof5.
edu, mx2.umich.edu and mx3.umich.edu. We
To investigatethefalse negativebehavior,we set up
finally record the results of querying the IP address
a honeypot account within our department (advertised
141.211.22.134forthethreeblacklists.
since2007onpersonalWebpagesbutnotused),through
whichwefoundthatSpamAssassinhasanon-negligible
4.2 Appear once IP addresses and new IP falsenegativerate—155(16%)missedspamsoutof965
trend recentspamemails. ThefalsepositiverateofSpamAs-
sassin, however, is very low as reported by previous
Inourdataset,weobservethatmorethan80%ofIPs work[25].
wereactiveonlyforoneday.MostoftheseIPssentonly It is important to reduce the false negativesof Spa-
onetofivespamemails,however,collectivelytheycon- mAssassin,asthoseIPaddressessendingspammayap-
tributedtoabout40%ofallthespamemailsand2.4%of pearlegitimate and thus cause inaccurate evaluation of
alltheham(non-spam)emailsreceived.Furtheranalysis clustering.OnesourceofinformationweuseisIP-based
showsthatabout34.6%oftheseappear-onceIPsaredy- DNSBLs. Previousstudies[16,23,21]showthatsignif-
namicIPs. Incontrast,only15.3%oftheremainingIPs icantly more spam are detected by combiningmultiple
are dynamic, suggesting that appear-once IP addresses blacklists. Further,thesestudiesshowthatalargefrac-
are more likely to be dynamic IPs, thus are less likely tion of spammer IP addresses will eventually be listedaftersometime(e.g.,2monthsorso)inblacklistsifnot DNSclusterstoinvestigatehowtoutilizetheDNSinfor-
atthetimespamsfromsuchaddressesarereceived. As mationincombinationwiththeBGPprefixinformation
aresult,wedecidedtoconductthedatacleaningprocess toclusterIPaddressesforaccuratespamdetection.
byquerying5popularblacklists(Spamhaus,Spamcop,
SORBS, NJABL, CBL) approximately 2 months after
5 Cluster-based Spam Filtering
wereceivedtheemails. AnyIPaddresslistedinatleast
twooftheblacklistswillbeconsideredbadandwetreat
Inthissection,westudytheeffectivenessofcluster-
alltheemailstheysentasspam.
based blacklists. We first consider BGP prefix clusters
Anothersourceofinformationto facilitate ouranal-
sincetheyareoneofthemostcommonwaysofcluster-
ysisisobtainedfromHotmailservers. IPaddressesthat
ing IP addresses. However, as stated before, the accu-
send purely spam to Hotmail server (reported by the
racy of BGP prefix cluster dependson the visibility of
Hotmailspamfilter)willbeconsideredasspammingad-
theprefixstructureinpublicroutingdata. Wealsostudy
dressesaswell. ForIPsthatsendanylegitimateemailto
DNS-basedclustersasDNSinformationmaybeusedto
Hotmailserver,weconservativelydonotconsiderthem
trackthecorrespondinghostadministrativeboundaries.
asbadIPstopreventfalsepositives.
We found DNS-based clusters sometimes yield better
Tosummarize,weconsideragivenIPaddressasbad
predictionaccuracythanBGPprefixes,especiallyinthe
orspammingIPifitsatisfiesanyofthefollowingthree
caseswheretheyprovidemorefine-grainedboundaries.
conditions.
Given that these two types of informationcan comple-
menteachother,weconsidercombiningthemtoderive
1. It has a highspam ratio > 90% (reportedby Spa-
“combinedclusters,” whicharefoundto improvespam
mAssassin)
detectionbymoreaccuratelypredictinghostspamming
2. It is captured by at least two blacklists that are behavior.
queriedaftertwomonths.
3. It never sends legitimate email to Hotmail and all 5.1 BGPprefixclusters
theemailssentbytheIPareclassifiedasspam.
From Route Views [24], a public BGP data source,
Weareabletoreducethefalsenegativeratedownto
we sampled routing table snapshots of 7 distinct days
4.5%inthehoneypotaccountafterapplyingtheserules
fromMarch7thtoMarch13th2009.Weusethelongest
while introducing0 false positivesin 3 of ourpersonal
matchingprefix of the format“1.2.3.4/16”to represent
accounts. Afterthedatacleaningprocess,wecanchar-
IP’scluster. Forthose5000IPaddressesnotassociated
acterizethespammingbehaviormoreaccurately.
withanyprefix,weresorttowhoisdatabase[10]tofind
Notethatourapproachisconservativetoobtainfairly theirassociatedprefixes.
accurate false negative evaluation by ensuring that bad
IPsidentifiedforevaluationarenotmisclassified. Nev-
5.2 DNSclusters
ertheless,itisnotpossibletocompletelyensurethatall
bad IPs are caught in this manner, and those IPs may
To utilize DNS information, we consider two ways
appear in the evaluation result as good IPs while clas-
forclusterconstruction.
sifiedasbadIPsduetotheitscluster’sreputation,thus
rANS clusters: The Reverse Authoritative Name
stillcausingslightlyinflatedfalsepositivesinoureval-
Server Cluster (rANS cluster) groups hosts by their
uation.
authoritative name servers. For each incoming IP,
we perform reverse DNS lookup iteratively to iden-
4.4 Differentclustersanalyzed
tify its authoritative name servers. Note that a recur-
sive lookup is needed to collect several levels of name
Inthisstudy,we measurethecharacteristicsofeach servers, each returned by a different level of author-
cluster type based on BGP prefix and DNS informa- ity such as 1.in-addr.arpa., 2.1.in-addr.
tion and then propose ways to integrate them to ob- arpa.andsoon. Forinstance,takeFigure3asanex-
tain increased benefit while minimizing the shortcom- ample,dns101-103.comcast.netisthelastlevel
ings of individual approaches. Specifically, the clus- rANSforIPsinallBGPprefixes.Notethatallthethree
terswebuildincludeBGPprefixclusters,DNSclusters rANSareassociatedwithallotherBGPprefixes,mean-
(rANSinformationcombinedwithrDNSnameinforma- ing that their granularity is the same. However, there
tion). Since BGP prefixisa well-knowntechnique,we can be some rANS that are associated with more BGP
useitasthebaselineforcomparison.Inthenextsection, prefixes (e.g., our university uses rANS from another
weexploretherelationshipbetweentheBGPprefixand university as backup). Even for IPs without a reversehostname,i.e., NXDOMAINresponse, wecanstill ob-
tain additionalinformationof otherserversin theDNS Table 1. Cluster’s naming pattern 1 consistent
hierarchy. Note we do not use the host name reported naming.
intheHELOmessageofanSMTPconnectbecausethe
IPaddress rDNSname Spam Ham
hostnamecanbeeasilyspoofed. AnIPaddressmaybe
Count Count
resolvedbymultiplenameservers(e.g.,forloadbalanc-
190.82.167.51 190-82-167-51.adsl.tie.cl 1 0
ing). We onlypickthenameserversinthelowestlevel
190.82.165.55 190-82-165-55.adsl.tie.cl 1 0
whichrepresentthemostfine-grainedadministrativedo-
190.82.164.20 190-82-164-20.adsl.tie.cl 1 0
main.Iftherearemultipleonesatthelowestlevel(asis
190.82.151.205 190-82-151-205.adsl.tie.cl 1 0
thecaseinFigure3),wepicktheonethatisassociated 190.82.151.169 190-82-151-169.adsl.tie.cl 1 0
withtheminimumnumberofBGPprefixesindicativeof 190.82.151.158 190-82-151-158.adsl.tie.cl 1 0
themostfine-grainedadministrativedomain. ... ... ... ...
Namingcluster:Withinanadministrativeboundary,
hosts play differentroles. Usually only a subset of IPs
are usedto setup mailservers. Itisnecessaryto sepa- Table2.Cluster’snamingpattern2 mixedw/le
ratethesemail-serversfromtheremainingones.There- gitimatemailservers.
verseDNS-namesofIPaddressesprovidehintsonhow
to classify them. Within each administrative boundary IPaddress rDNSname Spam Ham
identifiedbyaBGPprefixand/orrANS,weidentifyfour Count Count
88.157.32.73 webmail.tvtel.pt 0 1
commonnamingpatterns:
88.157.237.48 rev-88-157-237-48.tvtel.pt 1 0
1. AllrDNSnamesareinthesamedomainandshare 88.157.113.191 rev-88-157-113-191.tvtel.pt 1 0
88.157.204.61 rev-88-157-204-61.tvtel.pt 1 0
a similarnamingpattern. Table 1 showsone such
88.157.218.127 rev-88-157-218-127.tvtel.pt 1 0
example,whereallIPsaredynamicIPswithanag-
88.157.71.28 rev-88-157-71-28.tvtel.pt 2 0
gregatedspamratioof99.6%.
88.157.85.30 rev-88-157-85-30.tvtel.pt 2 0
2. All rDNS names are within the same domain, but
... ... ... ...
withnon-uniformnamingpatterns.Forinstance,an
enterprisecan haveseverallegitimatemailservers
as well as othernon-serverhosts. To discoverthe from sjtu.edu.cn). Exception for this is that when
former,weresorttoothersourcesofinformation- there are only three or even two tokens altogether for
MXrecords,SPFsenderIPrangesandnamingcon- a country-code-ending rDNS name, we will still use
vention as specified in RFC [6] that recommends the last two tokens as domain name (e.g., yahoo.cn
theDNSnamesofmailserverstobeginwithkey- fromwww.yahoo.cn).TofullyutilizeDNSinformation,
word ’smtp’, ’mail’, or ’mx’. The example in Ta- weconstructDNSclustersbyconvertingnaming-based
ble2includesalegitimatemailserverlistedinthe clusterstorANSclusters. ForeachrANScluster,weat-
firstrow, confirmedbyMX recordsofthedomain tempttomatchanyofthefourcommonnamingpatterns
tvtel.pt. For clusteringpurposes, these serversare tofurthersplititintosmallerclusters. Thisenablesusto
separatedintotheirownnamingclusters. discerngoodIPsthatmaysharethesameadministrative
3. IPs without any rDNS names are mixed together
domainwithspammingIPs.
withIPswithrDNSnames.Theyareseparatedinto
differentnamingclustersasshowninTable3.
5.3 Clustergranularity
4. Many domains exist, with each including only a
few IPs. Table 4 showsone such example. Based
Ideally, we want to identify clusters consisting of
on our observation, such cases are usually corre-
mostlygoodorbadIPs. Obviouslythegranularityofthe
lated with spamming behavior. With many do-
clustersplaysanimportantrolehere. Theextremecase,
mainsregisteredwithinthesameadministrativedo-
where each cluster consists of a single IP, falls back to
main, it is highly likely that they are owned by
theper-IPbasedschemeandisnolongerusefulforpre-
spammers who set up corresponding MX records
dictingspammingbehaviorofunseenIPs.
or SPF to make them appear as legitimate mail
servers. First we cluster the 2,737,006 distinct IP addresses
described previously into 92,449 BGP prefix clusters
Herewenormallyusethelasttwotokensasdomain and 60,659 rANS clusters, respectively. Thus on av-
name (e.g., umich.edu from www.umich.edu). How- erage, BGP prefix clusters are more fine-grained than
ever, if the last code is country code, then we use the rANSclusters. However,itisthedistributioninsteadof
lastthreetokensasdomainname(e.g.,www.sjtu.edu.cn theaveragethatmatters. Figure6showsthedistributionTable 3. Cluster’s naming pattern 3 (Some) IPs
withoutrDNSnames.
IPaddress rDNSname Spam Ham
count count
208.53.152.220 mta220.pmxa-net.net 1 0
208.53.152.221 mta221.pmxa-net.net 0 2
208.53.152.219 mta219.pmxa-net.net 0 2
208.53.185.230 N/A 1 0
208.53.185.234 N/A 6 0
208.53.185.228 N/A 8 0
208.53.147.84 N/A 1 1
... ... ... ...
Table 4. Cluster’s naming pattern 4 many do
mains.
IPaddress rDNSname Spam Ham
count count
89.30.144.62 familyhunterburns.net 1 0
89.30.145.171 myfeedstore.net 1 0
89.30.145.170 myephoto.net 2 0
89.30.144.110 advantageatv.net 2 0
89.30.145.175 mywirelesscentral.net 2 0
89.30.145.173 mymusicchannel.net 1 0
89.30.145.178 newdatasystems.net 2 0
89.30.145.179 nirvanashopping.net 1 0
of the numberof BGP prefixesan rANS cluster spans,
and vice versa. About 10% of the BGP prefix clusters
can be further divided into smaller clusters by consid-
ering rANS information. When applying naming clus-
ters to rANSclusters, we obtain 106,356DNS clusters
whichisslightlymorethanBGPprefixclusters.
1
0.8
0.6
0.4
0.2
10 00 101 102 103 104 Number of BGP prefix a name server’s IPs span
srevres
eman
fo noitcarF
1
0.8
0.6
0.4
0.2
10 00 101 102 Number of distinct set of rANS a BGP prefix spans
sexiferp
PGB
fo noitcarF
1
0.8
0.6
0.4
0.2
0 0 0.2 0.4 0.6 0.8 1
Spam ratio
Figure 6. The granularity relationship between
BGPprefixclustersandrANSclusters.
5.4 Spammingbehavior
We examine the distribution of spam ratio for each
clustertypeoverthe7-monthdurationasshowninFig-
ure 7. The figure shows how diverse the spamming
sretsulc
ro
PI
fo noitcarF
IP
BGP prefix cluster
DNS Cluster
Figure7.CDFofspamratiofordifferentclusters.
0.2
0.18
0.16
0.14
0.12
0.1
0.08
0.06
0.04
0 0.005 0.01 0.015 0.02 0.025 0.03
False positive rate
etar
evitagen
eslaF
BGP prefix cluster
DNS cluster
Figure8.Clusteringfalsepositiveandfalsenega
tiverate.
behavior is within the same cluster (How likely that
someIPssendspamwhileotherssendlegitimateemails
within the same cluster) and how they differ between
different types of clusters. We can see that in the fig-
ure, the spam ratio distribution of BGP prefix clusters
is closer to that of IP than of DNS clusters. BGP pre-
fixandIP-basedclustersbothhaveabout0.4%ofcases
with0spamratio.ThecurveshapesforBGPprefixclus-
tersandDNSclustersaresimilar,buttheirinitialvalues
differ by more than 9%. In particular, more than 17%
DNS clusters have spam ratio of 0. This suggests that
BGPprefixclusterscaneffectivelyidentifyclusterswith
spammingIPaddresseswhileDNSisusefulforuncov-
eringlegitimateservers. Thisisexplainedbytheobser-
vationshownlaterin§5.6thatBGPprefixclustermore
closely reflects dynamic IP ranges where a significant
amountofspamcomesfrom[29].
Next, we study the effectiveness of using cluster’s
spamming behaviorto classify good and bad IPs. The
idea is that we define a threshold of spam ratio forde-
ciding whether a particular cluster is good or bad. If
the spam ratio exceeds the threshold, we consider any
IPaddresswithintheclusterasbadIP.Wepickoneday
astestingandtheremainingearlierdaysofdataastrain-
ing data, changing the testing data over 30 days from
Jun10thtoJul9th,2009. We plotthegraphbyadjust-
ing the threshold from 0.8 to 1.0 at the granularity of0.01,averagingacrossdifferenttestingdaysinFigure8.
We can observe that DNS clusters have higher accura-
cies comparedwith BGP prefix clusters since they can
furtherdivideanadministrativedomainintopotentially
goodIPsandbadonesbasedonthenamingpattern.
5.5 Clusterpersistence
Behavior of clusters clearly is more persistent than
that of individual IPs due to longer history. Most IPs
appear only for a day or two, but 80% of the clusters
appear in at least 8 days out of the 7-month duration
of our study. The cluster behavior also shows consis-
tency as the average standard deviation of spam ratio
across all clusters over the 7-month duration is as low
as 0.09 (consistent with the result by Venkataraman et
al.[28]). Thissuggeststhatwheneveraclusterisiden-
tifiedasgoodorbad,itremainssoforarelativelylong
timeperiod.Cluster-basedanalysisisthereforemoreef-
fective for spam filtering compared to purely IP-based
approaches. In Figure 9, we show an example of how
differentIPsappearacrosstimeinoneofthelargestpre-
fix,whichbelongstoalargeISPinIndia. Interestingly,
in this case, all IPs are sending purely spam from this
prefix, showing persistent spammingbehaviorwithin a
cluster.
0 20 40 60 80 100 120 140 160 180 200 Day
61/0.0.461.221
ni
sesserdda
PI
Figure9.Different IPaddresses appearedacross
differentdaysforoneofthelargestprefix
0.25
0.2
0.15
0.1
0.05
0
0 2 4 6 8 10 12
Weeks of training
etar
evitagen
eslaF
ro
evitisop
eslaF
Table5.CorrelationofdynamicIPswithspam
DynamicIP StaticIP
No.ofSpam 1,199,468(22.1%) 4,235,613(77.9%)
No.oflegitimateemail 12,258(0.5%) 2,327,932(99.5%)
In Figure 10, with the spam ratio threshold set to
0.98, we can see that the false positive and false nega-
tive rate of both BGP prefix clusters and DNS clusters
decrease with increased training time. The result fur-
ther suggests that with sufficient training time, we can
classifynewIPsbasedontheirclusterhistorywithhigh
accuracy. Longertrainingtimeleadstomorestablere-
sultswhichinturnsupportspersistentspammingbehav-
iorofclusters.Notethatwedonotobserveclusterscom-
pletelydisappearduringourstudy,i.e.,allIPaddresses
within a cluster stop sending emails at some point, de-
spite a possible conjecture that spamming botnets may
createdynamictime-basedbehavioroftheclusters(e.g.,
rDNS names changed and thus old clusters based on
DNS information may become obsolete). We plan to
investigatethisfurther,asourclusteringapproachopens
newpotentialopportunitiesfordetectingbotnets.
5.6 CorrelationwithdynamicIPs
Given that past studies have shown that spam of-
tenoriginatesfromdynamicIPs, we correlatethe clus-
terdatawith dynamicIPrangesbasedonUDMap[29]
whichisthelatestknown,accuratesourceforsuchdata.
The dynamic IP ranges are gathered by analyzing the
Hotmail user login traces [29]. We found that out of
the 2,737,006 IP addresses, 786,460 are identified as
dynamic with each IP assigned to a unique dynamic
IPrangeID.Surprisingly,weobservethatdynamicIPs
onlycontributeto 22.1%of the totalspam asshownin
Table5. ThisdeviatesfromthefindinginUDMap[29]
thatshowsdynamicIPscontributeto42.2%ofthetotal
spam. Twopossiblereasonscanexplainthisdifference:
(1) Our vantage point captures differentspamming be-
havior from what was seen in Hotmail. (2) Spammers
areshiftingtousingstaticIPaddressesforsendingspam
toimprovespamdelivery,possiblybecauseofthemore
FP of BGP prefix cluster prevalentblockingofdirectconnectiontoport25from
FN of BGP prefix cluster dynamicIPsandtheinclusionofdynamicIPrangesby
FP of DNS cluster
FN of DNS cluster manypopularblacklists[9,7].
We excludeprefixescontainingatleastonestatic IP
addressbasedonUDMapclassificationresults,thusob-
taining4325BGPprefixesthatcontainpurelydynamic
IPs. Incontrast,thereareonly254rANSclusterscon-
taining purely dynamic IP addresses. Further, by cor-
relating them with the dynamic IP range ID produced
byUDMap(eachdynamicIPrangeisassignedaunique
ID),we foundthattheseBGP prefixescovers9785dy-
Figure10.Trainingtimevs. FPandFNnamic IP range ID (7% of all the ranges) while rANS share the same set of reverse name servers such as
only covers 406 dynamic IP ranges (0.5%). Further e.g., a.dns.kr and b.dns.kr. Although poorly
analysis reveals that out of these 4317 BGP prefixes, maintainedDNSinformationusuallyimpliesspamming
64% of the BGP prefixes match exactly with one dy- behavior, i.e., large rANS clusters all have spam ratios
namic IP range. 34% of them strictly contains more greaterthan90%,theymaystillincludelegitimatemail
thanonedynamicIPrange.Theremaining2%BGPpre- servers. Also, poorly maintained DNS information
fixes are either a strict subset of one dynamicIP range occurindifferentnetworks. WefoundthatIPaddresses
oroverlapwithmorethanonedynamicIPrange(Those under these rANS do not cluster well because they
dynamicIP rangesare also coveredby otherBGP pre- may belong to different BGP prefixes, thus crossing
fixes). different administrative boundaries. Especially for
ThisindicatesthatBGPprefixclusterscorrelatebet- rANS clusters close to root name servers, sometimes
ter with dynamicIP addresses than rANS clusters, and they are associated with up to several thousand BGP
it can be explained by the coarse-grained propertiesof prefixes.
most rANS clusters. For instance, in the previous ex- The use of Naming cluster is only applicable for a
ampleillustratedinFigure3,someoftheBGPprefixes knownadministrativeboundarysincetheobservationof
belongto DSL IP ranges, while many othersare Com- namingpatternsaredrawnfromwithinanadministrative
cast legitimate mail servers. In this case, all Comcast boundary.Although1/3oftheIPaddressesdonothave
IPsfallintothesamesetofrANSclustersbutbelongto rDNSname,theyaremixedwithIPaddressesthathave
distinctBGPprefixclusters. rDNSnameandcanbeconsideredasasatypeofpattern
asmentionedinTable3. Asaresult,weexploitnaming
5.7 Choiceofclustertype
patternthat can be a goodindicatorto split an existing
To study which cluster performsthe best and when, clusterintofiner-grainedonesthatmayexhibitdifferent
we need to define the metric for good clusters. The spammingbehavior.
natural metric would be whether IPs within a clus- In conclusion, neither BGP prefix cluster nor rANS
tersharethesame spammingbehavior(sendingmostly cluster is perfect. However, they complement each
spam or mostly legitimate emails). The cluster granu- other in terms of capturing the administrative bound-
larity clearlyplaysan importantrole in determiningits aries. This leads to the idea of combining them along
accuracy.Westudyeachtypeofclustersseparately. with naming clusters to more accurately separate good
IPaddressesfrombadones.
TheaccuracyofBGP prefixclusters, as previously
discussed, dependson the visibility of BGP routingta-
ble. Sometimes,alargerprefixmaybereallocatedinto 6 Combined clusters
smallerrangesnotexternallyobservable.Asaresult,we
conjecturethatlargerBGP prefixesmay notaccurately In previous examples, we show that more fine-
discernspammingbehavior. grained clustering can usually lead to more accurate
FromFigure8,bysettingthethresholdofspamratio identification of administrative boundaries and effec-
to0.95,weareabletoobtainarelativelylowfalseposi- tivelyseparategoodIPaddressesfrombadonesinterms
tiverate.Wethenstudythefalsenegativedistributionby of spamming behavior. In this section, we discuss in
varyingBGPprefixsizes. Figure13illustratestheaver- moredetailhowwecancombinedifferenttypesofclus-
agefalsenegativecountperclusterforeachBGPprefix ter information. The idea is to first combine BGP pre-
size,indicatingthat/8and/9BGPprefixhavetheworst fixclusterswithrANSclusterstoidentifymoreaccurate
falsenegativeperformance,andsmallerprefixessuchas administrativeboundaries.Wesubsequentlyapplynam-
/20-/24havequitelowfalsenegativecountpercluster. ing based clustering within each administrative bound-
This result validates our conjecture. We can conclude ary to perform further separation. We show that com-
thatfine-grainedBGP clustersareneededtoaccurately binedclustersareindeedqualitativelybetterthanapply-
capturespammingbehavior. ingisolatedclusteringmethodindividually.
rANS clusters, as discussed in §5.3, are in general Overall, the clustering process has two phases as
more coarse-grainedthan BGP prefixes. In fact, based shown in Figure 11. The first training phase generates
on our reverse DNS query results, we found that abipartitegraphbasedontheBGPprefixandrANSin-
the largest rANS clusters observed are those close formationforeachIPaddress(asdescribedin§3). This
to root name servers, e.g., tinnie.arin.net, is followed by the cluster assigning phase which takes
ns.lacnic.net, ns-sec.ripe.net, and the bipartite graph and assigns new IP addresses to in-
ns-pri.ripe.net. Some countries such as Korea termediateclustersaccordingtoaclusteringassignment
also contribute to this. We found that most of the algorithm. Intermediate clusters combine BGP prefix
IPs in Korea do not have a hostname and they all and rANS information. The namingclustering processTraining phase Cluster assigning phase 200
For each IP address IP address
150
BGP prefix Reverse
BGP prefix Reverse cluster assignment DNS query
cluster assignment DNS query 100
BGP prefix set of rANS
BGP prefix set of rANS
Cluster assignment
rDNS name 50
Bipartite graph
Intermediate cluster
generation rDNS name
Naming cluster
bipartite graph assignment 0
8 10 12 14 16 18 20 22 24
BGP prefix size in mask length (/8 − /24)
Final combined cluster
Figure 11. Combined cluster construction using
prefixandDNSinformation.
dns.cameron.net
ns1.kcnoc.com
Cluster 1 Cluster 2 Cluster 3
208.110.79.226
208.110.64.0/19
Figure 12. Assigning an IP address into its
corresponding administrative boundary in prefix
208.110.64.0/19.
thenperformsnamingpatternmatchingwithineachin-
termediate cluster to obtain the final combined cluster.
The intuition here is that naming pattern works better
when we already capturea goodadministrativebound-
arywhichcanbeobtainedbycombiningBGPprefixand
rANSinformation.
6.1 Combinedclusterassignment
SinceBGPprefixisgenerallyfiner-grained,westart
withaBGPprefixclusterandrefineitintosmallerclus-
ters by considering rANS information. The cluster as-
signment algorithm takes an IP address as an input,
looksupthecorrespondingBGP-prefixclusterusingthe
longest prefix matching and finds one or more corre-
spondingrANSclusters.
Recall from Figures 3 and 1, we construct a bipar-
titegraphbasedonBGPprefixclustersandrANSclus-
ters by drawing an edge between a BGP prefix cluster
and an rANS cluster whenever at least one IP address
withintheBGP prefixclusteralsobelongstotherANS
cluster. Thedegreeof therANSclusterin the bipartite
graph represents its granularity: an rANS cluster with
asmallerdegreeindicatesamorefine-grainedadminis-
trativeboundaryduetolesssharingacrossprefixes. For
instance,somerANSmightbethirdpartyrANSshared
bydramaticallydifferentadministrativedomains.Using
retsulc
rep
tnuoc
evitagen
eslaF
Figure13.Falsenegativecountperclustersorted
byBGPsize(inmasklength)
15000
10000
5000
05 10 15 20 25 30
BGP prefix size in mask length (/7 − /30)
sretsulc
fo
rebmuN
BGP prefix cluster
Combined cluster with rANS
Combined cluster with rANS and naming pattern
Figure14.Numberofclustersfordifferentcluster
typessortedbyBGPprefixsize(inmasklength).
suchrANSwillinaccuratelytreatdistinctadministrative
domainsasasingledomain.
Since we know that coarse-grained administrative
boundaries produced by rANS clusters may not work
well for classifying spamming behavior, we find the
minimum-degree rANS cluster for a given IP address
to increaseclustergranularity. Afteridentifyingsucha
minimum-degreerANS cluster, we forma fine-grained
cluster by including other IPs sharing the same rANS
clusterwithintheBGPprefixcluster.Theresultingclus-
ter can be illustrated in Figure 12. In this example,
we first find the minimum-degreerANS for IP address
208.110.79.226(dns.cameron.netinthiscase)and
then assign it into cluster 1 where all IP addresses (in-
cluding 208.110.79.226)within cluster 1 has the same
minimum-degreerANSandtheyalsobelongtothesame
BGPprefix208.110.64.0/19.
Note that from the above cluster assignment, BGP
prefix clusters may be divided into smaller clusters, or
theymaybealreadysufficientlyfine-grainedwithoutre-
quiring further splitting. After we combine BGP pre-
fixeswithrANSclusters,weeffectivelyfindamoreac-
curateadministrativeboundaryinwhichthenamingpat-
ternscanbeappliedtoobtainthefinalcombinedcluster.
Table6showstheresultofassigningall2,737,006IPad-
dressesinto theseclusters. TheseIP addressesfallintoTable6.Distributionof2,737,006IPaddressesondifferenttypesofclusterassignment.
Typeofclusterassignment NumberofIPaddresses Numberofclusters
BGPprefixcluster 1,160,491 68,161
CombinedclustersplitfromBGPprefixcluster 1,576,515 101,050
68,161BGPprefixclustersand101,050combinedclus-
ters. ItshowsthatasignificantportionofthetotalIPad-
dresses (42.2%) falls into combined clusters split from
BGP prefixcluster. Previously, §5.3showsabout10%
BGP prefix cluster can potentially be split into smaller
clusters considering rANS information. But here we
found that about 26.3% of the original BGP prefixes
canbefurthersplitintosmallerclustersbyconsidering
rANSandnamingpattern.Further,wefoundthatlarger
BGP prefixes such as /8 and /9 will almost always be
split into smallerclusters. 19.6%of evensmaller BGP
prefixessuchas/15-/20canalsobefurthersplit.
6.2 Clustergranularity
InFigure14weplotthenumberofBGPprefixclus-
terssortedbysizeinmasklengthandcomparewiththe
result of further breaking them into more fine-grained
clusters. We foundthat the numberof the clusters that
range from /24 to /16 increase significantly. However,
forBGP prefixeswith sizeof/8 -/15, althoughtheab-
solute increase in the number of clusters is small, the
ratio of increase is significantly larger. This confirms
our previous observation that larger BGP prefixes are
toocoarse-grainedanddonotrepresentaccurateadmin-
istrativeboundaries. Overall,mostBGPprefixclusters,
regardlessof their sizes, can be split into smaller clus-
ters. We discuss the implicationon inferredspamming
behaviornext.
1
0.8
0.6
0.4
0.2
0
0 0.2 0.4 0.6 0.8 1
Spam ratio
sretsulc
ro
PI
fo
noitcarF
0.2
0.18
0.16
0.14
0.12
0.1
0.08
0.06
0.04
0.02
0 0.005 0.01 0.015 0.02 0.025 0.03
False positive rate
BGP prefix cluster
IP
rANS cluster
Combined cluster
Figure 15. CDF of spam ratio for three different
clusters.
etar
evitagen
eslaF
BGP prefix cluster
DNS cluster
Combined cluster
Figure16.Falsepositiveandfalsenegativeratefor
spamratiothresholdfrom0.8 0.1withgranularity
of0.01
6.3 Spammingbehavior
AsshowninFigure15,combinedclustershavesim-
ilar behaviorto that of BGP prefix clusters in terms of
identifyingclusterscontainingeithermostlygoodIPsor
mostly bad IPs, suggesting that the accuracy property
is preserved from BGP prefixes. Furthermore, in Fig-
ure16,itclearlyshowsthatcombinedclustershavethe
best false negative and false positive result at all spam
ratiothresholdfrom0.8to1.0withgranularityof0.01.
Using combined clusters, we can reduce the false neg-
ativerate by about6%- 10%comparedto using BGP-
prefixclusters,withoutincreasingthefalsepositiverate.
Theresultisexpectedbecausefiner-grainedclustersbet-
tercapturetheboundariesbetweengoodandbadIPsas
discussedbefore.
15000
7500
0
8 10 12 14 16 18 20 22 24
BGP prefix mask length (/8 − /24)
tnuoc
evitagen
eslaF
BGP prefix cluster
Combined cluster
Figure 17. False negative count comparison for
differentclusterssortedbyBGPprefixsize.
We now analyze the false negative breakdown by1
0.9
0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0 8 10 12 14 16 18 20 22 24
BGP prefix size in mask length (/8 − /24)
etar
evitagen
eslaF
BGP prefix cluster
Combined cluster
Figure18.Falsenegativeratecomparisonfordif
ferentclusterssortedbyBGPprefixsize.
0.2
0.15
0.1
0.05
0
8 10 12 14 16 18 20 22 24
BGP prefix size in mask length (/8 − /24)
etar
evitisop
eslaF
4.5x 104
4
3.5
3
2.5
2
1.5
1
0.5
0
1−2930 60 90120150180210240270300330360390420 Number of active hosts (binned by size 30)
BGP prefix cluster
Combined cluster
Figure19.Falsepositiveratecomparisonfordif
ferentclusterssortedbyBGPprefixsize.
BGPprefixsize. Figure17showsthatmostfalsenega-
tivesaredistributedin/15-/20wherethereisthemost
increase in termsof the numberof clusters. Combined
clusters consistently have fewer false negatives com-
pared to BGP prefix clusters for each prefix size. Ex-
amining false negative rate across prefixes of different
sizes, we show in Figure 18 that larger BGP prefixes
clearly have higher false negative rate. As discussed
before, a large BGP prefix can be further divided into
smaller ones for different organizations not externally
visible. As a result, we show that by combining DNS
information,weareabletosignificantlyreducethefalse
negativerateforsuchlargeclusters.
However,aswecansee,for/8BGPprefixes,thefalse
negative rate is still around 50% using combined clus-
ters. Acloserlookrevealsthatitiscausedbyalarge/8
BGP prefixbelongingto MIT, which originateda non-
negligible fraction of spam. These addresses also con-
tributetomanylegitimateemails. Inthiscase,thisclus-
terisconsideredtobea“good”clusterwithallitsspam
treated as false negatives. In fact, most of the spam is
contributed by a few IP addresses which appear to be
legitimate mail servers. We suspect that these spam is
duetomailforwarding,andplantoconfirmit. Notethat
tnuoc
evitagen
eslaF
Combined cluster
BGP prefix cluster
Figure 20. False negative count comparison for
different clusters sorted bythe number of active
hostswithineachcluster.
IP-basedblacklistswillnotblocktheselegitimateserver
IPseither.
Wefindthatcombinedclusterscanalsoreducefalse
positiverates. AswecanseeinFigure19,thefalsepos-
itiverateateachBGPprefixsizeisreducedexceptfor/9
prefixes.Thereasonisthatoriginallyall/9BGPprefixes
areconsideredtobegoodclusters(closeto100%false
negativerate). Butin fact, bysplitting/9BGP prefixes
intosmallercombinedclusters,wecanseparategoodIP
addresses from bad ones that are originally mixed to-
gether in /9 BGP prefix clusters. It can greatly reduce
thefalsenegativerate,butwithaslightincreaseinfalse
positiverate.
Wefurtherexaminethefalsenegativebreakdownby
the number of active hosts within each cluster in Fig-
ure20.TheX-axisshowsthesizeofeachclusterbinned
by30. Forexample, the first barshowsthe false nega-
tivecountforclusterswithhostpopulationrangingfrom
1 to 29. First of all, we observe that most of the false
negatives are contributed by small clusters due to the
lackofsufficienthistory(i.e.,samplesizeistoosmall).
Evenaverysmallnumberofmisclassifiedspamemails
by spam filters would significantly bias the spam ratio
for the entire cluster. With more history, the spam ra-
tiooftheclustersbecomesmorestable,asevidencedby
fewer false negatives for clusters of larger sizes in the
samefigure. Consistentwithearlierobservations,com-
binedclusterscanfurtherreducefalsenegativesincurred
byBGP prefixclusters. However,the reductionis lim-
itedforclustersofsmallerhostpopulations.Thisisalso
duetothelackofsufficienthistoryforBGP-prefixclus-
ters,makingitmoredifficulttofurthersplitprefixesinto
smallercombinedclusters.
6.4 Detectioncoverage
Previously, we have discussed using clusters to as-
signreputationforunseenIPs. Since newIP addresses0.8
0.7
0.6
0.5
0.4
0.3
0.2
0.1
0
1 2 3 4 5 6 7 8 9 10 11 12
Weeks of training
etar
ssiM
workwellevenwithonlyourlocalvantagepoint,which
makes it easier to deploy. The performance in terms
of the lookup time and storage space of our system is
quite low. The average lookup time per IP is about
DNS cluster 60mswhichissufficientlylowtobepractical. Thestor-
BGP prefix cluster
Combined cluster agespacerequiredforstoringinformationaboutthe2.7
IP
millionIPaddresses(includingtheDNSinformation)is
about2.2GBondiskwhichcaneasilyrunonanymod-
erncommodityhardware.
7.1 Comparisonbetweencluster basedandIP
basedblacklists(DNSBL)
Figure21.Trainingtimevs. missrate
As previously described, we build the cluster-based
appeardaily,itisimportanttoquantifytheimprovedde-
blacklist purely based on the aggregated spam ratio of
tectioncoverageofIPsbyusingclusterscomparedwith
clusters. As demonstrated in Figure 8 with varying
IP-basedapproaches.SimilartoFigure10,wefixedone
threshold values, there exist trade-offs between false
dayfortestingandvariedthetraininglength.
positivesandfalsenegatives.
ForFigure21,wedefinethemetricmissratetobethe
NotethatwedidnotutilizeanylocalIP-basedreputa-
numberofemailswhosesenderIPsdonotfallintoany
tionhistorytohelpfurtherreducefalsepositives,thusit
existing cluster divided by the total number of emails.
islikelythatourdetectorwillhaveahigherfalsepositive
For IP-based reputation, it is defined as the number of
rate. However,inordertocompareagainsttheIP-based
emails from unseen IPs divided by the total numberof
blacklist, we do consider the local history information
emails. We excludeIPsfromouruniversitynetworkto
toreducethefalsepositiveatthecostofsomeincrease
avoidanybiascausedbythedatacollectionlocation.
infalsenegativerate. IfanIPaddressfallsintoabrand
Obviously,themissratedecreaseswithmoretraining
new cluster forwhich we have no history, we resortto
data. Inparticular,themissrateforindividualIPsisas
content-basedspamfilterstodecidewhetheritisaspam.
highas60%evenwith12weeksoftraining. However,
Oncewehaveseenenoughhistoryforthecluster,wecan
clustershelpreducethemissratetowellbelow20%,es-
makeuseofclusterreputationforfuturespamdetection.
pecially forcombinedclusters with a miss rate of only
We empirically set the spam ratio threshold to
about 0.6% with 12 weeks of training – two orders of
0.97, 0.98 and 0.99 respectively to compare with each
magnitudedifferencecomparedwiththemissrateofIP-
DNSBL averaged over 30 different days randomly se-
basedreputation.Combinedclustersalsohaveasmaller
lected from June to July 2009. The training data be-
miss rate than both BGP prefix clustersand DNS clus-
ginsfromthe firstdayofourdatacollectionto theday
ters. ThisisexplainedbyfallingbacktoDNSandBGP
before the testing day. The DNSBL we choose are
prefix cluster to obtain history informationwhenevera
Spamhaus [9], Spamcop [8] and SORBS [7]. Table 8
newIP fallsintoacombinedclusterwitha lackofhis-
illustrates the result of using DNSBL alone compared
tory. Furtheranalysisrevealsthatcombinedclustersac-
withusingonlyourcluster,andusingthecombinedap-
tually can help assign reputationformorethan 93%of
proach.Itshowsthatourstandalonecluster-baseddetec-
theunseenIPaddresses.
toralreadyoutperformseachindividualDNSBLexcept
SORBSwhichhasaslightlybetterfalsepositiveratebut
7 Spam detection using cluster-based rep-
amuchworsefalsenegativerate.
utation
With BGP cluster alone, to maintain the same level
offalsepositiverate,thefalsenegativeratewillincrease
Asdiscussedbefore,buildingIP-basedblacklistscan tomorethan20%asshowninFigure16.Further,byin-
beverychallenging.Inprevioussection,wehaveshown corporatingcluster-baseddetection,wecandetectmore
how to build a fine-grainedcluster thatcan outperform than half of the spam missed by these blacklists while
existingclusters. Inthissection,weevaluatetheclassi- maintainingcomparablefalse positive rate. In fact, af-
ficationresultofourclustersintermsofthe falseposi- tercombiningourcluster-baseddetectorwithSpamcop,
tive and false negativerate againstexistingpopularIP- it producesa detectorthat has significant improvement
based blacklists. We also integrate the cluster reputa- (both false positive and false negative) over Spamhaus
tion with SpamAssassin to examine the amount of ad- alone. To understand the false negative improvement,
ditionalspamdetectedandevaluatethenumberofnew weinvestigatescenarioswhereablacklistmissesbadIPs
false positives introduced. Note that our approach can thatwerecaughtbyourcluster-baseddetector.Onerea-Table7.Resultsofintegratingcluster basedreputationwithSpamAssassin
Spam Honeypotaccount Personalaccount1 Personalaccount2 Personalaccount3
Ratio Score Spam Ham FN Spam Ham FN Spam Ham FN Spam Ham FN
threshold assigned 1025 0 144 3750 14143 521 1340 12231 89 11 1550 1
FNR Matched FPI FNR Matched FPI FNR Matched FPI FNR Matched FPI
0.7 1 46 96 0 185 356 4 40 67 5 0 0 0
0.7 2 63 96 0 194 356 4 42 67 6 0 0 0
0.7 3 79 96 0 199 356 5 43 67 8 0 0 0
0.8 1 45 90 0 175 335 3 37 63 4 0 0 0
0.8 2 62 90 0 179 335 3 39 63 6 0 0 0
0.8 3 75 90 0 183 335 3 42 63 6 0 0 0
0.9 1 44 88 0 171 317 0 34 59 1 0 0 0
0.9 2 61 88 0 175 317 1 38 59 1 0 0 0
0.9 3 74 88 0 180 317 1 40 59 1 0 0 0
Table8.ComparisonwithexistingIP basedblacklists(DNSBL).
Blacklistname FN FP Threshold OurFN OurFP CombFN CombFP
Spamhaus 11.54% 0.31% 0.97 8.6% 0.27% 5.32% 0.33%
Spamcop 22.32% 0.18% 0.98 11.5% 0.18% 6.56% 0.22%
SORBS 63.06% 0.10% 0.99 15.3% 0.17% 11.34% 0.20%
son is that these IPs are less frequently used by spam- reputation scheme. We assign scores for IP addresses
mers, thus less likely observed by spam traps to be thatfallwithinbadclusterswithvaryingparametersand
blacklisted. Indeed, we found that more than 75% of evaluatetheaccuracyasshowninTable7. FNRstands
suchIPsfallintosmallerclusters(withactivehostsize for False Negative Reduced. FPI denotes False Posi-
smallerthan15)whicharepotentiallylesslikelyabused tive Introduced. Matched indicates how many IP ad-
byspammersgivenalimitednumberoflikelycompro- dresses fall into existing clusters built over7-month of
mised IPs. And yet since most IPs in the cluster send trainingdata. The numberof matchedIPs servesas an
spam, the aggregated spam ratio of those clusters are upperboundforemailsthatcanbeclassifiedasspamby
high enough to identify newly appearing spammer IPs the cluster-based scheme. Spam ratio threshold is the
withinthecluster. thresholdfordeterminingwhethertheclusterisconsid-
eredbad,andadditionalscoreisaddedforanincoming
7.2 IntegrationwithSpamAssassin email. Score assigned is the score to be added to the
originalscoreassignedbySpamAssassin.
The cluster reputation history collected can be used Since we are not blocking emails directly based on
as a feature to predict future spam. We attempt to in- clusterreputation,we relaxthespam ratiothreshold to
tegrate it with SpamAssassin to quantify how many of be0.7,0.8and0.9respectivelywiththescoreassigned
itsfalsenegativeswecanreducebyusingcluster-based tobe1,2and3respectively.Wecanseethatforthehon-
reputationhistory.AswehavepreviouslyshowninFig- eypot account, we are able to detect about 50% of the
ure5,about4%ofemailsfallintothescorerangefrom missedspambySpamAssassinwhenwesetthethresh-
twotofivegiventhethresholdof5whichmaycontribute oldofspamratioto0.9andthescoreassignedto3.This
tofalsenegatives.Toobtainthegroundtruthofwhether isdespitethefactthatweonlyhavethehistoryfor60%
a particular email is spam, we would need to examine ofclustersthatthespammer’sIPaddressesfallinto.For
theemailcontent.Duetoprivacyconcerns,wecanonly otherpersonalaccounts,weobservesimilarfalsenega-
examineseveralofourownpersonalaccountswithper- tive reductionwith a fairly small amountof false posi-
mission. We also use a honeypot account with all its tivesintroduced.Infact,ifweusethespamratiothresh-
emails considered as spam along with the personal ac- oldof0.9andassignedscoreof3,weonlyincuratmost
countstoestimatetheoverallimprovementfromcluster- onefalsepositiveinstanceforallaccountswhichtrans-
basedreputation. SpamAssassingeneratesafalsenega- lates into only 0.0036% false positive rate. Upon in-
tiverateof16%forthehoneypotemailaccount. spection, the particular false positive email is a paper
We study how much of SpamAssassin’s false nega- invitation sent from China (the conferencewas held in
tivescanbereducedaswellashowmuchfalsepositives China)whoseIPaddressfallsintoaclusterfromwhich
may be introduced by incorporating the cluster-based almostallofIPaddressessentpurelyspamtous. Inter-estingly, thisIP hasnoreverseDNS nameandislisted effective,suchneighboringIPrangesmustbelongtothe
onSORBSblacklistwhichindicatesthateitherthesame sameprefixasspammers’IPranges. Furthermore,they
machineiscompromisedatsomepointortheIPresides needtomakesuretherANScanresolvereverseDNSre-
in a dynamic IP range (although we have checked that questsforthem.TheycanalsoconstructtheirrANSina
thisIPisnotidentifiedasdynamicIPbyUDMap). waythateverysingleIPhasadifferentrANS.Thiswill
Ontheotherhand,withBGPclusterapplieddirectly causeourclusteringalgorithmtofalselyclustereachIP
tothesameaccountwithspamratioof0.9andassigned intoaseparatecluster. However,thisattackwouldagain
score of 3, althoughwe can still reducea similarnum- require spammers to own IP address ranges, and such
beroffalsenegatives,weobserve7falsepositivesintro- rANS naming pattern itself would be an indication of
duced,clearlyindicatingthedownsideofitsinaccurate maliciousactivitiesbecauseconstructingrANSin such
administrativeboundary.Forpersonalaccount3,wedo afashionishighlyunusual.
notobserveanyfalsepositivesforanythresholdexperi- IP-based blacklist captures the individual IP’s his-
mented. However,wecannotreduceanyfalsenegatives tory, which includes a sudden behavioral change of an
eitherduetothefactthereisonlyonefalsenegativein- IP address (e.g., legitimate mail servers become com-
stanceoutof11spamemailsbySpamAssassinandthe promised to send many spam). It is more difficult for
IP addressof thisspamhappenstofallwithin a cluster thecluster-basedapproachtodrasticallymodifyaclus-
forwhichwedonothaveanyhistory. ter’s behavioras it must observebehavioralchangefor
manyIPaddressesin thecluster. Notethatbytracking
8 Concluding remarks history over a sufficiently long period of time, our ap-
proachcandynamicallyadapttothebehavioralchanges
inspamming.However,weexpectthecasewherelegit-
Inconclusion,wehavestudiedthecharacteristicsof
imatemailserversbecomecompromisedforspamming
differenttypesofnetworkclustersandinvestigatedhow
to be relatively rare (compared to DSL users get com-
to combine them into a uniform one. We compare the
promisedandabusedforspamming). Inourdata-set,as
performance of a combined clustering approach inte-
previouslyshownin§5.5,wedidnotobservemuchsig-
grating both DNS and prefix information with previ-
nificant history changes for clusters. Another point to
ouslyproposedBGPprefixclustersandexistingwidely
noteisthatourclusteringapproachattemptsto capture
used IP-based blacklist (DNSBL) to demonstrate im-
regionsoftheInternetthat“should”nothavelegitimate
provedspam detection accuracy. We also integrate our
serverswithhighprobability(e.g.,DSLclusters).Inthat
proposedcluster-basedreputationintoSpamAssassinto
sense,anysendinghostispotentiallybad. Thedetailed
catch30-50%ofthespamthataremissedbySpamAs-
analysis on the behavioral change of clusters is out of
sassin at the cost of very small false positive increase.
the scopeof thispaperandwe plan topursueas future
Ourtechniqueisdesignedtoberobusttopotentialeva-
work.
sionattemptsduetotheinherentstablepropertiesofthe
network information used. Another advantage is that
oursystemcanworkwellinasinglevantagepoint,thus Acknowledgments
can be easily deployedlocallywithoutrequiringmulti-
plevantagepoints(presumablymuchhardertoobtain). We thank our anonymous reviewers and Feng Qian
We argue that our cluster scheme is robust against forsuggestionsthat improvedthe quality of this paper.
various attacks. The most likely strategies of spam- This work is in part supported by NSF CNS-0643612,
merswouldbetocauseustoconstructeithertoocoarse- DARPA,andDepartmentofNavy.
grained clusters where good and bad IPs are mixed or
misleadustoconstructtoofine-grainedclusters,which
References
intheextremebecomeIP-basedblacklists. Weconsider
nexthowlikelyspammerscansucceedinsuchendeav-
[1] The apache spamassassin project. http:
ors.
//spamassassin.apache.org/.
BGP prefix information cannot be easily controlled [2] Dialup rdns. http://home.comcast.net/
by spammers unless they perform prefix hijacking at- ˜mcwebber/blocking.txt.
tacksorownafairlylargeprefix,bothofwhichareun- [3] Generic regular expressions for popular naming con-
ventions. http://www.ddf.net/spam/bad_
likelyduetohighcostoroverhead.DNSinformationis
relays.txt.
moreamenabletomodification,ifspammersownanIP
[4] Microsoft: 3% of e-mail is stuff we want;
rangeandthuscontrolitsreverseDNSmapping.Spam-
the rest is spam. http://arstechnica.
mers can construct rDNS names in a way that is most com/security/news/2009/04/
beneficialtothem,e.g.,bysettingrANStobethesame microsoft-97-percent-of-all-e-mail-is-
asthatoftheirneighboringgoodIPranges. Tobetruly spam.ars.[5] Rfc4408,senderpolicyframework(spf)forauthorizing [25] S. Sinha, M. Bailey, and F. Jahanian. Shades of Grey:
useofdomainsine-mail,version1. http://tools. On the Effectiveness of Reputation-based ”Blacklists”.
ietf.org/html/rfc4408. InMalware2008,2008.
[6] Rfc draft, suggested generic dns naming [26] S. Sinha, M. Bailey, and F. Jahanian. Improving spam
schemes for large networks and unassigned blacklistingthroughdynamic thresholding andspecula-
hosts. http://tools.ietf.org/id/ tive aggregation. In Proc. of the 17th Annual Network
draft-msullivan-dnsop-generic-naming- and Distributed System Security Symposium (NDSS),
schemes-00.txt. 2010.
[7] SORBS. http://www.au.sorbs.net/. [27] V.M.TelecommunicationsandV.Metsis.Spamfiltering
[8] Spamcop. http://www.spamcop.net/. withnaivebayes–whichnaivebayes? InThirdConfer-
[9] Spamhaus. http://www.spamhaus.org/.
enceonEmailandAnti-Spam(CEAS),2006.
[10] Whois ip address/domain name lookup. http://
[28] S.Venkataraman,S.Sen,O.Spatscheck,P.Haffner,and
cqcounter.com/whois/.
D.Song.Exploitingnetworkstructureforproactivespam
[11] D. S. Anderson, C. Fleizach, S. Savage, and G. M.
mitigation. In Proceedings of 16th USENIX Security
Voelker.Spamscatter:CharacterizingInternetscamhost-
SymposiumonUSENIXSecuritySymposium,2007.
inginfrastructure. In14thconferenceonUSENIXSecu-
[29] Y.Xie,F.Yu,K.Achan,E.Gillum,M.Goldszmidt,and
ritySymposium,2007.
T. Wobber. How dynamic are ip addresses? In SIG-
[12] K. Chiang and L. Lloyd. A case study of the Rustock
COMM,2007.
rootkitandspambot. InTheFirstWorkshop inUnder-
[30] Y. Xie, F. Yu, K. Achan, R. Panigrahy, G. Hulten, and
standingBotnets,2007.
I.Osipkov. Spamming botnets: Signaturesandcharac-
[13] Dynablock dynamic IP list. http://www.
teristics. InSIGCOMM,2008.
njabl.org/, recently aquired by spamhaus,
[31] L.Zhuang,J.Dunagan,D.R.Simon,H.J.Wang,I.Osip-
http://www.spamhaus.org/pbl/index.lasso,2007.
kov,G.Hulten,andJ.Tygar.Characterizingbotnetsfrom
[14] S. Hao, N. A. Syed, N. Feamster, A. Gray, and
emailspamrecords. InLEET08: FirstUSENIXWork-
S.Krasser. DetectingSpammerswithSNARE:Spatio-
shop on Large-Scale Exploits and Emergent Threats,
temporal Network-level Automatic Reputation Engine.
2008.
In Proceedings of Usenix Security Symposium, March
2009.
[15] T.Holz,C.Gorecki,K.Rieck,andF.Freiling.Measuring
anddetectingfast-fluxservicenetworks. InProceedings
oftheNetworkandDistributedSystemSecuritySympo-
sium,2008.
[16] J. Jung and E. Sit. An empirical study of spam traffic
andtheuseofdnsblacklists. InIMC’04: Proceedings
ofthe4thACMSIGCOMMconferenceonInternetmea-
surement,2004.
[17] M.Konte,N.Feamster,andJ.Jung. Dynamicsofonline
scamhostinginfrastructure. InProc.PassiveandActice
MeasurementConference(PAM),2009.
[18] B.KrishnamurthyandJ.Wang. Onnetwork-awareclus-
tering of web clients. In In Proceedings of ACM SIG-
COMM,2000.
[19] F.LiandM.-H.Hsieh. Anempiricalstudyofclustering
behaviorofspammersandgroup-basedanti-spamstrate-
gies. InCEAS2006: Proceedingsofthe3rdconference
onemailandanti-spam,2006.
[20] B. Medlock. An adaptive, semi-structured language
model approach to spam filtering on a new corpus. In
CEAS2006-ThirdConferenceonEmailandAnti-Spam,
July2006.
[21] A.Ramachandran and N.Feamster. Understanding the
network-levelbehaviorofspammers. InProceedingsof
Sigcomm,2006.
[22] A.Ramachandran,N.Feamster,andS.Vempala. Filter-
ingspamwithbehavioralblacklisting. InProceedingsof
the14thACMconferenceoncomputerandcommunica-
tionssecurity,2007.
[23] A. Ramachandran, N. Feamster, and S. Vempala. Fil-
tering spam with behavioral blacklisting. In CCS ’07:
Proceedings of the 14th ACM conference on Computer
andcommunicationssecurity,2007.
[24] Route views project. http://www.routeviews.
org.