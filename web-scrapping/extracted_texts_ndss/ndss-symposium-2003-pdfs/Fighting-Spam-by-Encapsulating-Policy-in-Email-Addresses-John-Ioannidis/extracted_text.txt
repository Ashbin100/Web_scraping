Fighting Spam by Encapsulating Policy in Email Addresses
JohnIoannidis
ji@research.att.com
AT&TLabs –Research
Abstract on-line discussion media, entering it on web forms
when conducting web-based transactions, and so on.
Sometimes the email address we give out needs to be
Everydaynetworkinteractionsrequireuserstogiveout parsable by humans; that is the case with email ad-
theiremailaddress,yetnoguaranteescanbemadeabout dresses we give to friends, colleagues, business asso-
how this address will be used. Sometimes the address is ciates, and other people we interact with personally. In
given to a human (e.g., on a business card), but many many more cases, it is irrelevant if an address is sim-
times it is entered in a web form as part of a web trans- pleandreadable(e.g.,ji@att.com)orcompletelyobscure
action. Unfortunately,thatemailaddressfrequentlyfinds (e.g., VP72W24KM7IH7FT4O@fufutos.gr). These are
itself in spammers’lists, neverto be removed again. We thecaseswhentheaddressisnotprocessedbyarealper-
proposetheconceptoftheSingle-PurposeAddress(SPA); son(thatis,readandthentypedininthecourseofevery-
SPAs are generated by a program, and then cut-and- daytransactions),butinsteadispassedbetweendatabases.
pastedintothewebpage(orotherapplication)requesting Itispreciselythenwhereitisimportanttobeabletolimit
an email address. In its more general form an SPA en- theuseofanaddresswegaveouttojustthepurposesfor
codesa securitypolicy thatdescribes the acceptableuse whichitwasgivenout. Itisgenerallybelievedthatmost
oftheaddress;sincesenderscannotbetrustedtoabideby spammers collect new email addresses by scanning on-
it, this policy is enforced by the receiver, who generated linepostings,andbybuyingorotherwiseacquiringlistsof
the policy in the first place. SPAs are cryptographically customerorpersonneladdresses.Inallofthesecases,the
protectedto shieldthemfrom tampering. SinceSPAsare readability of the address matters little, since no human
notmeanttobetypedbyhumans,butratherprocessedby typist is involved. It can evenbe arguedthat, with mod-
computeronly, theydo not haveto be short, memorable, ernmailuseragents(MUAs)offeringsophisticatedGUIs
orevenpronounceable.Wepresentwaystoconstructsuch allowing users to select addresses based on attached real
addresses, and we show the implementation of an opti- namesratherthanactualemailaddresses,andalsopeople
mizedcase. exchangingvirtualbusinesscardsbypointingtheirPDAs
ateachother,evenhumansmaynotneedtobeabletoread
andrememberanemailaddress.
1. Introduction We can see the following broad (and usually overlap-
ping)categoriesofemailaddressexposure:
Unsolicitedcommercialemail(“spam”)iseverywhere.
Mucheffortisbeingspenttocurtailit,andnoarguments 1. Person-to-person,wherecommunicationisexplicitly
need to be offered here as to why spam is undesirable. invited.
Whilethereisnoperfectsolutioninsight,decreasingex-
posureandincreasingthetroublethataspammerhastogo 2. Onlinepresence,wherecommunicationbyreadersof
throughto sendunsolicited emailseemsto bean accept- theonlinematerialiswelcome,atleastforawhile.
able approach. If only a small number of users employ
3. Electronic transactions, where communication is
thesemethods,itwillnotbeworthitforthespammersto
only desired when initiated by the other parties in-
trytoworkaroundthem;ifmanypeoplestartusingthem,
volvedinthetransaction.
thecosttothespammersofworkingaroundsomanypro-
tectionsmaymakeitfinanciallyunrewardingtoengagein Inthefirstcase,wherewegiveouraddresstoahuman,
theirpractices. wewantthataddresstoworkforalongtime,perhapsfor-
The life-cycle of spam starts with our making our ever,butwewouldideallywantonlythatpersontobeable
email address known by giving it out to individuals, tosendmailtoit. Thismaybefeasibleifweemploysome
subscribing to mailing lists, posting on Usenet or other electronicmeansofgivingouttheaddress(moreemail,aPDA), but is probably impossible in the general case for baseaccount.
emailaddressesprintedonbusinesscards,forexample. Many other ad hoc solutions can be proposed, and all
The address-on-the-card is just a special case of the of them have the problem that the size of the alias list
second type of address exposure; it is similar in na- and the size of filtering rules grow without bound, since
ture to putting in on a research paper such as this entries can never be removed. What we propose instead
one, posting on Usenet, and so on. For example, if I is to encode rules as part of the email address, and do it
had given my email address on the title page as jiRE- insuchawaythatthepotentialsenderscannotalterthese
MOVE@THE.research.CAPS.att.com,anyhumanreading ruleswithoutatthesametimeinvalidatingthealias.These
the paper would immediately figure out how to send me rules are applied when email to the address is received.
email, but a web crawler getting the electronic version This way theuser doesnothaveto storeanyper-address
might have a harder time. Many such address obscuring rules locally or keep track of multiple email addresses.
techniques are employed; we list some of them in Sec- In Section 2 we describe the general way to accomplish
tion5. Theproblemhereisthat,insomevenues,wemay thisgoal;inSection3wepresenttheimplementationofa
want the address to work indefinitely, whereas in other commoncase;wediscussfurtheraspectsofthesystemin
caseswewantittohavealimitedlifetime;eitherway,we Section4. Weconcludewithrelatedandfuturework.
cannotrestrictwhothesenderwillbe,exceptthatwehope
that,byobscuringit,theywillbeahuman. 2. SPAArchitecture
Let us nowexaminethe thirdcase. In manysituations
Figure 1 shows the players in the SPA system. Users
of conducting business over the web, we only care that
create SPAs which they give to correspondents. When
the corresponding party be able to contact us for a lim-
correspondentssendemailbacktousers,eithertheuser’s
itedamountoftime; moreover,we wantonlythe organi-
MTA (Mail Transport Agent) and/or the user’s MUA
zationwearegivingouraddresstotobeabletocontactus,
(MailUserAgent)checktheemailagainstthepolicyrules
andnotanyonetheypassitonto. Thisisbothtoprevent
encodedintheaddress,anddeliverit,bounceit,ordiscard
saidpartyfromsendingadvertisingmaterialinthefuture
it accordingly. This, of course, is a very simplified view
(whichmostonlinevendorsdo,despiteassurancestothe
ofthemaildeliveryprocess;itdoesnottakeintoaccount
contrary),andtopreventabuseofthesuppliedaddressby
thepossibilitythataremotemailaccessprotocolsuchas
third parties that, with or without the coo¨peration of the
POP3[13] or IMAP4[8] is used. We shall discuss these
merchant,acquireouremailaddress. Thus,thetwomain
casesinSection4.
featuresrequiredofemailaddressesinthesesituationsare
that they stop working after a certain date, and also that
spagen
theyonlyworkforspecificsenders.
(cid:99)(cid:111)(cid:114)(cid:114)(cid:101)(cid:115)(cid:112)(cid:111)(cid:110)(cid:100)(cid:101)(cid:110)(cid:116)
Aneasyapproachwouldbetocreatethrow-awayemail
aliases, give those out, and not check mail sent there af- (cid:77)(cid:84)(cid:65)(cid:32)
(cid:117)(cid:115)(cid:101)(cid:114)
ter a while to the ones we consider to be single-use or procmail
spain
limited-time-use only. It is easy to see that such an ap-
proach has huge logistical overheads. Also, most Inter- (cid:117)(cid:115)(cid:101)(cid:114)(cid:39)(cid:115)
net users do not run their own mail servers, and creat- (cid:109)(cid:98)(cid:111)(cid:120)
ingaliasesatamoment’snoticeisnotaneasyoptionfor
them; the username+extension convention1 can be used
Figure1.Giveaddressgetmail.
asaformofaliasinthiscase. Afteranaliashasreached
theendofitsdesiredlifetime,afilterruleinafeaturesuch
The core idea is that whenever an email address is
as procmail can be used to reject the alias from then on.
handedout,rulesaboutitsuseareencodedintheaddress
Evidently, procmail can also be used to restrict who the
itself. The correspondent cannot, of course, be trusted
allowed sender for that particular alias is. An unfortu-
to obey these rules; the rules are enforced by the MTA
nateproblemwiththisapproachisthatmanywebservers
and/or the MUA when mail is sent to that address. The
donotacceptemail addressescontaininga + sign. Also,
correspondentmayalsoattempttotamperwiththestruc-
sincethepartbeforethe+signisstillpresumablyavalid
ture ofthe SPA inan effortto cause a messageto be de-
address,thenextgenerationofspammingsoftwarewould
liveredwhenitshouldnot be; thus, SPAs shouldcontain
simply remove whatever followed the + and send to the
informationthatallowstheirintegritytobeverified. Fur-
thermore, there is no reason to divulge any information
1Inmostemailsystems,sendingmailtouser+extension@domainde-
about a user’s policy to the correspondent; the address
liversthemailtoa“mailbox”namedextensionforuser@domain. The
must therefore be encrypted under a key known only to
mailboxcanbeaseparatemailfile,orcansimplybeamarkingofthe
mailmessageindicatingthatitisforthatparticularmailbox. theagentswhogeneratetheSPA(theuser)andtheagentswho must process the message when it is received (the
MTAand/ortheMUA).
Therequirementsforthesystemwearebuildingare:
(cid:0)
Anyusershouldbeabletosetitupwithlittleorno
explicitsupportfromthemailadministrators.
(cid:0)
Users should not have to get their own domain
names,ormanagetheirownmailservers.
(cid:0)
headers cannot automatically be faked to match the pol-
icy in the address. Once the set of policy rules has been
assembled, it is MAC-ed and encrypted under (symmet-
ric) keys known only to the user creating the SPA (and
subsequently receiving mail sent to the SPA, of course).
The details of cipher selection are beyond the scope of
thispaper,butwedojustifyourimplementationselections
in Section 3.1. Care must be taken so that individual bit
changingorsplicingattacksdoinvalidatetheMAC.
The addresses should look like ordinary (if unpro- The output of the encryption is a string of random-
nounceable)emailaddressestocorrespondents. looking bits, and as such it is not suitable for use as an
emailaddress. Itmustthereforebeencodedusingasetof
2.1.StructureofSingle-PurposeAddresses charactersthatarelegalforemailaddresses[14,9]. After
thepolicyparthasthusbeenobtain,itisappendedtothe
The SPA consists of two parts: an indication of the
user part; the result can now be cut-and-pasted or other-
addressee, and an appropriately-encoded description of
wiseusedasanemailaddress.
the policy that will be applied when the message is re-
ceived. The addressee can simply be identified by his
2.2.ProcessingofReceivedSPAs
username, with the policy part given as the extension as
in the user+extension convention. Since presumably the When email directed to an SPA is received, the SPA
“naked” (with no extension) main address of the user mustfirstbedecoded. Theusernamepartisstripped,and
would still be valid, it is recommended that users who theremainderisdecodedanddecrypted.Next,theMACis
wanttouseSPAsgetasecondaddress(oranalias),andset checked;ifitpasses,thepolicyrulesareevaluatedwithin
uptheirsystemssothatmailtothenakedsecondaddress thecontextoftheuserandofthereceivedmessage(i.e.,,if
isrejected. WeshalldiscussthismoreinSection3.2. therulesrefertotheuser’senvironmentsuchasthedate,
The policy is a set of rules that encode the conditions orpartsofthemessagesuchasthesenderaddress,thepro-
under which the sender’s email is allowed to be deliv- gram that checksthe rules has to take that into account).
ered to the user or not, and what corresponding actions Therulescouldindicateasimpleaccept/rejectchoice,or
should be taken. This definition of policy is much like mayhavemorecomplicatedresultssuchasanewaddress
in one in trust management systems[7, 11]. A policy toforwardthemailto, extraheaderstoinsert,andsoon.
could be as simple as “this email address expires on Typically,alltheseoperationswillbedonebyaprogram
March 20th, 2003”, or as complicated as “accept this invokedbyprocmailorothermaildeliveryprocessingap-
mailbetweenJanuary30th,2003andMarch20th, 2003, plications.
and only if the user is sending it from some machine in AnimpedimenttotheproperoperationofSPAsisthat,
cs.miskatonic.edu; if accepted, forward the mail to sel- inmanylegitimatecasesandinmostspamcases,thead-
don@trantor.gov.” What is expressible is limited by the dress listed in the To: header of the mail message is not
richnessofthepolicydefinitionlanguage,andhowcom- the same as address of the recipient, which is given in
pactlyitcanbeencoded. TheSMTPspecification[14,10] theRCPTcommand(theso-called“enveloperecipientad-
doesspecifya64-charactersizeforusernames,butmod- dress”) during the SMTP dialog. In fact, in many cases
ern mailers seem to support much longer addresses. No the enveloperecipient addressdoes notappearanywhere
oneisexpectedtotypeinsuchaddresses; rememberthat in the headers, although some mailers, if properly con-
SPAsaremeanttobegeneratedbyaprogramandcut-and- figured, will put it in one of the Received: header lines.
pastedintowebformsorothersuchplaces. There is only one solution to that: the MTA where the
Evidently, email headers are not authenticated in the SPAisdeliveredmustbeconfiguredtoaddaheaderwith
normalcourseofevents,hencenoguaranteescanbemade the envelope recipient address, which, of course, is the
about their validity. It is not the objectiveof our system SPA. Thereareissueswhenmultiplerecipientsaregiven
tosupplantsecureemail;rather,itisonemoretoolinthe withRCPTcommands;wediscusshowtosolvethemina
spam-fighter’stoolbox. Theonepartinthe SPAthatcan particularMTA(Postfix)inSection3.2.
be trusted is the expiration date, and that is because it is
checkedagainstthereceiver’snotionoftime,whodecided 3. Implementation
onthe expirationdate in the first place. This also avoids
theneedforsynchronizedclocksbetweensenderandre- WeimplementedSPAsunderUnix,withPostfix[15]as
ceiver. TheSPAhastobeprotectedagainsttamperingby theMailTransportAgent. Therearetwophases;creating
the correspondent, and evenagainst examination, so that theSPA,andthenprocessingemailsentthere. Unliketheprevioussectionwheremostlytalkedaboutthestructure, thatnothingisstripped,“01”and“10”meansthatoneor
in this section we shall discuss the receiving considera- two trailing domain components are stripped, and “11”
tionsmuchmorethanthecreationofSPAs. means that upon receipt we should try matching against
zero,oneortwocomponentsstripped. Thedomainname
3.1.SPACreation itself can also be encoded in 6-bit characters, since do-
main names are not case-sensitive, and many characters
Asafirstusablesystemwedecidedtolimittherangeof
arenotvaliddomainnamecharacters.Ifthedomainname
policiesexpressibleintheaddressforthesake ofbrevity
isshorterthanthespaceavailable,itispaddedwithzeros.
and usability of addresses. There is a lot of broken and
Ofcourse,anall-zeroesdomainpartmeans“acceptalldo-
misconfigured mail software and we would like, if pos-
mainnames”.Givenalltheseconsiderations,wecomeup
sible, not to cause it to reject our addresses. Given that
withthefollowingencoding:
we want these addresses to be used for web-basedtrans-
2 bitsencodeTLDstripping.
actions,andthatsomewebserversimposeartificiallimits
14 bitsencodeexpirationdate(toSeptember2044).
onthesizeofemailaddresses,wedecidedtoputtheleast
96 bitsencodedomainname(16characters).
amount of data, encodedin a compact way, that fulfilled
16 bitsencodeICV.
the design criteria of our system. To wit, these baseline
Since the domain name can now encode 16 charac-
SPAs haveonly anexpirationdateanda substring ofthe
ters, we can even have it encode a full email address
domainnamethatisallowedtosendemailtothataddress.
(the fact indicated by the inclusion of an at-sign in the
AfundamentaldesignissuewasthelengthoftheSPA.
allowed domain name). Many people’s email addresses
128 bits are a convenient size; they are one block of a
are longer than 16 characters; again, we use properties
modernsymmetricciphersuchasAES.Weshallcallthis
of the application domain to circumventthis problem; if
construct the SPAB (SPA Block). SPABs are encrypted an @ sign appears in the domain name, we make a sub-
under a symmetric key, and encoded using the charac-
string comparison anchored at the @ sign. For example,
ter set of valid email addresses: letters, numbers, and a
“i@research.att.c” would match “ji@research.att.com”
few special symbols. The encrypted and encoded SPA
(as well as “iii@research.att.co.uk”), but would not
block is called the SPABEE. Base-64 encoding would be
match“abc@research.att.com”or“ji@yahoo.com”.
veryconvenient,resultingina22-character-longSPABEE.
The ICV is derived by computing the MD5 checksum
While there is no reason to assume that automatic soft-
ofthefirst112bits,andusingthefirst(high-order)16bits
ware would change the case of an SPA string, email ad-
ofthatchecksum. ThisisnotreallyaMAC,butitisade-
dressesarecase-insensitive,sowedecidednottotakeany
quate. Itmayseemrathershort,however,inthatitwould
risksandjustdobase-32encoding,usingthenumbers0–
allow one tampered message in
9 and the letters A–V. On receipt, we ignore the case of
letters. This results in a 26-character-long SPABEE. A
quickexperimentofvariouswell-knownwebsitesshowed
thattheyhadnoproblemwith40-or50-character-longad-
dresses.
Time resolution of one day was deemed adequate; al-
locating 14 bits for the expiration date, encoded in days
since January 1st, 2000 would allow for expiration dates
into September 2044, by which time it is hoped that we
willhaveeradicatedthespamproblem. Thespecialvalue
0 means “no expiration date”. Some bits in the 128-bit
stringshouldbeusedtocheckforintegrity,andtherestof
thespaceshouldencodethedomainnameallowedtosend
to the SPA. Two bits encode how many trailing domain
namecomponentstostripfromtheincomingaddressbe-
forecomparingittotheaddressintheSPA.Theunderly-
ingassumptionisthat,inmanyoccasions,thesignificant
partofadomainname(asfarasspamisconcerned)does
notincludethetrailinggTLDorccTLD,andsometimes
noteventhesecond-leveldomain. Wewantamechanism
for allowing “foo.com”, “foo.co.uk”, and “foo.ac.jp” to
allbeacceptedifwesuspectthat theyarethesamefirm.
The first two bits in the SPAB encode this: “00” means
(cid:0)(cid:2) (cid:1)(cid:4) (cid:3) to go through unde-
tected. This is not deemed to be a serious problem; for
most people, it would be less than one bad message per
month, andeventhen,thechancesthatthedomainname
and the expiration date would have decrypted to some-
thingvalidarevirtuallynil.
D D Expiration Date
Encoded Domain Name
ICV
Figure2.SPABlock.
The format of the SPA Block is shown in Figure 2.To generate it, we wrote a short script, spagen, which through procmail for reprocessing. Any existing X-SPA-
takes as arguments an expiration date and/or a domain From: lines are deleted. To prevent an adversary from
name (with or without an @ sign, as described above), insertingrandomX-SPA-From:linesintheirmailinanat-
computes the ICV and populates the 128-bit SPAB. The tempt to bypass SPA processing, spain replaces the To:
resulting block is then encrypted with AES-256-CBC header line with username+ a fixed 128-bit string (base-
(AES with a 256-bit key in CBC mode), and printed 32encoded). Mailsenttothisextensionisknowntohave
out base-32 encoded. The contents of the environment been sent to a valid SPA, and can take the X-SPA-From:
variableSPAPFXareprepended: header into account. This process is adequately secure;
$ echo $SPAPFX the security of the system is predicated upon the filesys-
ji+QQ tem security of the user anyway (anyone who can break
$ spagen -e +4 -1 -d apskatecomputers intotheuser’smachineand/ormailrepositorycansimply
ji+QQIV89O7OD2GDASIK2M1928IN6N8 depositspamthere). Sincethissecret deliveryaddressis
never exposed, and it only appears in the user’s configu-
Thisstringcannowbecut-and-pastedintowhateverap- ration files, there is no additional security exposure. An
plication requires an SPA. The -1 option indicates that adversary has as much of a chance of guessing that ad-
one level of domain names has been omitted; the gen- dressasofguessingtheencryptionkey,whichisnegligi-
erated SPA will therefore cause any mail originating at ble. Obviously, mail re-injected this way will not match
cheapskatecomputers.com,aswellasrealcheapskatecom- therulelookingforSPAs. Rulesthatdomatchitcanthen
puters.org,tobeacceptedforthefollowingfourdays. also look at the X-SPA-From: headers, along with other
Once the SPAB, the policy part of the SPA, has been headers, to split the mail into different mailboxes. Fig-
computed, and encrypted and encoded into the SPABEE, ure4illustratesthisprocess.
theSPAcanbeformedinseveraldifferentways,depend-
ing on howthe user’s receiving email software operates.
(cid:77)(cid:84)(cid:65)(cid:32)
Theeasiestcaseis whenwe areonly worriedabout mail
sent directly to us; then we can form the SPA using the
mailbox+extension convention: the username, followed
by +, followed by the SPABEE. Since SPABEEs are 26 procmail
characterslong,anditisunlikelythatotherordinaryuses
ofthemailboxextensionwillbethatlong,aprocmailrule
that selects 26-characterextensionscan be usedto divert (cid:89)
emailsenttoSPAs. Alternatively,someuser-selectedpre- (cid:83)(cid:80)(cid:65)(cid:63) spain
fixtothe SPABEE canbeusedasa disambiguator. Inthe
(cid:78)
previous example, the SPABEE can be prefixed with the
string “QQ”; then a .procmailrc rule like the one in Fig-
(cid:100)(cid:101)(cid:108)(cid:105)(cid:118)(cid:101)(cid:114)
ure3 be used. Allincomingmail to ji with anextension
startingwithQQwillbepipedtoaprogramcalledspain
(“SPAin”)forprocessing. Figure4.IncomingSPAmail.
:0 A number of complications arise in practice, all of
ˆTOji+QQ.*@att.com whichneedsome(usuallyjustone-time)supportfromthe
| $BINDIR/spain mailadministrator.Thefirst,andperhapsmostsignificant,
isthatmanywebformsoftwaredoesnotaccepta+signas
Figure3..procmailrcruletocatchSPAs partoftheemailaddress;whetherthatisbydesignorby
ignorance is immaterial. AlthoughMTAs can be config-
ured to use a differentextensionseparatorcharacter,that
3.2.ProcessingincomingSPAmail may not be desired because it affects all users. A better
solution is to use a separator string, such as QQ, that is
ThesimplestcaseforprocessingSPAmailiswhenthe
notlikelytoappearaspartofanemailaddress.Forexam-
“+”conventionisused. Theuser’s.procmailrccontainsa
ple, if the mail server for fufutos.gr uses the postfix[15]
rule like the one in Figure 3. The mail is piped through
MTA, the following rule in /etc/postfix/virtual pcre ac-
the receiving program (spain), which verifies the valid-
complishesthis.2
ity of the SPA. If the SPA is invalid, the mail is sim-
plydiscarded. Otherwise, theprograminsertsanX-SPA- 2Forthistowork,pcre:/etc/postfix/virtualpcremust
From:headerlineintotheincomingmailandpipesitback beaddedtothevirtualmapslinein/etc/postfix/main.cf./ˆ(\S+)QQ(\S+)@fufutos\.gr$/ decryptingwitholderkeys;ifoneofthemworks,depend-
${1}+${2}@fufutos.gr ing on the policy in the SPA we may simply consider it
Then,anymailsentto,e.g.,fooQQbar@fufutos.grwill expired, or send a challenge to the sender to verify that
bedeliveredtofoo+bar@fufutos.gr. theyarestilllegitimate.Thechallengemessageshouldnot
This still leaves open the possibility that someone pe- createanyadditionalstate;aneasywayofaccomplishing
rusingalistofspamaddresseswillnoticethepatternand thisistogenerateanSPAwithaone-daylifetimeasking
decide to simply put foo@fufutos.gr in the spam list. To therecipienttoreplytothataddress. Manyvariationson
solvethisproblem,eachusercanbegivenanaliasforuse this theme are possible, and experience with a deployed
onlywithSPAs. Mailsenttothenakedalias(withoutan systemwillshowwhatismostappropriate.
extension)isobviouslyspam,andcansafelyberejected. The 128-bit SPA described in Section 3 was done as
The other important operation that the SMTP daemon the absoluteminimumsystem that wouldhavethe short-
has to perform is to save the envelope recipent address estpossibleSPABEEsize.Infact,sinceweareonlycheck-
(theaddressgivenintheSMTPRCPTTo: command);the ingforequality,thestringitselfneednotbeinthe SPAB,
reasonsforthiswereexplainedinSection2.2. Itturnsout just an indicationof howmanycharacters beforeand af-
that this is harder than it looks, because it has to happen ter the @ sign to compare, along with a truncated MAC
before any aliasing or address rewriting happens in the of the resulting substring. This would allow very long
MTA.TheeasiestwayofaccomplishingthisinPostfixis email addresses to be efficiently encoded, but would not
bydefininga“contentfilter”for smtpd, theprogramthat reduce the minimum size of the SPABEE, which is dic-
accepts incoming SMTP connections. If so configured, tatedbytheblocksizeofthecipher. Ifwe arewillingto
smtpdrunsthemailitgetsthroughafilter,givingthefilter allow SPAs longer than 128 bits, we can encode longer
accesstotheenvelopesender(MAILFrom:) andreceiver acceptableemailaddresses,perhapsevenuserealregular
(RCPTTo:) addresses. Thusthefiltercaninsertaheader expressions instead of substring matching. We can also
linesuchas add a forwarding rule: an email address to forward the
X-SPA-To:fooQQIV8...928IN6N8@fufutos. resulting email to, in order to make procmail’s job eas-
gr (where some characters have been omitted for for- ier. We can also increase the granularity of the expira-
matting reasons) to the headers. Because spammers can tiondatetohoursorminutes,butsinceemailoperateson
always insert their own X-SPA-To: headers, the filter humanscales,thebenefitsderivedfromthatwouldbeal-
scans for them and removes them before inserting its most nonexistent. Thereare somemore obviouspolicies
own. that we couldencode with a single bit, such asrequiring
Afterthese substitutions,the MTAdeliversthemail to encrypted/authenticatedmailtotheSPA.Inthelimit,full-
the final user. The rule in Figure 3 is duplicated, except fledgedpoliciescanbeexpressedinsomepolicydefinition
that the header matched is not the To: header but rather languagesuchastheonedescribedin[6].
theX-SPA-To: header. Otherwise,theprocessingthatin- Finally, whensystemssuchas POP3[13] orIMAP4[8]
vokesspain,checkstheSPA,andresendsthemailtothe are used, the user can have the option of letting allmail,
userwiththe128-bitsecretextensionasdescribedinthe including spam, accumulate on the server, and then use
beginningofthissectionremainsthesame. spain-like processing as each piece of mail is retrieved.
Naturally, usually only the headers will need to be re-
4. Discussion trieved before a decision is made to discard the mail as
spam. IfthemachinewherethePOP3/IMAP4serverruns
Thereareseveraloperationalissuesassociatedwiththe
can be trusted with the user’s SPA key, then all this pro-
use of SPAs. The first concern is what happens when a
cessing can happen on the server side, eliminating the
spammeracquiresanSPA,butalsolearnswhotheallowed
needtokeepspamintheuser’smailbox.
senderis.Sinceemailheadersarenotauthenticatedatany
The basic premiseof Single-Purpose Addressesis that
point, the spammer can simply forge the From: headers
theydonotrelyonthecoo¨perationofthecorrespondentto
and let their spam through. Similarly, unrestricted SPAs
enforcepolicy. Intryingtoextendthesystem,weshould
given to friends may also be compromised, for example
keep that basic premise in mind. There are many ways
by being givenbya na¨ıverelativeto an electronic greet-
to fight spam; SPAs add one more powerful tool to our
ing card web site. We thus need a way to revoke SPAs
armory.
without actually having to keep track of all the ones we
have given out. The easiest way to accomplish this is to
5. RelatedWork
useperiodicallychangetheencryptionkey,whilekeeping
somesmallnumberofoldonesaround.Whenmailcomes Thereisatremendousamountofeffortbeingexertedto
inthatdoesnotdecryptproperlywiththecurrentkey(the fight spam. Like anysocial disease, people have tried to
ICVinthe SPAB doesnotcomputecorrectly),wecantry counterspamwithsocialpressure,technology,andlegis-lation.Thesocialpressureaspectistheweakestoftheap- ishigh.
proaches,andonlyworkstosomeextentwhenthereisthe Various ad hoc solutions also work, such as seeding
possibilityoffinancialorsocietalrepercussions.Somele- spammers’listswithemailaddressescreatedjustforthat
galframeworkexiststhatprohibitsunsolicitedemail.[12] purpose,andcomparingmailreceivedonthoseaddresses
is a not-very-recentsurvey,andlegislationbyregioncan with mail received on real addresses. Spammers have
be found in [1]. Litigation creates problems of its own, been getting more insidious, though, and they generate
anditisusuallyeasiertojusttoleratespamaspartofthe slightvariationsofthemessagetoeachaddresstheysend
costofdoingbusinessontheInternet. to.
Themainfocusofanti-spamcombathasbeenthrough Finally, there is a large amount of research literature
technicalmeans.Again,muchlikedisease,thereareways on identifying spam through textual analysis of both the
ofreducingexposureinthefirstplace,combatingtheway headers and the body of the message. Spamassassin[4],
it spreads, and identifying and removing it where possi- a message-text classification program, does a stellar job,
ble. Reducingexposureishard, anddifferenttechniques asdomanyothersystemsemployingAItechniques;their
needtobeemployedwhengivingaddressestoindividuals, operationisbeyondthescopeofthispaper.Evenformsof
posting inonline fora, andwhenconductingtransactions micropaymentshavebeenproposed,eitherintheformof
overtheweb. Thesecategoriesarenotevenwell-defined; actualtransferofpayment,ortheburningofCPUcycles
a user entering a friend’s email address in an electronic as an indicationthat some expense has beenincurred[5];
greetingcardwebsitethinksthatheisbeingcute,buthe causingspammerstospendtheirownresourcesinaman-
isareactuallyexposinghisfriend’sunrestrictedemailad- ner proportional to the amount of spam they send may
dresstoaspamharvester. Moreover,inpersonalemailit makethemrethinktheirbusinessmodel.
ishardtouseone-timeaddresses;socialnormsstilldictate
theuseofshort,pronounceableemailaddresses. 6. Summary andFuture Work
ThesystemmostlikeSPAistheTaggedMessageDeliv-
ThereseveralwaysinwhichtoexpandtheSPAidea. A
eryAgent(TMDA)[2].TMDAalsohastheconceptofus-
policy description language that is more expressive than
ing the email address to create single-purposeaddresses.
simpleregular-expressionmatching,andthatcanreferto
Aside from formatting and implementation details, the
other headers and perhaps even content of the message
main architectural difference is that policy is not explic-
may be a useful tool to develop. Another useful exten-
itly describedin theemail address,but rather(exceptfor
sion would be to enable a mail server along the delivery
thecaseoftheexpirationdate)theaddressisusedtolook
path, rather than the end user, to apply the policy in the
upthepolicyinlocaltables.Thismeansthatforeachspe-
SPA.Afairlyobviouswayofaccomplishingthisistoen-
cialaddresscreated,statemustbekeptbytheusersothat
cryptthepolicyundertheserver’spublickeywhilesign-
it can be processed in the future, causing such state ta-
ingitwiththeuser’skey. Thisofcourseopensupthepo-
blestogrowwithoutboundwhenaddresseswithoutexpi-
tential to launch a CPU denial-of-service attack on such
rationdatesareused. TMDAalsoincludesfeaturesfound
servers, hence some details have to be worked out first.
inchallenge-responsesystems. Thesesystems,(e.g.,[3])
Finally, a method for delegating the right to send email
try to ensure “return routability” of email addresses, po-
maybeofsomelimiteduse: asubscribertoamailinglist
tentially includinga short puzzlethat a humancould an-
maywishtoletanymemberofthemailinglistsendhim
swer easily but a machinecould not. These can mitigate
mailwithoutfirstcontactinghim. IftheSPAencodesthat
the problem of spam to harvested addresses, but it does
the mailing list administrator has the right to delegate to
mean that there can be cases where an automatic email
otherstheabilitytosendmailto theuser,andthesender
should have gone through but it does not. SPAs address
ofsuchemailincludesadelegationcertificatealongwith
thisproblem.
her email, that email will be let through. Many policy
Much spam software is sloppy about following SMTP
management systems, such as [6], have a natural way of
to the letter. Other software uses “open relays” (MTAs
specifyingdelegation. Suchdelegationcertificatescanbe
(mis)configuredtoacceptmailnotfortheirowndomains),
transmittedinadditionalmailheaders.
assteppingstonestoobscuretheoriginofspam. Several
In conclusion, we have described Single-Purpose Ad-
services provide real-time data on whether a host is an
dresses, a system that encodes policy in email addresses
openrelay,andmodernMTAsoftwareincludesextensive
for the chief purpose of filtering spam intelligently. The
support for querying these services and rejecting email
policy specified may be as simple as an expiration date
passing through an open relay. Similarly MTAs can be
and/ortheemailaddressoftheallowedsender,orascom-
configuredtorejectmailwith badly-formedheaders; un-
plicatedasafull-fledgedprogram. Thus,theSPAsystem
fortunately,asizeablefractionofworldwidemailservers
reduces spam by stoppingit right beforethe user sees it.
aremisconfigured,andtheriskoflosingimportantemail
Encoding policy as part of the email address allows forstatelessincomingmailfiltering.Thereisnoneedtoman- 2704, http://www.rfc-editor.org/,September
age whitelists, and blacklists, to the extent that they will 1999.
beneeded,canhaveaddressesremovedaftertheirexpira- [7] M.Blaze,J.Feigenbaum,andJ.Lacy.DecentralizedTrust
tion date. Integritychecksprotect the SPA from tamper- Management. In Proc. of the 17th Symposium on Secu-
rityandPrivacy,pages164–173.IEEEComputerSociety
ing, and encryption ensures that adversaries cannot infer
Press,LosAlamitos,1996.
valid, non-SPA addresses from the SPA itself; in a lim-
[8] M.Crispin. InternetMessageAccessProtocol—Version
ited sense, SPA thereforealso reduces exposureof email
4rev1.RFC2060,http://www.rfc-editor.org/,
addresses. Finally, while it is better to get some support
December1996.
from the mail server, the SPA system can work with re- [9] D.H.Crocker. StandardForTheFormatOfARPAInter-
ducedfunctionalitywithjustclientsupport,increasingits netTextMessages. RequestforComments822, Internet
chancesofadoption. EngineeringTaskForce,August1982.
[10] JKlensin,Editor.SimpleMailTransferProtocol.Request
Acknowledgments for Comments 2821, Internet Engineering Task Force,
April2001.
ManythanksgotoViktorDukhovniforhishelpwithPost- [11] M. Blaze and J. Feigenbaum and J. Ioannidis and
fix,andtotheanonymousreviewersfortheirhelpfulcom- A. Keromytis. The Role of Trust Management in Dis-
ments. tributed Systems Security. In Secure Internet Program-
ming,pages185–210.
References [12] S.H.Mueller. SpamandtheLaw. ;Login:,April1998.
[13] J.MyersandM.Rose. PostOfficeProtocol—Version3.
[1] http://www.spamlaws.com/. RFC 1939, http://www.rfc-editor.org/, May
[2] http://www.tmda.net/. 1996.
[3] http://www.chooseyourmail.com/. [14] J. Postel. Simple Mail Transfer Protocol. Request for
[4] http://www.spamassassin.com/.
Comments821,InternetEngineeringTaskForce,August
[5] A. Back. Hashcash — A Denial of Service Coun-
1982.
termeasure. http://www.cypherspace.org/
[15] WietseVenema. http://www.postfix.org/.
hashcash/,April1997.
[6] M.Blaze,J.Feigenbaum,J.Ioannidis,andA.Keromytis.
TheKeyNoteTrust-ManagementSystemVersion2. RFC